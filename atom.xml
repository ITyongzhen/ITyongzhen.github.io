<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>殷永振</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://ityongzhen.github.io/"/>
  <updated>2020-02-29T07:57:03.373Z</updated>
  <id>https://ityongzhen.github.io/</id>
  
  <author>
    <name>ityongzhen</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Flutter学习之Dart语法(三)</title>
    <link href="https://ityongzhen.github.io/Flutter%E5%AD%A6%E4%B9%A0%E4%B9%8BDart%E8%AF%AD%E6%B3%95(%E4%B8%89).html/"/>
    <id>https://ityongzhen.github.io/Flutter%E5%AD%A6%E4%B9%A0%E4%B9%8BDart%E8%AF%AD%E6%B3%95(%E4%B8%89).html/</id>
    <published>2020-02-16T00:32:24.000Z</published>
    <updated>2020-02-29T07:57:03.373Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/Flutter学习之Dart语法(三).html/">个人博客</a></p><h2 id="类和对象"><a href="#类和对象" class="headerlink" title="类和对象"></a>类和对象</h2><blockquote><p>Dart是一个面向对象的语言，面向对象中非常重要的概念就是类，类产生了对象。</p></blockquote><h2 id="类的定义"><a href="#类的定义" class="headerlink" title="类的定义"></a>类的定义</h2><p>在Dart中，定义类用class关键字。<br>类通常有两部分组成：成员（member）和方法（method）。<br>定义类的伪代码如下：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> 类名 </span>&#123;</span><br><span class="line">  类型 成员名;</span><br><span class="line">  返回值类型 方法名(参数列表) &#123;</span><br><span class="line">    方法体</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编写一个简单的Person类：</p><ul><li>这里有一个注意点: 我们在方法中使用属性(成员/实例变量)时，并没有加this；</li><li>Dart的开发风格中，在方法中通常使用属性时，会省略this，但是有命名冲突时，this不能省略；</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> name;</span><br><span class="line"></span><br><span class="line">  eat() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'<span class="subst">$name</span>在吃东西'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们来使用这个类，创建对应的对象：</p><ul><li>注意：从Dart2开始，new关键字可以省略。</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="comment">// 1.创建类的对象</span></span><br><span class="line">  <span class="keyword">var</span> p = <span class="keyword">new</span> Person(); <span class="comment">// 直接使用Person()也可以创建</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.给对象的属性赋值</span></span><br><span class="line">  p.name = <span class="string">'eagle'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.调用对象的方法</span></span><br><span class="line">  p.eat();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h2><h3 id="普通构造方法"><a href="#普通构造方法" class="headerlink" title="普通构造方法"></a>普通构造方法</h3><p>我们知道, 当通过类创建一个对象时，会调用这个类的构造方法。</p><ul><li>当类中没有明确指定构造方法时，将默认拥有一个无参的构造方法。</li><li>前面的Person中我们就是在调用这个构造方法.</li></ul><p>我们也可以根据自己的需求，定义自己的构造方法:</p><p><strong>注意一：</strong>当有了自己的构造方法时，默认的构造方法将会失效，不能使用</p><ul><li>当然，你可能希望明确的写一个默认的构造方法，但是会和我们自定义的构造方法冲突；</li><li>这是因为Dart本身不支持函数的重载（名称相同, 参数不同的方式）。</li></ul><p><strong>注意二：</strong>这里我还实现了toString方法</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> name;</span><br><span class="line">  <span class="built_in">int</span> age;</span><br><span class="line"></span><br><span class="line">  Person(<span class="built_in">String</span> name, <span class="built_in">int</span> age) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span> toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'name=<span class="subst">$name</span> age=<span class="subst">$age</span>'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>另外，在实现构造方法时，通常做的事情就是通过<strong>参数给属性</strong>赋值<br>为了简化这一过程, Dart提供了一种更加简洁的语法糖形式.<br>上面的构造方法可以优化成下面的写法：</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="constructor">Person(String <span class="params">name</span>, <span class="params">int</span> <span class="params">age</span>)</span> &#123;</span><br><span class="line">  this.name = name;</span><br><span class="line">  this.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="constructor">Person(<span class="params">this</span>.<span class="params">name</span>, <span class="params">this</span>.<span class="params">age</span>)</span>;</span><br></pre></td></tr></table></figure><h3 id="命名构造方法"><a href="#命名构造方法" class="headerlink" title="命名构造方法"></a>命名构造方法</h3><p>但是在开发中, 我们确实希望实现更多的构造方法，怎么办呢？</p><p>因为不支持方法（函数）的重载，所以我们没办法创建相同名称的构造方法。</p><p>我们需要使用命名构造方法:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> name;</span><br><span class="line">  <span class="built_in">int</span> age;</span><br><span class="line"></span><br><span class="line">  Person() &#123;</span><br><span class="line">    name = <span class="string">''</span>;</span><br><span class="line">    age = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// 命名构造方法</span></span><br><span class="line">  Person.withArgments(<span class="built_in">String</span> name, <span class="built_in">int</span> age) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span> toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'name=<span class="subst">$name</span> age=<span class="subst">$age</span>'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建对象</span></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="built_in">print</span>(p1);</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> Person.withArgments(<span class="string">'eagle'</span>, <span class="number">18</span>);</span><br><span class="line"><span class="built_in">print</span>(p2);</span><br></pre></td></tr></table></figure><p>在之后的开发中, 我们也可以利用命名构造方法，提供更加便捷的创建对象方式:</p><p>比如开发中，我们需要经常将一个Map转成对象，可以提供如下的构造方法</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 新的构造方法</span></span><br><span class="line">Person.fromMap(Map&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt; <span class="built_in">map</span>) &#123;</span><br><span class="line">   <span class="keyword">this</span>.name = <span class="built_in">map</span>[<span class="string">'name'</span>];</span><br><span class="line">   <span class="keyword">this</span>.age = <span class="built_in">map</span>[<span class="string">'age'</span>];</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过上面的构造方法创建对象</span></span><br><span class="line"> var p3 = <span class="keyword">new</span> Person.fromMap(&#123;<span class="string">'name'</span>: <span class="string">'kobe'</span>, <span class="string">'age'</span>: <span class="number">30</span>&#125;);</span><br><span class="line"> <span class="built_in">print</span>(p3);</span><br></pre></td></tr></table></figure><h3 id="初始化列表"><a href="#初始化列表" class="headerlink" title="初始化列表"></a>初始化列表</h3><p>我们来重新定义一个类Point, 传入x/y，可以得到它们的距离distance:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">num</span> x;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">num</span> y;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">num</span> distance;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 错误写法</span></span><br><span class="line">  <span class="comment">// Point(this.x, this.y) &#123;</span></span><br><span class="line">  <span class="comment">//   distance = sqrt(x * x + y * y);</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 正确的写法</span></span><br><span class="line">  Point(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y) : distance = sqrt(x * x + y * y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面这种初始化变量的方法, 我们称之为初始化列表(Initializer list)</p><h3 id="重定向构造方法"><a href="#重定向构造方法" class="headerlink" title="重定向构造方法"></a>重定向构造方法</h3><p>在某些情况下, 我们希望在一个构造方法中去调用另外一个构造方法, 这个时候可以使用重定向构造方法：</p><p>在一个构造函数中，去调用另外一个构造函数（注意：是在冒号后面使用this调用）</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Person &#123;</span><br><span class="line">  String name;</span><br><span class="line">  <span class="built_in">int</span> age;</span><br><span class="line"></span><br><span class="line">  <span class="constructor">Person(<span class="params">this</span>.<span class="params">name</span>, <span class="params">this</span>.<span class="params">age</span>)</span>;</span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Person</span>.</span></span>from<span class="constructor">Name(String <span class="params">name</span>)</span> : this(name, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="常量构造方法"><a href="#常量构造方法" class="headerlink" title="常量构造方法"></a>常量构造方法</h3><p>在某些情况下，传入相同值时，我们希望返回同一个对象，这个时候，可以使用常量构造方法.<br>默认情况下，创建对象时，即使传入相同的参数，创建出来的也不是同一个对象，看下面代码:</p><p>这里我们使用identical(对象1, 对象2)函数来判断两个对象是否是同一个对象:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="keyword">var</span> p1 = Person(<span class="string">'eagle'</span>);</span><br><span class="line">  <span class="keyword">var</span> p2 = Person(<span class="string">'eagle'</span>);</span><br><span class="line">  <span class="built_in">print</span>(identical(p1, p2)); <span class="comment">// false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> name;</span><br><span class="line"></span><br><span class="line">  Person(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是, 如果将构造方法前加const进行修饰，那么可以保证同一个参数，创建出来的对象是相同的</p><p>这样的构造方法就称之为常量构造方法。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="keyword">var</span> p1 = <span class="keyword">const</span> Person(<span class="string">'eagle'</span>);</span><br><span class="line">  <span class="keyword">var</span> p2 = <span class="keyword">const</span> Person(<span class="string">'eagle'</span>);</span><br><span class="line">  <span class="built_in">print</span>(identical(p1, p2)); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> name;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> Person(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>常量构造方法有一些注意点:</p><ul><li>注意一：拥有常量构造方法的类中，所有的成员变量必须是final修饰的.</li><li>注意二: 为了可以通过常量构造方法，创建出相同的对象，不再使用 new关键字，而是使用const关键字</li></ul><p>如果是将结果赋值给const修饰的标识符时，const可以省略.</p><h3 id="工厂构造方法"><a href="#工厂构造方法" class="headerlink" title="工厂构造方法"></a>工厂构造方法</h3><p>Dart提供了factory关键字, 用于通过工厂去获取对象</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="keyword">var</span> p1 = Person(<span class="string">'eagle'</span>);</span><br><span class="line">  <span class="keyword">var</span> p2 = Person(<span class="string">'eagle'</span>);</span><br><span class="line">  <span class="built_in">print</span>(identical(p1, p2)); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> name;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, Person&gt; _cache = &lt;<span class="built_in">String</span>, Person&gt;&#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> Person(<span class="built_in">String</span> name) &#123;</span><br><span class="line">    <span class="keyword">if</span> (_cache.containsKey(name)) &#123;</span><br><span class="line">      <span class="keyword">return</span> _cache[name];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">final</span> p = Person._internal(name);</span><br><span class="line">      _cache[name] = p;</span><br><span class="line">      <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Person._internal(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="setter和getter"><a href="#setter和getter" class="headerlink" title="setter和getter"></a>setter和getter</h2><p>默认情况下，Dart中类定义的属性是可以直接被外界访问的。<br>但是某些情况下，我们希望监控这个类的属性被访问的过程，这个时候就可以使用setter和getter了</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">main(List&lt;<span class="keyword">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="keyword">final</span> d = Dog(<span class="string">"黄色"</span>);</span><br><span class="line">  d.setColor = <span class="string">"黑色"</span>;</span><br><span class="line">  <span class="built_in">print</span>(d.getColor);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Dog &#123;</span><br><span class="line">  <span class="keyword">String</span> <span class="built_in">color</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">String</span> <span class="built_in">get</span> getColor &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">color</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">set</span> setColor(<span class="keyword">String</span> <span class="built_in">color</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.<span class="built_in">color</span> = <span class="built_in">color</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Dog(<span class="keyword">this</span>.<span class="built_in">color</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="类的继承"><a href="#类的继承" class="headerlink" title="类的继承"></a>类的继承</h2><p>面向对象的其中一大特性就是继承，继承不仅仅可以减少我们的代码量，也是多态的使用前提。<br>Dart中的继承使用extends关键字，子类中使用super来访问父类。<br>父类中的所有成员变量和方法都会被继承,，但是构造方法除外。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">main(<span class="type">List</span>&lt;<span class="type">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="keyword">var</span> p = <span class="keyword">new</span> <span class="type">Person</span>();</span><br><span class="line">  p.age = <span class="number">18</span>;</span><br><span class="line">  p.run();</span><br><span class="line">  print(p.age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  int age;</span><br><span class="line"></span><br><span class="line">  run() &#123;</span><br><span class="line">    print('在奔跑ing');</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>子类可以拥有自己的成员变量, 并且可以对父类的方法进行重写：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="type">String</span> name;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  run() &#123;</span><br><span class="line">    print('$name在奔跑ing');</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>子类中可以调用父类的构造方法，对某些属性进行初始化：</p><p>子类的构造方法在执行前，将隐含调用父类的无参默认构造方法（没有参数且与类同名的构造方法）。<br>如果父类没有无参默认构造方法，则子类的构造方法必须在初始化列表中通过super显式调用父类的某个构造方法。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> age;</span><br><span class="line"></span><br><span class="line">  Animal(<span class="keyword">this</span>.age);</span><br><span class="line"></span><br><span class="line">  run() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'在奔跑ing'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> name;</span><br><span class="line"></span><br><span class="line">  Person(<span class="built_in">String</span> name, <span class="built_in">int</span> age) : name=name, <span class="keyword">super</span>(age);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  run() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'<span class="subst">$name</span>在奔跑ing'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span> toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'name=<span class="subst">$name</span>, age=<span class="subst">$age</span>'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h2><p>我们知道，继承是多态使用的前提。<br>所以在定义很多通用的<strong>调用接口</strong>时, 我们通常会让调用者传入父类，通过多态来实现更加灵活的调用方式。<br>但是，父类本身可能并不需要对某些方法进行具体的实现，所以父类中定义的方法,，我们可以定义为抽象方法。<br>什么是 抽象方法? 在Dart中没有具体实现的方法(没有方法体)，就是抽象方法。</p><p>抽象方法，必须存在于抽象类中。<br>抽象类是使用abstract声明的类。</p><p>下面的代码中, Shape类就是一个抽象类, 其中包含一个抽象方法.</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  getArea();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  double r;</span><br><span class="line"></span><br><span class="line">  <span class="type">Circle</span>(<span class="keyword">this</span>.r);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  getArea() &#123;</span><br><span class="line">    <span class="keyword">return</span> r * r * <span class="number">3.14</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reactangle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  double w;</span><br><span class="line">  double h;</span><br><span class="line"></span><br><span class="line">  <span class="type">Reactangle</span>(<span class="keyword">this</span>.w, <span class="keyword">this</span>.h);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  getArea() &#123;</span><br><span class="line">    <span class="keyword">return</span> w * h;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意事项:</p><p><strong>注意一：</strong>抽象类不能实例化.<br><strong>注意二：</strong>抽象类中的抽象方法必须被子类实现, 抽象类中的已经被实现方法, 可以不被子类重写.</p><h2 id="隐式接口"><a href="#隐式接口" class="headerlink" title="隐式接口"></a>隐式接口</h2><p>Dart中的接口比较特殊, 没有一个专门的关键字来声明接口.<br>默认情况下，定义的每个类都相当于默认也声明了一个接口，可以由其他的类来实现(因为Dart不支持多继承)<br>在开发中，我们通常将用于给别人实现的类声明为抽象类:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Runner</span> </span>&#123;</span><br><span class="line">  run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Flyer</span> </span>&#123;</span><br><span class="line">  fly();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SuperMan</span> <span class="keyword">implements</span> <span class="title">Runner</span>, <span class="title">Flyer</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  run() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'超人在奔跑'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  fly() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'超人在飞'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Mixin混入"><a href="#Mixin混入" class="headerlink" title="Mixin混入"></a>Mixin混入</h2><p>在通过implements实现某个类时，类中所有的方法都必须被重新实现(无论这个类原来是否已经实现过该方法)。<br>但是某些情况下，一个类可能希望直接复用之前类的原有实现方案，怎么做呢?</p><p>使用继承吗？但是Dart只支持单继承，那么意味着你只能复用一个类的实现。</p><p>Dart提供了另外一种方案: Mixin混入的方式</p><p>除了可以通过class定义类之外，也可以通过mixin关键字来定义一个类。<br>只是通过mixin定义的类用于被其他类混入使用，通过with关键字来进行混入。</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">main(List&lt;String&gt; args) &#123;</span><br><span class="line">  var superMan = SuperMain();</span><br><span class="line">  superMan.run();</span><br><span class="line">  superMan.fly();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">mixin</span> Runner &#123;</span><br><span class="line">  run() &#123;</span><br><span class="line">    print(<span class="string">'在奔跑'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">mixin</span> Flyer &#123;</span><br><span class="line">  fly() &#123;</span><br><span class="line">    print(<span class="string">'在飞翔'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// implements的方式要求必须对其中的方法进行重新实现</span></span><br><span class="line"><span class="comment">// class SuperMan implements Runner, Flyer &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="symbol">SuperMain</span> <span class="symbol">with</span> <span class="symbol">Runner, <span class="symbol">Flyer</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="类成员和方法"><a href="#类成员和方法" class="headerlink" title="类成员和方法"></a>类成员和方法</h2><p>前面我们在类中定义的成员和方法都属于对象级别的, 在开发中, 我们有时候也需要定义类级别的成员和方法<br>在Dart中我们使用static关键字来定义:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="keyword">var</span> stu = Student();</span><br><span class="line">  stu.name = <span class="string">'eagle'</span>;</span><br><span class="line">  stu.sno = <span class="number">110</span>;</span><br><span class="line">  stu.study();</span><br><span class="line"></span><br><span class="line">  Student.time = <span class="string">'早上8点'</span>;</span><br><span class="line">  <span class="comment">// stu.time = '早上9点'; 错误做法, 实例对象不能访问类成员</span></span><br><span class="line">  Student.attendClass();</span><br><span class="line">  <span class="comment">// stu.attendClass(); 错误做法, 实现对象补鞥呢访问类方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> name;</span><br><span class="line">  <span class="built_in">int</span> sno;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">String</span> time;</span><br><span class="line"></span><br><span class="line">  study() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'<span class="subst">$name</span>在学习'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> attendClass() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'去上课'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h2><p>枚举在开发中也非常常见, 枚举也是一种特殊的类, 通常用于表示固定数量的常量值。</p><h3 id="枚举的定义"><a href="#枚举的定义" class="headerlink" title="枚举的定义"></a>枚举的定义</h3><p>枚举使用enum关键字来进行定义:</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">main(List&lt;String&gt; args) &#123;</span><br><span class="line">  print(Colors.red);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Colors</span> &#123;</span></span><br><span class="line">  red,</span><br><span class="line">  green,</span><br><span class="line">  blue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="枚举的属性"><a href="#枚举的属性" class="headerlink" title="枚举的属性"></a>枚举的属性</h3><p>枚举类型中有两个比较常见的属性:</p><p>index: 用于表示每个枚举常量的索引, 从0开始.<br>values: 包含每个枚举值的List.</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">main(List&lt;<span class="keyword">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="built_in">print</span>(Colors.<span class="built_in">red</span>.index);</span><br><span class="line">  <span class="built_in">print</span>(Colors.<span class="built_in">green</span>.index);</span><br><span class="line">  <span class="built_in">print</span>(Colors.<span class="built_in">blue</span>.index);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(Colors.values);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> Colors &#123;</span><br><span class="line">  <span class="built_in">red</span>,</span><br><span class="line">  <span class="built_in">green</span>,</span><br><span class="line">  <span class="built_in">blue</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>枚举类型的注意事项:</p><ul><li>注意一: 您不能子类化、混合或实现枚举。</li><li>注意二: 不能显式实例化一个枚举</li></ul><p>参考 <a href="https://juejin.im/post/5d76340c6fb9a06adb800961" target="_blank" rel="noopener">https://juejin.im/post/5d76340c6fb9a06adb800961</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/Flutter学习之Dart语法(三).html/&quot;&gt;个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;类和对象&quot;&gt;&lt;a href=&quot;#类和对象&quot; class=&quot;headerlink&quot; title
      
    
    </summary>
    
    
      <category term="Flutter" scheme="https://ityongzhen.github.io/categories/Flutter/"/>
    
    
  </entry>
  
  <entry>
    <title>Flutter学习之Dart语法(二)</title>
    <link href="https://ityongzhen.github.io/Flutter%E5%AD%A6%E4%B9%A0%E4%B9%8BDart%E8%AF%AD%E6%B3%95(%E4%BA%8C).html/"/>
    <id>https://ityongzhen.github.io/Flutter%E5%AD%A6%E4%B9%A0%E4%B9%8BDart%E8%AF%AD%E6%B3%95(%E4%BA%8C).html/</id>
    <published>2020-02-13T00:32:24.000Z</published>
    <updated>2020-02-29T07:29:38.418Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/Flutter学习之Dart语法(二).html/">个人博客</a></p><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="函数的基本定义"><a href="#函数的基本定义" class="headerlink" title="函数的基本定义"></a>函数的基本定义</h3><ul><li>Dart是一种真正的面向对象语言，所以即使函数也是对象，所有也有类型, 类型就是Function。</li><li>这也就意味着函数可以作为变量定义或者作为其他函数的参数或者返回值.</li></ul><p>函数的定义方式:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">返回值 函数的名称(参数列表) &#123;</span><br><span class="line">  函数体</span><br><span class="line">  <span class="keyword">return</span> 返回值</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>按照上面的定义方式, 我们定义一个完整的函数:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> sum(<span class="built_in">num</span> num1, <span class="built_in">num</span> num2) &#123;</span><br><span class="line">  <span class="keyword">return</span> num1 + num2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Effective Dart建议对公共的API, 使用类型注解, 但是如果我们省略掉了类型, 依然是可以正常工作的</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sum</span>(num1, num2) &#123;</span><br><span class="line">  <span class="keyword">return</span> num1 + num2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>另外, 如果函数中只有一个表达式, 那么可以使用箭头语法(arrow syntax)</p><ul><li>注意, 这里面只能是一个表达式, 不能是一个语句</li></ul><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum<span class="comment">(num1, num2)</span> =&gt; <span class="symbol">num1</span> + <span class="symbol">num2</span>;</span><br></pre></td></tr></table></figure><h3 id="函数的参数问题"><a href="#函数的参数问题" class="headerlink" title="函数的参数问题"></a>函数的参数问题</h3><blockquote><p>函数的参数可以分成两类: 必须参数和可选参数<br>前面使用的参数都是必须参数.</p></blockquote><h4 id="可选参数"><a href="#可选参数" class="headerlink" title="可选参数"></a>可选参数</h4><p>可选参数可以分为 命名可选参数 和 位置可选参数<br>定义方式:</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">命名可选参数: &#123;para<span class="name">m1</span>, para<span class="name">m2</span>, ...&#125;</span><br><span class="line">位置可选参数: [para<span class="name">m1</span>, para<span class="name">m2</span>, ...]</span><br></pre></td></tr></table></figure><p>命名可选参数的演示:</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 命名可选参数</span></span><br><span class="line">print<span class="constructor">Info1(String <span class="params">name</span>, &#123;<span class="params">int</span> <span class="params">age</span>, <span class="params">double</span> <span class="params">height</span>&#125;)</span> &#123;</span><br><span class="line">  print('name=$name age=$age height=$height');</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用printInfo1函数</span></span><br><span class="line">print<span class="constructor">Info1('<span class="params">eagle</span>')</span>; <span class="comment">// name=eagle age=null height=null</span></span><br><span class="line">print<span class="constructor">Info1('<span class="params">eagle</span>', <span class="params">age</span>: 18)</span>; <span class="comment">// name=eagle age=18 height=null</span></span><br><span class="line">print<span class="constructor">Info1('<span class="params">eagle</span>', <span class="params">age</span>: 18, <span class="params">height</span>: 1.88)</span>; <span class="comment">// name=eagle age=18 height=1.88</span></span><br><span class="line">print<span class="constructor">Info1('<span class="params">eagle</span>', <span class="params">height</span>: 1.88)</span>; <span class="comment">// name=eagle age=null height=1.88</span></span><br></pre></td></tr></table></figure><p>位置可选参数的演示:</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义位置可选参数</span></span><br><span class="line">print<span class="constructor">Info2(String <span class="params">name</span>, [<span class="params">int</span> <span class="params">age</span>, <span class="params">double</span> <span class="params">height</span>])</span> &#123;</span><br><span class="line">  print('name=$name age=$age height=$height');</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用printInfo2函数</span></span><br><span class="line">print<span class="constructor">Info2('<span class="params">eagle</span>')</span>; <span class="comment">// name=eagle age=null height=null</span></span><br><span class="line">print<span class="constructor">Info2('<span class="params">eagle</span>', 18)</span>; <span class="comment">// name=eagle age=18 height=null</span></span><br><span class="line">print<span class="constructor">Info2('<span class="params">eagle</span>', 18, 1.88)</span>; <span class="comment">// name=eagle age=18 height=1.88</span></span><br></pre></td></tr></table></figure><p>命名可选参数, 可以指定某个参数是必传的(使用@required, 有问题)</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 命名可选参数的必须</span></span><br><span class="line">printInfo3(<span class="built_in">String</span> name, &#123;<span class="built_in">int</span> age, <span class="built_in">double</span> height, <span class="meta">@required</span> <span class="built_in">String</span> address&#125;) &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'name=<span class="subst">$name</span> age=<span class="subst">$age</span> height=<span class="subst">$height</span> address=<span class="subst">$address</span>'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="参数默认值"><a href="#参数默认值" class="headerlink" title="参数默认值"></a>参数默认值</h4><p>参数可以有默认值, 在不传入的情况下, 使用默认值</p><p>注意, 只有可选参数才可以有默认值, 必须参数不能有默认值</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数的默认值</span></span><br><span class="line">printInfo4(<span class="built_in">String</span> name, &#123;<span class="built_in">int</span> age = <span class="number">18</span>, <span class="built_in">double</span> height=<span class="number">1.88</span>&#125;) &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'name=<span class="subst">$name</span> age=<span class="subst">$age</span> height=<span class="subst">$height</span>'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Dart中的main函数就是一个接受可选的列表参数作为参数的, 所以在使用main函数时, 我们可以传入参数, 也可以不传入</p><h3 id="函数是一等公民"><a href="#函数是一等公民" class="headerlink" title="函数是一等公民"></a>函数是一等公民</h3><p>在很多语言中, 函数并不能作为一等公民来使用, 比如Java/OC. 这种限制让编程不够灵活, 所以现代的编程语言基本都支持函数作为一等公民来使用, Dart也支持.<br>这就意味着你可以将函数赋值给一个变量, 也可以将函数作为另外一个函数的参数或者返回值来使用.</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="comment">// 1.将函数赋值给一个变量</span></span><br><span class="line">  <span class="keyword">var</span> bar = foo;</span><br><span class="line">  <span class="built_in">print</span>(bar);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.将函数作为另一个函数的参数</span></span><br><span class="line">  test(foo);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.将函数作为另一个函数的返回值</span></span><br><span class="line">  <span class="keyword">var</span> func =getFunc();</span><br><span class="line">  func(<span class="string">'kobe'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.定义一个函数</span></span><br><span class="line">foo(<span class="built_in">String</span> name) &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'传入的name:<span class="subst">$name</span>'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.将函数作为另外一个函数的参数</span></span><br><span class="line">test(<span class="built_in">Function</span> func) &#123;</span><br><span class="line">  func(<span class="string">'eagle'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.将函数作为另一个函数的返回值</span></span><br><span class="line">getFunc() &#123;</span><br><span class="line">  <span class="keyword">return</span> foo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="匿名函数的使用"><a href="#匿名函数的使用" class="headerlink" title="匿名函数的使用"></a>匿名函数的使用</h3><p>大部分我们定义的函数都会有自己的名字， 比如前面定义的foo、test函数等等。<br>但是某些情况下，给函数命名太麻烦了，我们可以使用没有名字的函数，这种函数可以被称之为匿名函数( anonymous function)，也可以叫lambda或者closure。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">main(<span class="keyword">List</span>&lt;String&gt; args) &#123;</span><br><span class="line">  <span class="comment">// 1.定义数组</span></span><br><span class="line">  <span class="keyword">var</span> movies = [<span class="string">'盗梦空间'</span>, <span class="string">'星际穿越'</span>, <span class="string">'少年派'</span>, <span class="string">'大话西游'</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.使用forEach遍历: 有名字的函数</span></span><br><span class="line">  printElement(item) &#123;</span><br><span class="line">    <span class="keyword">print</span>(item);</span><br><span class="line">  &#125;</span><br><span class="line">  movies.<span class="keyword">forEach</span>(printElement);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.使用forEach遍历: 匿名函数</span></span><br><span class="line">  movies.<span class="keyword">forEach</span>((item) &#123;</span><br><span class="line">    <span class="keyword">print</span>(item);</span><br><span class="line">  &#125;);</span><br><span class="line">  movies.<span class="keyword">forEach</span>((item) =&gt; <span class="keyword">print</span>(item));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="词法作用域"><a href="#词法作用域" class="headerlink" title="词法作用域"></a>词法作用域</h3><p>dart中的词法有自己明确的作用域范围，它是根据代码的结构({})来决定作用域范围的<br>优先使用自己作用域中的变量，如果没有找到，则一层层向外查找。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'global'</span>;</span><br><span class="line">main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="comment">// var name = 'main';</span></span><br><span class="line">  <span class="keyword">void</span> foo() &#123;</span><br><span class="line">    <span class="comment">// var name = 'foo';</span></span><br><span class="line">    <span class="built_in">print</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  foo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="词法闭包"><a href="#词法闭包" class="headerlink" title="词法闭包"></a>词法闭包</h3><p>闭包可以访问其词法范围内的变量，即使函数在其他地方被使用，也可以正常的访问。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) &#123;</span><br><span class="line">  makeAdder(<span class="built_in">num</span> addBy) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">num</span> i) &#123;</span><br><span class="line">      <span class="keyword">return</span> i + addBy;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> adder2 = makeAdder(<span class="number">2</span>);</span><br><span class="line">  <span class="built_in">print</span>(adder2(<span class="number">10</span>)); <span class="comment">// 12</span></span><br><span class="line">  <span class="built_in">print</span>(adder2(<span class="number">6</span>)); <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> adder5 = makeAdder(<span class="number">5</span>);</span><br><span class="line">  <span class="built_in">print</span>(adder5(<span class="number">10</span>)); <span class="comment">// 15</span></span><br><span class="line">  <span class="built_in">print</span>(adder5(<span class="number">6</span>)); <span class="comment">// 11</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="返回值问题"><a href="#返回值问题" class="headerlink" title="返回值问题"></a>返回值问题</h3><p>所有函数都返回一个值。如果没有指定返回值，则语句返回null;隐式附加到函数体。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="built_in">print</span>(foo()); <span class="comment">// null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo() &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'foo function'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><h3 id="除法、整除、取模运算"><a href="#除法、整除、取模运算" class="headerlink" title="除法、整除、取模运算"></a>除法、整除、取模运算</h3><p>我们来看一下除法、整除、取模运算</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">num</span> = <span class="number">7</span>;</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">num</span> / <span class="number">3</span>); <span class="comment">// 除法操作, 结果2.3333..</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">num</span> ~/ <span class="number">3</span>); <span class="comment">// 整除操作, 结果2;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">num</span> % <span class="number">3</span>); <span class="comment">// 取模操作, 结果1;</span></span><br></pre></td></tr></table></figure><h3 id="赋值操作"><a href="#赋值操作" class="headerlink" title="??=赋值操作"></a>??=赋值操作</h3><p>dart有一个很多语言都不具备的赋值运算符：</p><ul><li>当变量为null时，使用后面的内容进行赋值。</li><li>当变量有值时，使用自己原来的值。</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="keyword">var</span> name1 = <span class="string">'eagle'</span>;</span><br><span class="line">  <span class="built_in">print</span>(name1);</span><br><span class="line">  <span class="comment">// var name2 = 'kobe';</span></span><br><span class="line">  <span class="keyword">var</span> name2 = <span class="keyword">null</span>;</span><br><span class="line">  name2 ??= <span class="string">'james'</span>; </span><br><span class="line">  <span class="built_in">print</span>(name2); <span class="comment">// 当name2初始化为kobe时，结果为kobe，当初始化为null时，赋值了james</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="条件运算符："><a href="#条件运算符：" class="headerlink" title="条件运算符："></a>条件运算符：</h3><p>Dart中包含一直比较特殊的条件运算符：expr1 ?? expr2</p><ul><li>如果expr1是null，则返回expr2的结果;</li><li>如果expr1不是null，直接使用expr1的结果。</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var <span class="keyword">temp</span> = <span class="string">'eagle'</span>;</span><br><span class="line">var <span class="keyword">temp</span> = <span class="keyword">null</span>;</span><br><span class="line">var <span class="type">name</span> = <span class="keyword">temp</span> ?? <span class="string">'kobe'</span>;</span><br><span class="line">print(<span class="type">name</span>);</span><br></pre></td></tr></table></figure><h3 id="级联语法："><a href="#级联语法：" class="headerlink" title="级联语法：.."></a>级联语法：..</h3><ul><li>某些时候，我们希望对一个对象进行连续的操作，这个时候可以使用级联语法</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line">  String name;</span><br><span class="line"></span><br><span class="line">  void <span class="builtin-name">run</span>() &#123;</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">"<span class="variable">$&#123;name&#125;</span> is running"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  void eat() &#123;</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">"<span class="variable">$&#123;name&#125;</span> is eating"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  void swim() &#123;</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">"<span class="variable">$&#123;name&#125;</span> is swimming"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main(List&lt;String&gt; args) &#123;</span><br><span class="line">  final p1 = Person();</span><br><span class="line">  p1.name = <span class="string">'eagle'</span>;</span><br><span class="line">  p1.<span class="builtin-name">run</span>();</span><br><span class="line">  p1.eat();</span><br><span class="line">  p1.swim();</span><br><span class="line"></span><br><span class="line">  final p2 = Person()</span><br><span class="line">              <span class="built_in">..</span>name = <span class="string">"eagle"</span></span><br><span class="line">              <span class="built_in">..</span><span class="builtin-name">run</span>()</span><br><span class="line">              <span class="built_in">..</span>eat()</span><br><span class="line">              <span class="built_in">..</span>swim();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2><p>和大部分语言的特性比较相似，这里就不再详细赘述，看一下即可。</p><h3 id="if和else"><a href="#if和else" class="headerlink" title="if和else"></a>if和else</h3><p>和其他语言用法一样<br>这里有一个注意点：不支持非空即真或者非0即真，必须有明确的bool类型</p><ul><li>我们来看下面name为null的判断</li></ul><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var age = <span class="built_in">null</span>;</span><br><span class="line"><span class="keyword">if</span>(age)&#123; <span class="comment">//错误的用法</span></span><br><span class="line">   <span class="keyword">print</span>(age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="循环操作"><a href="#循环操作" class="headerlink" title="循环操作"></a>循环操作</h3><p>基本的for循环</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (var <span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; <span class="number">5</span>; <span class="built_in">i</span>++) &#123;</span><br><span class="line">  print(<span class="built_in">i</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>for in遍历List和Set类型</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> names = [<span class="string">'eagle'</span>, <span class="string">'kobe'</span>, <span class="string">'curry'</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> name <span class="keyword">in</span> names) &#123;</span><br><span class="line">  <span class="built_in">print</span>(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>while和do-while和其他语言一致<br>break和continue用法也是一致</p><h3 id="switch-case"><a href="#switch-case" class="headerlink" title="switch-case"></a>switch-case</h3><p>普通的switch使用</p><p>注意：每一个case语句，默认情况下必须以一个break结尾</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="keyword">var</span> direction = <span class="string">'east'</span>;</span><br><span class="line">  <span class="keyword">switch</span> (direction) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'east'</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'东面'</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'south'</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'南面'</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'west'</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'西面'</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'north'</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'北面'</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'其他方向'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参考 <a href="https://juejin.im/post/5d76340c6fb9a06adb800961" target="_blank" rel="noopener">Flutter(三)之搞定Dart（一）</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/Flutter学习之Dart语法(二).html/&quot;&gt;个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;函数&quot;&gt;&lt;a href=&quot;#函数&quot; class=&quot;headerlink&quot; title=&quot;函数
      
    
    </summary>
    
    
      <category term="Flutter" scheme="https://ityongzhen.github.io/categories/Flutter/"/>
    
    
  </entry>
  
  <entry>
    <title>Flutter学习之Dart语法(一)</title>
    <link href="https://ityongzhen.github.io/Flutter%E5%AD%A6%E4%B9%A0%E4%B9%8BDart%E8%AF%AD%E6%B3%95(%E4%B8%80).html/"/>
    <id>https://ityongzhen.github.io/Flutter%E5%AD%A6%E4%B9%A0%E4%B9%8BDart%E8%AF%AD%E6%B3%95(%E4%B8%80).html/</id>
    <published>2020-02-10T00:32:24.000Z</published>
    <updated>2020-02-29T06:18:32.280Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/Flutter学习之Dart语法(一).html/">个人博客</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul><li>Dart是谷歌开发的计算机编程语言，后来被Ecma (ECMA-408)认定为标准 。它被用于web、服务器、移动应用和物联网等领域的开发。它是宽松开源许可证（修改的BSD证书）下的开源软件。</li><li>Dart是面向对象的、类定义的、单继承的语言。它的语法类似C语言，可以转译为JavaScript，支持接口(interfaces)、混入(mixins)、抽象类(abstract classes)、具体化泛型(reified generics)、可选类型(optional typing)和sound type system</li></ul><p><strong>Google为Flutter选择了Dart作为开发语言</strong></p><p>关于Dart的环境安装和配置这里就不赘述了。</p><h2 id="新建程序"><a href="#新建程序" class="headerlink" title="新建程序"></a>新建程序</h2><p>用VSCode新建一个Dart文件，默认是如下代码</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'Hello World'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其实这也和Java,C等等其他语言一样，main函数作为入口。</p><ul><li>Dart语言的入口也是main函数，并且必须显示的进行定义；</li><li>Dart的入口函数main是没有返回值的；</li><li>传递给main的命令行参数，是通过List<String>完成的。<ul><li>从字面值就可以理解List是Dart中的集合类型。</li><li>其中的每一个String都表示传递给main的一个参数；</li></ul></li><li>定义字符串的时候，可以使用单引号或双引号；</li><li>每行语句必须使用分号结尾，很多语言并不需要分号，比如Swift、JavaScript；</li></ul><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><h3 id="明确声明-Explicit"><a href="#明确声明-Explicit" class="headerlink" title="明确声明(Explicit)"></a>明确声明(Explicit)</h3><p>明确声明变量的方式, 格式如下:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">变量类型 变量名称 = 赋值<span class="comment">;</span></span><br></pre></td></tr></table></figure><p>示例代码:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span> name = <span class="string">'eagle'</span>;</span><br><span class="line"><span class="built_in">int</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;name&#125;</span>, <span class="subst">$&#123;age&#125;</span>'</span>);</span><br></pre></td></tr></table></figure><p>注意: 定义的变量可以修改值, 但是不能赋值其他类型</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String <span class="attribute">content</span> = <span class="string">'Hello World'</span>;</span><br><span class="line"><span class="attribute">content</span> = <span class="string">'Hello China'</span>; <span class="comment">// 正确的</span></span><br><span class="line"><span class="attribute">content</span> = <span class="number">111</span>; <span class="comment">// 错误的, 将一个int值赋值给一个String变量</span></span><br></pre></td></tr></table></figure><h3 id="类型推导-Type-Inference"><a href="#类型推导-Type-Inference" class="headerlink" title="类型推导(Type Inference)"></a>类型推导(Type Inference)</h3><p>和swift等语言类似，Dart也是支持类型推导的，类型推导声明变量的方式, 格式如下:</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span>/<span class="keyword">dynamic</span>/<span class="keyword">const</span>/<span class="keyword">final</span> 变量名称 = 赋值;</span><br></pre></td></tr></table></figure><h4 id="var的使用"><a href="#var的使用" class="headerlink" title="var的使用"></a>var的使用</h4><p>var的使用示例:</p><ul><li>runtimeType用于获取变量当前的类型</li></ul><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="keyword">name</span> = <span class="string">'eagle'</span>;</span><br><span class="line"><span class="keyword">name</span> = <span class="string">'ITYongzhen'</span>;</span><br><span class="line">print(<span class="keyword">name</span>.runtimeType); <span class="comment">// String</span></span><br></pre></td></tr></table></figure><p>var的错误用法:</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> age = <span class="number">18</span>;</span><br><span class="line">age = <span class="string">'eagle'</span>; <span class="comment">// 不可以将String赋值给一个int类型</span></span><br></pre></td></tr></table></figure><h4 id="dynamic的使用"><a href="#dynamic的使用" class="headerlink" title="dynamic的使用"></a>dynamic的使用</h4><p>如果确实希望这样做,可以使用dynamic来声明变量:</p><ul><li>但是在开发中, 通常情况下不使用dynamic, 因为类型的变量会带来潜在的危险</li></ul><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dynamic</span> <span class="keyword">name</span> = <span class="string">'eagle'</span>;</span><br><span class="line">print(<span class="keyword">name</span>.runtimeType); <span class="comment">// String</span></span><br><span class="line"><span class="keyword">name</span> = <span class="number">18</span>;</span><br><span class="line">print(<span class="keyword">name</span>.runtimeType); <span class="comment">// int</span></span><br></pre></td></tr></table></figure><h4 id="final-amp-const的使用"><a href="#final-amp-const的使用" class="headerlink" title="final&amp;const的使用"></a>final&amp;const的使用</h4><p>final和const都是用于定义常量的, 也就是定义之后值都不可以修改</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">final <span class="keyword">name</span> = <span class="string">'eagle'</span>;</span><br><span class="line"><span class="keyword">name</span> = <span class="string">'ITyongzhen'</span>; <span class="comment">// 错误做法</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> age = <span class="number">18</span>;</span><br><span class="line">age = <span class="number">20</span>; <span class="comment">// 错误做法</span></span><br></pre></td></tr></table></figure><h4 id="final和const的区别"><a href="#final和const的区别" class="headerlink" title="final和const的区别"></a>final和const的区别</h4><p>const在赋值时, 赋值的内容必须是在编译期间就确定下来的<br>final在赋值时, 可以动态获取, 比如赋值一个函数</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span> getName() &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'eagle'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="keyword">const</span> name = getName(); <span class="comment">// 错误的做法, 因为要执行函数才能获取到值</span></span><br><span class="line">  <span class="keyword">final</span> name = getName(); <span class="comment">// 正确的做法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>final和const小案例:</p><ul><li>首先, const是不可以赋值为DateTime.now()</li><li>其次, final一旦被赋值后就有确定的结果, 不会再次赋值</li></ul><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const time = DateTime.now(); // 错误的赋值方式</span></span><br><span class="line">final time = DateTime.now();</span><br><span class="line"><span class="keyword">print</span>(<span class="built_in">time</span>); <span class="comment">// 2020-02-05 12:04:50.052626</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sleep</span>(<span class="built_in">Duration</span>(seconds: <span class="number">2</span>));</span><br><span class="line"><span class="keyword">print</span>(<span class="built_in">time</span>); <span class="comment">// 2020-02-05 12:04:50.052626</span></span><br></pre></td></tr></table></figure><p>const放在赋值语句的右边，可以共享对象，提高性能:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> &#123;</span></span><br><span class="line">  <span class="function"><span class="keyword">const</span> <span class="title">Person</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main(List&lt;<span class="keyword">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="keyword">final</span> a = <span class="keyword">const</span> Person();</span><br><span class="line">  <span class="keyword">final</span> b = <span class="keyword">const</span> Person();</span><br><span class="line">  <span class="built_in">print</span>(identical(a, b)); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> m = Person();</span><br><span class="line">  <span class="keyword">final</span> n = Person();</span><br><span class="line">  <span class="built_in">print</span>(identical(m, n)); <span class="comment">// false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="数字类型"><a href="#数字类型" class="headerlink" title="数字类型"></a>数字类型</h3><h4 id="int和double"><a href="#int和double" class="headerlink" title="int和double"></a><code>int</code>和<code>double</code></h4><p>对于数值来说，我们也不用关心它是否有符号，以及数据的宽度和精度等问题。只要记着整数用<code>int</code>，浮点数用<code>double</code>就行了。<br>不过，要注意的是<code>Dart</code>中的<code>int</code>和<code>double</code>可表示的范围并不是固定的，它取决于运行Dart的平台。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.整数类型int</span></span><br><span class="line"><span class="keyword">int</span> age = <span class="number">18</span>;</span><br><span class="line"><span class="keyword">int</span> hexAge = <span class="number">0x12</span>;</span><br><span class="line"><span class="built_in">print</span>(age);</span><br><span class="line"><span class="built_in">print</span>(hexAge);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.浮点类型double</span></span><br><span class="line"><span class="keyword">double</span> <span class="built_in">height</span> = <span class="number">1.88</span>;</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">height</span>);</span><br></pre></td></tr></table></figure><h4 id="字符串和数字之间的转化"><a href="#字符串和数字之间的转化" class="headerlink" title="字符串和数字之间的转化"></a>字符串和数字之间的转化</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串和数字转化</span></span><br><span class="line"><span class="comment">// 1.字符串转数字</span></span><br><span class="line"><span class="keyword">var</span> one = <span class="built_in">int</span>.parse(<span class="string">'111'</span>);</span><br><span class="line"><span class="keyword">var</span> two = <span class="built_in">double</span>.parse(<span class="string">'12.22'</span>);</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;one&#125;</span> <span class="subst">$&#123;one.runtimeType&#125;</span>'</span>); <span class="comment">// 111 int</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;two&#125;</span> <span class="subst">$&#123;two.runtimeType&#125;</span>'</span>); <span class="comment">// 12.22 double</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.数字转字符串</span></span><br><span class="line"><span class="keyword">var</span> num1 = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">var</span> num2 = <span class="number">123.456</span>;</span><br><span class="line"><span class="keyword">var</span> num1Str = num1.toString();</span><br><span class="line"><span class="keyword">var</span> num2Str = num2.toString();</span><br><span class="line"><span class="keyword">var</span> num2StrD = num2.toStringAsFixed(<span class="number">2</span>); <span class="comment">// 保留两位小数</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;num1Str&#125;</span> <span class="subst">$&#123;num1Str.runtimeType&#125;</span>'</span>); <span class="comment">// 123 String</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;num2Str&#125;</span> <span class="subst">$&#123;num2Str.runtimeType&#125;</span>'</span>); <span class="comment">// 123.456 String</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;num2StrD&#125;</span> <span class="subst">$&#123;num2StrD.runtimeType&#125;</span>'</span>); <span class="comment">// 123.46 String</span></span><br></pre></td></tr></table></figure><h3 id="布尔类型"><a href="#布尔类型" class="headerlink" title="布尔类型"></a>布尔类型</h3><p>布尔类型中,Dart提供了一个bool的类型, 取值为true和false</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 布尔类型</span></span><br><span class="line"><span class="keyword">var</span> isFlag = <span class="keyword">true</span>;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$isFlag</span> <span class="subst">$&#123;isFlag.runtimeType&#125;</span>'</span>);</span><br></pre></td></tr></table></figure><p><strong>注意: Dart中不能判断非0即真, 或者非空即真</strong></p><p>Dart的类型安全性意味着您不能使用if(非booleanvalue)或assert(非booleanvalue)之类的代码。</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="keyword">message</span> = <span class="string">'Hello Dart'</span>;</span><br><span class="line"><span class="comment">// 错误的写法</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">message</span>) <span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  print(message)</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h3><p>Dart字符串是UTF-16编码单元的序列。您可以使用单引号或双引号创建一个字符串:</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.定义字符串的方式</span></span><br><span class="line"><span class="keyword">var</span> s1 = <span class="symbol">'Hello</span> <span class="type">World</span>';</span><br><span class="line"><span class="keyword">var</span> s2 = <span class="string">"Hello Dart"</span>;</span><br><span class="line"><span class="keyword">var</span> s3 = <span class="symbol">'Hello</span>\<span class="symbol">'Fullte</span>r';</span><br><span class="line"><span class="keyword">var</span> s4 = <span class="string">"Hello'Fullter"</span>;</span><br></pre></td></tr></table></figure><p>可以使用三个单引号或者双引号表示多行字符串:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> <span class="number">2</span>.表示多行字符串的方式</span><br><span class="line">var message1 = <span class="string">'''</span></span><br><span class="line"><span class="string">哈哈哈</span></span><br><span class="line"><span class="string">呵呵呵</span></span><br><span class="line"><span class="string">嘿嘿嘿'''</span>;</span><br></pre></td></tr></table></figure><p>字符串和其他变量或表达式拼接: 使用<code>${expression}</code>, 如果表达式是一个标识符, 那么<code>{}</code>可以省略</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.拼接其他变量</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">'eagle'</span>;</span><br><span class="line"><span class="keyword">var</span> age = <span class="number">18</span>;</span><br><span class="line"><span class="keyword">var</span> height = <span class="number">1.88</span>;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'my name is <span class="subst">$&#123;name&#125;</span>, age is <span class="subst">$age</span>, height is <span class="subst">$height</span>'</span>);</span><br></pre></td></tr></table></figure><h3 id="集合类型"><a href="#集合类型" class="headerlink" title="集合类型"></a>集合类型</h3><ul><li>集合类型的定义</li></ul><p>对于集合类型，Dart则内置了最常用的三种：<code>List / Set / Map</code>。<br>其中，<code>List</code>可以这样来定义</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// List定义</span></span><br><span class="line"><span class="comment">// 1.使用类型推导定义</span></span><br><span class="line"><span class="keyword">var</span> letters = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>];</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$letters</span> <span class="subst">$&#123;letters.runtimeType&#125;</span>'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.明确指定类型</span></span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$numbers</span> <span class="subst">$&#123;numbers.runtimeType&#125;</span>'</span>);</span><br></pre></td></tr></table></figure><p>其中，<code>set</code>可以这样来定义：</p><p>其实，也就是把[]换成{}就好了。<br>Set和List最大的两个不同就是：Set是无序的，并且元素是不重复的。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Set的定义</span></span><br><span class="line"><span class="comment">// 1.使用类型推导定义</span></span><br><span class="line"><span class="keyword">var</span> lettersSet = &#123;<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>&#125;;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$lettersSet</span> <span class="subst">$&#123;lettersSet.runtimeType&#125;</span>'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.明确指定类型</span></span><br><span class="line"><span class="built_in">Set</span>&lt;<span class="built_in">int</span>&gt; numbersSet = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$numbersSet</span> <span class="subst">$&#123;numbersSet.runtimeType&#125;</span>'</span>);</span><br></pre></td></tr></table></figure><p>最后，Map是我们常说的字典类型，它的定义是这样的：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map的定义</span></span><br><span class="line"><span class="comment">// 1.使用类型推导定义</span></span><br><span class="line"><span class="keyword">var</span> infoMap1 = &#123;<span class="string">'name'</span>: <span class="string">'eagle'</span>, <span class="string">'age'</span>: <span class="number">18</span>&#125;;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$infoMap1</span> <span class="subst">$&#123;infoMap1.runtimeType&#125;</span>'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.明确指定类型</span></span><br><span class="line"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt; infoMap2 = &#123;<span class="string">'height'</span>: <span class="number">1.88</span>, <span class="string">'address'</span>: <span class="string">'北京市'</span>&#125;;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$infoMap2</span> <span class="subst">$&#123;infoMap2.runtimeType&#125;</span>'</span>);</span><br></pre></td></tr></table></figure><h4 id="集合的常见操作"><a href="#集合的常见操作" class="headerlink" title="集合的常见操作"></a>集合的常见操作</h4><p>了解了这三个集合的定义方式之后，我们来看一些最基础的公共操作</p><p>第一类，是所有集合都支持的获取长度的属性length：</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取集合的长度</span></span><br><span class="line"><span class="keyword">print</span>(letters.length);</span><br><span class="line"><span class="keyword">print</span>(lettersSet.length);</span><br><span class="line"><span class="keyword">print</span>(infoMap1.length);</span><br></pre></td></tr></table></figure><p>第二类, 是添加/删除/包含操作</p><p>并且，对List来说，由于元素是有序的，它还提供了一个删除指定索引位置上元素的方法</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加/删除/包含元素</span></span><br><span class="line">numbers.add(<span class="number">5</span>);</span><br><span class="line">numbersSet.add(<span class="number">5</span>);</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$numbers</span> <span class="subst">$numbersSet</span>'</span>);</span><br><span class="line"></span><br><span class="line">numbers.remove(<span class="number">1</span>);</span><br><span class="line">numbersSet.remove(<span class="number">1</span>);</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$numbers</span> <span class="subst">$numbersSet</span>'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(numbers.contains(<span class="number">2</span>));</span><br><span class="line"><span class="built_in">print</span>(numbersSet.contains(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// List根据index删除元素</span></span><br><span class="line">numbers.removeAt(<span class="number">3</span>);</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$numbers</span>'</span>);</span><br></pre></td></tr></table></figure><p>第三类，是Map的操作</p><p>由于它有key和value，因此无论是读取值，还是操作，都要明确是基于key的，还是基于value的，或者是基于key/value对的。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map的操作</span></span><br><span class="line"><span class="comment">// 1.根据key获取value</span></span><br><span class="line"><span class="built_in">print</span>(infoMap1[<span class="string">'name'</span>]); <span class="comment">// eagle</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.获取所有的entries</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;infoMap1.entries&#125;</span> <span class="subst">$&#123;infoMap1.entries.runtimeType&#125;</span>'</span>); <span class="comment">// (MapEntry(name: eagle), MapEntry(age: 18)) MappedIterable&lt;String, MapEntry&lt;String, Object&gt;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.获取所有的keys</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;infoMap1.keys&#125;</span> <span class="subst">$&#123;infoMap1.keys.runtimeType&#125;</span>'</span>); <span class="comment">// (name, age) _CompactIterable&lt;String&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.获取所有的values</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;infoMap1.values&#125;</span> <span class="subst">$&#123;infoMap1.values.runtimeType&#125;</span>'</span>); <span class="comment">// (eagle, 18) _CompactIterable&lt;Object&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.判断是否包含某个key或者value</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;infoMap1.containsKey(<span class="string">'age'</span>)&#125;</span> <span class="subst">$&#123;infoMap1.containsValue(<span class="number">18</span>)&#125;</span>'</span>); <span class="comment">// true true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6.根据key删除元素</span></span><br><span class="line">infoMap1.remove(<span class="string">'age'</span>);</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;infoMap1&#125;</span>'</span>); <span class="comment">// &#123;name: eagle&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/Flutter学习之Dart语法(一).html/&quot;&gt;个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言
      
    
    </summary>
    
    
      <category term="Flutter" scheme="https://ityongzhen.github.io/categories/Flutter/"/>
    
    
  </entry>
  
  <entry>
    <title>Swift之下标</title>
    <link href="https://ityongzhen.github.io/Swift%E4%B9%8B%E4%B8%8B%E6%A0%87.html/"/>
    <id>https://ityongzhen.github.io/Swift%E4%B9%8B%E4%B8%8B%E6%A0%87.html/</id>
    <published>2019-10-30T00:32:24.000Z</published>
    <updated>2019-12-12T06:40:29.375Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/Swift%E4%B9%8B%E4%B8%8B%E6%A0%87.html">个人博客</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Swift中对枚举、结构体、类使用下标(subscript），就可以像使用数组一样来使用了</p><h2 id="使用规则"><a href="#使用规则" class="headerlink" title="使用规则"></a>使用规则</h2><ul><li>使用subscript可以给任意类型（枚举、结构体、类）增加下标功能，有些地方也翻译为：下标脚本</li><li>subscript的语法类似于实例方法、计算属性，本质就是方法（函数）</li></ul><p>例如下面的代码中，类<code>Point</code>中，的属性 x 和 y,可以用下标访问</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="type">Point</span> &#123;</span><br><span class="line">    var x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">    subscript(<span class="keyword">index</span>: <span class="type">Int</span>) -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">index</span> == <span class="number">0</span> &#123;</span><br><span class="line">                x = newValue</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">index</span> == <span class="number">1</span> &#123;</span><br><span class="line">                y = newValue</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">index</span> == <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> x</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">index</span> == <span class="number">1</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> y</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>访问的时候</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> <span class="selector-tag">p</span> = Point()</span><br><span class="line"><span class="selector-tag">p</span>[<span class="number">0</span>] = <span class="number">11.1</span></span><br><span class="line"><span class="selector-tag">p</span>[<span class="number">1</span>] = <span class="number">22.2</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(p.x)</span></span> <span class="comment">// 11.1</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(p.y)</span></span> <span class="comment">// 22.2</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(p[<span class="number">0</span>])</span></span> <span class="comment">// 11.1</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(p[<span class="number">1</span>])</span></span> <span class="comment">// 22.2</span></span><br></pre></td></tr></table></figure><h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h3><ul><li>subscript中定义的返回值类型决定了<ul><li>get方法的返回值类型</li><li>set方法中newValue的类型</li></ul></li><li>subscript可以接受多个参数，并且类型任意</li></ul><h3 id="subscript可以没有set方法"><a href="#subscript可以没有set方法" class="headerlink" title="subscript可以没有set方法"></a>subscript可以没有set方法</h3><p>例如下面的代码中，只提供了get，没有set</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">    subscript(index: <span class="built_in">Int</span>) -&gt; <span class="built_in">Double</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> index == <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> x</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> index == <span class="number">1</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> y</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>如果只有get方法，可以省略get</li></ul><p>上面的代码可以写成</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">Point</span> &#123;</span><br><span class="line">    var x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">    subscript(index: Int) -&gt; Double &#123;</span><br><span class="line">        <span class="keyword">if</span> index == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> index == <span class="number">1</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> y</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="可以设置参数标签"><a href="#可以设置参数标签" class="headerlink" title="可以设置参数标签"></a>可以设置参数标签</h3><p>例如下面的代码</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">Point</span> &#123;</span><br><span class="line">    var x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">    subscript(index i: Int) -&gt; Double &#123;</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> i == <span class="number">1</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> y</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用的时候</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> <span class="selector-tag">p</span> = Point()</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.y</span> = <span class="number">22.2</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(p[index: <span class="number">1</span>])</span></span> <span class="comment">// 22.2</span></span><br></pre></td></tr></table></figure><h3 id="下标可以是类型方法"><a href="#下标可以是类型方法" class="headerlink" title="下标可以是类型方法"></a>下标可以是类型方法</h3><p>如下</p><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sum</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> subscript(v1: <span class="keyword">Int</span>, v2: <span class="keyword">Int</span>) -&gt; <span class="keyword">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> v1 + v2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(Sum[<span class="number">10</span>, <span class="number">20</span>]) <span class="comment">// 30</span></span><br></pre></td></tr></table></figure><h2 id="结构体、类作为返回值对比"><a href="#结构体、类作为返回值对比" class="headerlink" title="结构体、类作为返回值对比"></a>结构体、类作为返回值对比</h2><h3 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h3><p>eg,如下代码,结构体Point，用了下标<code>subscript</code>只有get方法</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">struct <span class="type">Point</span> &#123;</span><br><span class="line">    var x = <span class="number">0</span>, y = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> PointManager &#123;</span><br><span class="line">    var <span class="type">point</span> = <span class="type">Point</span>()</span><br><span class="line">    subscript(<span class="keyword">index</span>: <span class="type">Int</span>) -&gt; <span class="type">Point</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="type">point</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用的时候报错</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">var </span><span class="string">pm </span>= <span class="string">PointManager(</span>)</span><br><span class="line"><span class="string">pm[</span>0].x = <span class="string">11 </span>//<span class="string">Cannot </span><span class="string">assign </span><span class="string">to </span><span class="string">property:</span> <span class="string">subscript </span><span class="string">is </span><span class="built_in">get-only</span></span><br><span class="line"><span class="built_in">//</span> 等价于 <span class="string">pm[</span>0] = <span class="string">Point(</span>x: <span class="string">11,</span> y: <span class="string">pm[</span>0].y)</span><br><span class="line"><span class="string">pm[</span>0].y = <span class="string">22/</span>/<span class="string">Cannot </span><span class="string">assign </span><span class="string">to </span><span class="string">property:</span> <span class="string">subscript </span><span class="string">is </span><span class="built_in">get-only</span></span><br></pre></td></tr></table></figure><h3 id="解决办法一"><a href="#解决办法一" class="headerlink" title="解决办法一"></a>解决办法一</h3><ul><li>加上set方法</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">struct <span class="type">Point</span> &#123;</span><br><span class="line">    var x = <span class="number">0</span>, y = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> PointManager &#123;</span><br><span class="line">    var <span class="type">point</span> = <span class="type">Point</span>()</span><br><span class="line">    subscript(<span class="keyword">index</span>: <span class="type">Int</span>) -&gt; <span class="type">Point</span> &#123;</span><br><span class="line">       <span class="keyword">set</span> &#123; <span class="type">point</span> = newValue &#125;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="type">point</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//下面使用正常</span><br><span class="line">var pm = PointManager()</span><br><span class="line">pm[<span class="number">0</span>].x = <span class="number">11</span></span><br><span class="line">// 等价于 pm[<span class="number">0</span>] = <span class="type">Point</span>(x: <span class="number">11</span>, y: pm[<span class="number">0</span>].y)</span><br><span class="line">pm[<span class="number">0</span>].y = <span class="number">22</span></span><br></pre></td></tr></table></figure><h3 id="解决办法二"><a href="#解决办法二" class="headerlink" title="解决办法二"></a>解决办法二</h3><p>结构体改成类</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">Point</span> &#123;</span><br><span class="line">    var x = <span class="number">0</span>, y = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="symbol">PointManager</span> &#123;</span><br><span class="line">    var point = Point()</span><br><span class="line">    subscript(index: Int) -&gt; Point &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; point &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面使用正常</span></span><br><span class="line">var pm = PointManager()</span><br><span class="line">pm[<span class="number">0</span>].x = <span class="number">11</span></span><br><span class="line"><span class="comment">// 等价于 pm[0] = Point(x: 11, y: pm[0].y)</span></span><br><span class="line">pm[<span class="number">0</span>].y = <span class="number">22</span></span><br></pre></td></tr></table></figure><h3 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h3><p>类是引用类型的，传递的是地址<br>结构体是值类型，传递的是具体的值</p><h2 id="接受多个参数的下标"><a href="#接受多个参数的下标" class="headerlink" title="接受多个参数的下标"></a>接受多个参数的下标</h2><p>eg,如下代码</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">Grid</span> &#123;</span><br><span class="line">    var data = [</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">        [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">        [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line">    ]</span><br><span class="line">    subscript(row: Int, column: Int) -&gt; Int &#123;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            guard row &gt;= <span class="number">0</span> &amp;&amp; row &lt; <span class="number">3</span> &amp;&amp; column &gt;= <span class="number">0</span> &amp;&amp; column &lt; <span class="number">3</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            data[row][column] = newValue</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            guard row &gt;= <span class="number">0</span> &amp;&amp; row &lt; <span class="number">3</span> &amp;&amp; column &gt;= <span class="number">0</span> &amp;&amp; column &lt; <span class="number">3</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> data[row][column]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如下使用</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var grid = Grid()</span><br><span class="line">grid[<span class="number">0</span>, <span class="number">1</span>] = <span class="number">77</span></span><br><span class="line">grid[<span class="number">1</span>, <span class="number">2</span>] = <span class="number">88</span></span><br><span class="line">grid[<span class="number">2</span>, <span class="number">0</span>] = <span class="number">99</span></span><br><span class="line">print(grid.data)</span><br></pre></td></tr></table></figure><p>输出为</p><blockquote><p>[[0, 77, 2], [3, 4, 88], [99, 7, 8]]</p></blockquote><p>参考资料:</p><p><a href="https://github.com/apple/Swift" target="_blank" rel="noopener">Swift官方源码</a></p><p><a href="https://ke.qq.com/course/392094" target="_blank" rel="noopener">从入门到精通Swift编程</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/Swift%E4%B9%8B%E4%B8%8B%E6%A0%87.html&quot;&gt;个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlin
      
    
    </summary>
    
    
      <category term="Swift" scheme="https://ityongzhen.github.io/categories/Swift/"/>
    
    
  </entry>
  
  <entry>
    <title>Swift之协议</title>
    <link href="https://ityongzhen.github.io/Swift%E4%B9%8B%E5%8D%8F%E8%AE%AE.html/"/>
    <id>https://ityongzhen.github.io/Swift%E4%B9%8B%E5%8D%8F%E8%AE%AE.html/</id>
    <published>2019-10-16T00:32:24.000Z</published>
    <updated>2019-12-12T06:37:26.102Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/Swift%E4%B9%8B%E5%8D%8F%E8%AE%AE.html">个人博客</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>协议，有关开发经验的应该都不陌生，很多语言中都有协议，但是相对来说，Swift中的协议更加强大，灵活。</p><ul><li>Swift中协议可以用来定义方法、属性、下标的声明，协议可以被枚举、结构体、类遵守（多个协议之间用逗号隔开）</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Drawable</span> </span>&#123;</span><br><span class="line">    <span class="comment">//方法</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">draw</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">//可读可写属性</span></span><br><span class="line">    <span class="keyword">var</span> x: <span class="type">Int</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">    <span class="comment">//只读属性</span></span><br><span class="line">    <span class="keyword">var</span> y: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 下标</span></span><br><span class="line">    <span class="keyword">subscript</span>(index: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>类<code>TestClass</code>准守多个协议</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">protocol Test1 &#123; &#125;</span><br><span class="line">protocol Test2 &#123; &#125;</span><br><span class="line">protocol Test3 &#123; &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">TestClass</span> : <span class="symbol">Test1, <span class="symbol">Test2</span>, <span class="symbol">Test3</span></span> &#123; &#125;</span><br></pre></td></tr></table></figure><h3 id="需要注意的是"><a href="#需要注意的是" class="headerlink" title="需要注意的是"></a>需要注意的是</h3><ul><li>协议中定义方法时不能有默认参数值</li><li>默认情况下，协议中定义的内容必须全部都实现</li><li>也有办法办到只实现部分内容，后面会说</li></ul><h2 id="协议中的属性"><a href="#协议中的属性" class="headerlink" title="协议中的属性"></a>协议中的属性</h2><ul><li>协议中定义属性时必须用var关键字</li><li>实现协议时的属性权限要不小于协议中定义的属性权限</li><li>协议定义get、set，用var存储属性或get、set计算属性去实现</li><li>协议定义get，用任何属性都可以实现</li></ul><p>eg：有协议<code>Drawable</code>,里面有方法<code>draw</code>，以及可读可写属性<code>x</code>，只读属性<code>y</code>，下标。其中属性必须用<code>var</code>关键字</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Drawable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">draw</span><span class="params">()</span></span> <span class="comment">//方法</span></span><br><span class="line">    <span class="keyword">var</span> x: <span class="type">Int</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125; <span class="comment">//可读可写 属性用var</span></span><br><span class="line">    <span class="keyword">var</span> y: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125; <span class="comment">//只读  属性用var</span></span><br><span class="line">    <span class="keyword">subscript</span>(index: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125; <span class="comment">//下标</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当实现的时候，有如下的方式，</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> : <span class="title">Drawable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x: <span class="type">Int</span> = <span class="number">0</span> <span class="comment">//用var的存储属性</span></span><br><span class="line">    <span class="keyword">let</span> y: <span class="type">Int</span> = <span class="number">0</span> <span class="comment">//let实现只读属性</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">draw</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Person draw"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">subscript</span>(index: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">set</span> &#123; &#125;</span><br><span class="line">        <span class="keyword">get</span> &#123; index &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当然了。也可以写成如下这种</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> : <span class="type">Drawable &#123;</span></span></span><br><span class="line">    <span class="keyword">var</span> x: <span class="built_in">Int</span> &#123; <span class="comment">//用计算属性</span></span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="number">0</span> &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> y: <span class="built_in">Int</span> &#123; <span class="number">0</span> &#125; <span class="comment">//var实现只读属性</span></span><br><span class="line">    func draw() &#123; print(<span class="string">"Person draw"</span>) &#125;</span><br><span class="line">    subscript(index: <span class="built_in">Int</span>) -&gt; <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">set</span> &#123; &#125;</span><br><span class="line">        <span class="keyword">get</span> &#123; index &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="static、class"><a href="#static、class" class="headerlink" title="static、class"></a>static、class</h2><ul><li>为了保证通用，协议中必须用static定义类型方法、类型属性、类型下标<ul><li>因为class只能用在类中，不能用于结构体等。所以为了通用，用static</li><li>但是实现的时候，可以用class，也可以用static，具体看自己的情况<br>eg:</li></ul></li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Drawable</span> </span>&#123;</span><br><span class="line"><span class="comment">//这里必须用static</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">draw</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person1</span> : <span class="title">Drawable</span> </span>&#123;</span><br><span class="line"><span class="comment">//这里可以用class</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">draw</span>() </span>&#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Person1 draw"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person2</span> : <span class="title">Drawable</span> </span>&#123;</span><br><span class="line"><span class="comment">//这里也可以用static</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">draw</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Person2 draw"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="mutating"><a href="#mutating" class="headerlink" title="mutating"></a>mutating</h2><p>关于<code>mutating</code>可以参考<a href="https://juejin.im/post/5d2ba7265188252d1d5f9218" target="_blank" rel="noopener">Swift之方法</a></p><ul><li>只有将协议中的实例方法标记为mutating<ul><li>才允许结构体、枚举的具体实现修改自身内存</li><li>类在实现方法时不用加mutating，枚举、结构体才需要加mutating</li></ul></li></ul><p>eg:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Drawable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">draw</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Size</span> : <span class="title">Drawable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> width: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">draw</span><span class="params">()</span></span> &#123;</span><br><span class="line">        width = <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> : <span class="title">Drawable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">draw</span><span class="params">()</span></span> &#123;</span><br><span class="line">        x = <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="init"><a href="#init" class="headerlink" title="init"></a>init</h2><ul><li>协议中还可以定义初始化器init<ul><li>非final类实现时必须加上required</li></ul></li></ul><p>可以这么理解，如果定义的类，有子类，那么子类必须准守初始化器init，所以加上关键字<code>required</code>,但是，如果一个被<code>final</code>修饰的类。就不用加上<code>required</code>.因为被<code>final</code>修饰的类不能被其他类继承。</p><p>关于<code>final</code>可参考<a href="https://juejin.im/post/5d2d9ebbe51d4510634318bf" target="_blank" rel="noopener">Swift之继承</a></p><p>eg: 有协议<code>Drawable</code>,里面定义了初始化器<code>init</code>，类Point遵守这个协议，所以在init 前面加了关键字 <code>required</code>,这样，继承类Point的子类都要实现这个方法，但是类Size没子类。因为加了关键字<code>final</code>，这个类不能被继承。所以<code>init</code>前面不用加<code>required</code></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">protocol Drawable &#123;</span><br><span class="line">    <span class="keyword">init</span>(x: <span class="built_in">Int</span>, y: <span class="built_in">Int</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> : <span class="type">Drawable &#123;</span></span></span><br><span class="line">    required <span class="keyword">init</span>(x: <span class="built_in">Int</span>, y: <span class="built_in">Int</span>) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Size</span> : <span class="type">Drawable &#123;</span></span></span><br><span class="line">    <span class="keyword">init</span>(x: <span class="built_in">Int</span>, y: <span class="built_in">Int</span>) &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>如果从协议实现的初始化器，刚好是重写了父类的指定初始化器<ul><li>那么这个初始化必须同时加required、override</li></ul></li></ul><p>eg:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">protocol Livable &#123;</span><br><span class="line">    <span class="keyword">init</span>(age: <span class="built_in">Int</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">init</span>(age: <span class="built_in">Int</span>) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> : <span class="type">Person</span>, <span class="type">Livable &#123;</span></span></span><br><span class="line">    required <span class="keyword">override</span> <span class="keyword">init</span>(age: <span class="built_in">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(age: age)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="init、init-、init"><a href="#init、init-、init" class="headerlink" title="init、init?、init!"></a>init、init?、init!</h2><ul><li>协议中定义的init?、init!，可以用init、init?、init!去实现</li><li>协议中定义的init，可以用init、init!去实现</li></ul><p>eg:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//协议</span></span><br><span class="line">protocol Livable &#123;</span><br><span class="line">    <span class="keyword">init</span>()</span><br><span class="line">    <span class="keyword">init</span>?(age: <span class="built_in">Int</span>)</span><br><span class="line">    <span class="keyword">init</span>!(no: <span class="built_in">Int</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> : <span class="type">Livable &#123;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//下面两种都可以实现init()</span></span><br><span class="line">    required <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line">    <span class="comment">// required init!() &#123; &#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//下面3种都可以实现init?(age: Int)</span></span><br><span class="line">    required <span class="keyword">init</span>?(age: <span class="built_in">Int</span>) &#123; &#125;</span><br><span class="line">    <span class="comment">// required init!(age: Int) &#123; &#125;</span></span><br><span class="line">    <span class="comment">// required init(age: Int) &#123; &#125;</span></span><br><span class="line">    </span><br><span class="line">     <span class="comment">//下面3种都可以实现 init!(no: Int)</span></span><br><span class="line">    required <span class="keyword">init</span>!(no: <span class="built_in">Int</span>) &#123; &#125;</span><br><span class="line">    <span class="comment">// required init?(no: Int) &#123; &#125;</span></span><br><span class="line">    <span class="comment">// required init(no: Int) &#123; &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="协议的继承"><a href="#协议的继承" class="headerlink" title="协议的继承"></a>协议的继承</h2><ul><li>一个协议可以继承其他协议</li></ul><p>eg</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 协议Runnable</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 协议Livable 继承协议 Runnable</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Livable</span> : <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">breath</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> : <span class="title">Livable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">breath</span><span class="params">()</span></span> &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="协议组合"><a href="#协议组合" class="headerlink" title="协议组合"></a>协议组合</h2><ul><li>协议组合，多个协议组合在一起，而且可以包含1个类类型（最多1个）</li></ul><p>eg: 两个协议<code>Livable</code>和<code>Runnable</code>,类<code>Person</code></p><figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">protocol <span class="keyword">Livable</span> &#123; &#125; <span class="keyword">n</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="keyword">Runnable</span> &#123; &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="keyword">Person</span> &#123; &#125;</span><br></pre></td></tr></table></figure><p>下面定义了fn0,接收参数必须是Person或者其子类的实例。fn1接收参数必须遵守Livable协议的实例，其他的可以自行看代码</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收Person或者其子类的实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn0</span><span class="params">(obj: Person)</span></span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收遵守Livable协议的实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn1</span><span class="params">(obj: Livable)</span></span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收同时遵守Livable、Runnable协议的实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn2</span><span class="params">(obj: Livable &amp; Runnable)</span></span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收同时遵守Livable、Runnable协议、并且是Person或者其子类的实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn3</span><span class="params">(obj: Person &amp; Livable &amp; Runnable)</span></span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">RealPerson</span> = <span class="type">Person</span> &amp; <span class="type">Livable</span> &amp; <span class="type">Runnable</span></span><br><span class="line"><span class="comment">// 接收同时遵守Livable、Runnable协议、并且是Person或者其子类的实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn4</span><span class="params">(obj: RealPerson)</span></span> &#123; &#125;</span><br></pre></td></tr></table></figure><h2 id="CaseIterable"><a href="#CaseIterable" class="headerlink" title="CaseIterable"></a>CaseIterable</h2><ul><li>让枚举遵守CaseIterable协议，可以实现遍历枚举值</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 枚举Season遵守协议CaseIterable</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Season</span> : <span class="title">CaseIterable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> spring, summer, autumn, winter</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取出所有的case</span></span><br><span class="line"><span class="keyword">let</span> seasons = <span class="type">Season</span>.allCases</span><br><span class="line"><span class="built_in">print</span>(seasons.<span class="built_in">count</span>) <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以遍历</span></span><br><span class="line"><span class="keyword">for</span> season <span class="keyword">in</span> seasons &#123;</span><br><span class="line">    <span class="built_in">print</span>(season)</span><br><span class="line">&#125; <span class="comment">// spring summer autumn winter</span></span><br></pre></td></tr></table></figure><h2 id="CustomStringConvertible"><a href="#CustomStringConvertible" class="headerlink" title="CustomStringConvertible"></a>CustomStringConvertible</h2><ul><li>遵守CustomStringConvertible协议，可以自定义实例的打印字符串</li></ul><p>eg: <code>Person</code>类遵守了<code>CustomStringConvertible</code>协议,可以再内部自定义打印<code>description</code>。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> : <span class="title">CustomStringConvertible</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> age: Int</span><br><span class="line">    <span class="keyword">var</span> name: <span class="built_in">String</span></span><br><span class="line">    init(age: Int, name: <span class="built_in">String</span>) &#123;</span><br><span class="line">        self.age = age</span><br><span class="line">        self.name = name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> description: <span class="built_in">String</span> &#123;</span><br><span class="line">        <span class="string">"age=\(age), name=\(name)"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = Person(age: <span class="number">10</span>, name: <span class="string">"Jack"</span>)</span><br><span class="line"><span class="built_in">print</span>(p) <span class="comment">// age=10, name=Jack</span></span><br></pre></td></tr></table></figure><h2 id="Any、AnyObject"><a href="#Any、AnyObject" class="headerlink" title="Any、AnyObject"></a>Any、AnyObject</h2><ul><li>Swift提供了2种特殊的类型：Any、AnyObject<ul><li>Any：可以代表任意类型（枚举、结构体、类，也包括函数类型）</li><li>AnyObject：可以代表任意类类型（在协议后面写上: AnyObject代表只有类能遵守这个协议）</li></ul></li></ul><p>eg: stu属于Any类型,可以赋值为字符串或者对象等</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var stu: <span class="attr">Any</span> = <span class="number">10</span></span><br><span class="line"><span class="attr">stu</span> = <span class="string">"Jack"</span></span><br><span class="line"><span class="attr">stu</span> = Student()</span><br></pre></td></tr></table></figure><p>eg: 创建1个能存放任意类型的数组</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建1个能存放任意类型的数组</span></span><br><span class="line"><span class="comment">// 第一种写法</span></span><br><span class="line"><span class="comment">// var data = Array&lt;Any&gt;()</span></span><br><span class="line"><span class="comment">// 第二种写法</span></span><br><span class="line"><span class="keyword">var</span> <span class="keyword">data</span> = [Any]()</span><br><span class="line"><span class="keyword">data</span>.append(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">data</span>.append(<span class="number">3.14</span>)</span><br><span class="line"><span class="keyword">data</span>.append(Student())</span><br><span class="line"><span class="keyword">data</span>.append(<span class="string">"Jack"</span>)</span><br><span class="line"><span class="keyword">data</span>.append(&#123; <span class="number">10</span> &#125;)</span><br></pre></td></tr></table></figure><h2 id="is、as-、as-、as"><a href="#is、as-、as-、as" class="headerlink" title="is、as?、as!、as"></a>is、as?、as!、as</h2><ul><li>is用来判断是否为某种类型，as用来做强制类型转换</li></ul><p>eg: 定义协议<code>Runnable</code>,类<code>Person</code>和类<code>Student</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Runnable</span> </span>&#123; <span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123; &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> : <span class="title">Person</span>, <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Student run"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">study</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Student study"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用is 的时候</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> stu: Any = <span class="number">10</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(stu is Int)</span></span> <span class="comment">// true</span></span><br><span class="line">stu = <span class="string">"Jack"</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(stu is String)</span></span> <span class="comment">// true</span></span><br><span class="line">stu = Student()</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(stu is Person)</span></span> <span class="comment">// true</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(stu is Student)</span></span> <span class="comment">// true</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(stu is Runnable)</span></span> <span class="comment">// t</span></span><br></pre></td></tr></table></figure><p>使用as 的时候,如果转换失败，后面都不执行。转换成功，后面才继续执行</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stu: Any = 10</span><br><span class="line">(stu <span class="keyword">as</span>? Student)?.study() <span class="comment">// 没有调用study</span></span><br><span class="line">stu = Student()</span><br><span class="line">(stu <span class="keyword">as</span>? Student)?.study() <span class="comment">// Student study</span></span><br><span class="line">(stu <span class="keyword">as</span>! Student).study() <span class="comment">// Student study</span></span><br><span class="line">(stu <span class="keyword">as</span>? Runnable)?.<span class="keyword">run</span>() <span class="comment">// Student run</span></span><br></pre></td></tr></table></figure><h2 id="X-self、X-Type、AnyClass"><a href="#X-self、X-Type、AnyClass" class="headerlink" title="X.self、X.Type、AnyClass"></a>X.self、X.Type、AnyClass</h2><ul><li>X.self是一个元类型（metadata）的指针，metadata存放着类型相关信息</li><li>X.self属于X.Type类型</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义类Person</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123; &#125;</span><br><span class="line"><span class="comment">// 定义类Student 继承 Person</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> : <span class="title">Person</span> </span>&#123; &#125;</span><br><span class="line"><span class="comment">//perType类型是 Person.Type</span></span><br><span class="line"><span class="keyword">var</span> perType: <span class="type">Person</span>.<span class="type">Type</span> = <span class="type">Person</span>.<span class="keyword">self</span></span><br><span class="line"><span class="comment">//stuType类型是 Student.Type</span></span><br><span class="line"><span class="keyword">var</span> stuType: <span class="type">Student</span>.<span class="type">Type</span> = <span class="type">Student</span>.<span class="keyword">self</span></span><br><span class="line"><span class="comment">// Student.self可以赋值给perType</span></span><br><span class="line">perType = <span class="type">Student</span>.<span class="keyword">self</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// anyType可以是任何类型</span></span><br><span class="line"><span class="keyword">var</span> anyType: <span class="type">AnyObject</span>.<span class="type">Type</span> = <span class="type">Person</span>.<span class="keyword">self</span></span><br><span class="line">anyType = <span class="type">Student</span>.<span class="keyword">self</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">AnyClass</span> = <span class="type">AnyObject</span>.<span class="type">Type</span></span><br><span class="line"><span class="comment">//anyType2可以是任何类型</span></span><br><span class="line"><span class="keyword">var</span> anyType2: <span class="type">AnyClass</span> = <span class="type">Person</span>.<span class="keyword">self</span></span><br><span class="line">anyType2 = <span class="type">Student</span>.<span class="keyword">self</span></span><br></pre></td></tr></table></figure><h2 id="元类型的应用"><a href="#元类型的应用" class="headerlink" title="元类型的应用"></a>元类型的应用</h2><p>eg:<code>Cat</code>类，<code>Dog</code>类，<code>Pig</code>类，都继承自<code>Animal</code>类，我们想同时去初始化，可使用下面的代码</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123; <span class="keyword">required</span> <span class="keyword">init</span>() &#123; &#125; &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> : <span class="title">Animal</span> </span>&#123; &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> : <span class="title">Animal</span> </span>&#123; &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pig</span> : <span class="title">Animal</span> </span>&#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">create</span><span class="params">(<span class="number">_</span> clses: [Animal.<span class="keyword">Type</span>])</span></span> -&gt; [<span class="type">Animal</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> arr = [<span class="type">Animal</span>]()</span><br><span class="line">    <span class="keyword">for</span> cls <span class="keyword">in</span> clses &#123;</span><br><span class="line">        <span class="comment">// 根据元类型初始化</span></span><br><span class="line">        arr.append(cls.<span class="keyword">init</span>())</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这里传入Cat,Dog,Pig进行初始化</span></span><br><span class="line"><span class="built_in">print</span>(create([<span class="type">Cat</span>.<span class="keyword">self</span>, <span class="type">Dog</span>.<span class="keyword">self</span>, <span class="type">Pig</span>.<span class="keyword">self</span>]))</span><br></pre></td></tr></table></figure><p><strong>注意上面的required不能省略</strong></p><ul><li>在OC、Java等语言中，任何一个类最终都要继承自某个基类，</li><li>在Swift中没有这个规定，如果一个类不继承任何一个类，那这个类就是基类</li></ul><p>实际上，真的如此么，真的不继承任何类么？</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> : <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> no: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(class_getInstanceSize(<span class="type">Student</span>.<span class="keyword">self</span>)) <span class="comment">// 32</span></span><br><span class="line"><span class="built_in">print</span>(class_getSuperclass(<span class="type">Student</span>.<span class="keyword">self</span>)!) <span class="comment">// Person</span></span><br><span class="line"><span class="built_in">print</span>(class_getSuperclass(<span class="type">Person</span>.<span class="keyword">self</span>)!) <span class="comment">// Swift._SwiftObject</span></span><br></pre></td></tr></table></figure><ul><li>从结果可以看得出来，Swift还有个隐藏的基类：Swift._SwiftObject</li><li>可以参考<a href="https://github.com/apple/swift/blob/master/stdlib/public/runtime/SwiftObjec.h" target="_blank" rel="noopener">Swift源码</a></li></ul><h2 id="Self"><a href="#Self" class="headerlink" title="Self"></a>Self</h2><ul><li>Self一般用作返回值类型，限定返回值跟方法调用者必须是同一类型（也可以作为参数类型）</li></ul><p>有点类似OC中的instanType的感觉。eg:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> -&gt; <span class="type">Self</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> : <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> -&gt; <span class="type">Self</span> &#123; type(of: <span class="keyword">self</span>).<span class="keyword">init</span>() &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> : <span class="title">Person</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure><p>调用时候</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> <span class="selector-tag">p</span> = Person()</span><br><span class="line"><span class="comment">// 输出Person</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(p.test()</span></span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">var</span> stu = Student()</span><br><span class="line"><span class="comment">// 输出Student</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(stu.test()</span></span>)</span><br></pre></td></tr></table></figure><p>参考资料：</p><p><a href="https://github.com/apple/Swift" target="_blank" rel="noopener">Swift官方源码</a></p><p><a href="https://ke.qq.com/course/392094" target="_blank" rel="noopener">从入门到精通Swift编程</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/Swift%E4%B9%8B%E5%8D%8F%E8%AE%AE.html&quot;&gt;个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlin
      
    
    </summary>
    
    
      <category term="Swift" scheme="https://ityongzhen.github.io/categories/Swift/"/>
    
    
  </entry>
  
  <entry>
    <title>汇编深入分析inout本质</title>
    <link href="https://ityongzhen.github.io/%E6%B1%87%E7%BC%96%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90inout%E6%9C%AC%E8%B4%A8.html/"/>
    <id>https://ityongzhen.github.io/%E6%B1%87%E7%BC%96%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90inout%E6%9C%AC%E8%B4%A8.html/</id>
    <published>2019-09-28T00:32:24.000Z</published>
    <updated>2019-12-12T06:32:35.057Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/%E6%B1%87%E7%BC%96%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90inout%E6%9C%AC%E8%B4%A8.html">个人博客</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>关于<code>输入输出参数inout</code> 在<a href="https://juejin.im/post/5d1eec54f265da1bb27750ba" target="_blank" rel="noopener">Swift之函数</a>一文中，我们已经有了初步的认识。现在我们再继续深入了解一下</p><h2 id="输入输出参数"><a href="#输入输出参数" class="headerlink" title="输入输出参数"></a>输入输出参数</h2><ul><li>说了形参只能是let，但是如果我们想再内部修改外部实参的值，可以用 inout 定义输入输出参数</li></ul><p>例如</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">func swapValues(_ v1: <span class="keyword">inout</span> Int, _ v2: <span class="keyword">inout</span> Int) &#123;</span><br><span class="line">     let tmp = v1</span><br><span class="line">     v1 = v2</span><br><span class="line">     v2 = tmp</span><br><span class="line">     <span class="comment">//前面三行也可以换成  (v1, v2) = (v2, v1) 效果一样</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line">  var num1 = <span class="number">10</span></span><br><span class="line">  var num2 = <span class="number">20</span></span><br><span class="line">  swapValues(&amp;num1, &amp;num2)</span><br><span class="line"> print(<span class="string">"num1 = \(num1), num2 = \(num2)"</span>)</span><br><span class="line">    </span><br><span class="line">  输出： num1 = <span class="number">20</span>, num2 = <span class="number">10</span></span><br></pre></td></tr></table></figure><p>注意点:</p><ul><li>可变参数不能标记为inout</li><li>inout参数不能有默认值</li><li>inout参数的本质是地址传递(引用传递)</li><li>inout参数只能传入可以被多次赋值的</li></ul><h2 id="准备代码"><a href="#准备代码" class="headerlink" title="准备代码"></a>准备代码</h2><p><code>inout</code> 是地址传递，对于不同的情况具体怎么传递呢？汇编拨开云雾</p><p>如下代码，表示等边的多边形，其中<code>width</code>表示边长，<code>side</code>表示多边形边长数量 <code>girth</code>表示周长，我们知道 <code>周长 = 边长 * 边数</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 宽、边长</span></span><br><span class="line">    <span class="keyword">var</span> width: <span class="type">Int</span></span><br><span class="line">    <span class="comment">// 边的数量</span></span><br><span class="line">    <span class="keyword">var</span> side: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"willSetSide"</span>, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"didSetSide"</span>, oldValue, side)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 周长</span></span><br><span class="line">    <span class="keyword">var</span> girth: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="comment">// 边长 = 周长 / 边数</span></span><br><span class="line">            width = newValue / side</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"setGirth"</span>, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"getGirth"</span>)</span><br><span class="line">            <span class="comment">// 周长 = 边长 * 边数</span></span><br><span class="line">            <span class="keyword">return</span> width * side</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"width=\(width), side=\(side), girth=\(girth)"</span>)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(<span class="number">_</span> num: <span class="keyword">inout</span> Int)</span></span> &#123;</span><br><span class="line"> <span class="built_in">print</span>(<span class="string">"test"</span>);</span><br><span class="line">    num = <span class="number">8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="inout-修改存储属性"><a href="#inout-修改存储属性" class="headerlink" title="inout 修改存储属性"></a>inout 修改存储属性</h2><h3 id="先看打印结果"><a href="#先看打印结果" class="headerlink" title="先看打印结果"></a>先看打印结果</h3><p> 如下代码</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 宽、边长</span></span><br><span class="line">    <span class="keyword">var</span> width: <span class="type">Int</span></span><br><span class="line">    <span class="comment">// 边的数量</span></span><br><span class="line">    <span class="keyword">var</span> side: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"willSetSide"</span>, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"didSetSide"</span>, oldValue, side)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 周长</span></span><br><span class="line">    <span class="keyword">var</span> girth: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="comment">// 边长 = 周长 / 边数</span></span><br><span class="line">            width = newValue / side</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"setGirth"</span>, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"getGirth"</span>)</span><br><span class="line">            <span class="comment">// 周长 = 边长 * 边数</span></span><br><span class="line">            <span class="keyword">return</span> width * side</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"width=\(width), side=\(side), girth=\(girth)"</span>)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(<span class="number">_</span> num: <span class="keyword">inout</span> Int)</span></span> &#123;</span><br><span class="line"> <span class="built_in">print</span>(<span class="string">"test"</span>);</span><br><span class="line">    num = <span class="number">8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s = <span class="type">Shape</span>(width: <span class="number">10</span>, side: <span class="number">4</span>)</span><br><span class="line">test(&amp;s.width) <span class="comment">//这里打断点</span></span><br><span class="line">s.show()</span><br></pre></td></tr></table></figure><p>打印结果为</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test</span><br><span class="line">getGirth</span><br><span class="line">width=8, side=4, girth=32</span><br></pre></td></tr></table></figure><p>其中<code>getGirth</code>这句打印是因为后面的<code>show</code>方法需要获取<code>girth</code>的值，如果我们去掉最后一句,只有如下代码</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> s = Shape(<span class="attribute">width</span>: <span class="number">10</span>, side: <span class="number">4</span>)</span><br><span class="line"><span class="function"><span class="title">test</span><span class="params">(&amp;s.width)</span></span></span><br></pre></td></tr></table></figure><p>输出为</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span></span><br></pre></td></tr></table></figure><h3 id="汇编分析"><a href="#汇编分析" class="headerlink" title="汇编分析"></a>汇编分析</h3><p>在上面代码中的 <code>test(&amp;s.width)</code>这一句打断点</p><p><img src="https://user-gold-cdn.xitu.io/2019/7/17/16bfcef672deebf0?w=1172&h=650&f=png&s=295179" alt=""></p><p>关键代码为</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//全局变量0x44be(%rip)的地址给寄存器rdi，rdi是全局变量s的地址</span></span><br><span class="line"> <span class="number">0x100000fbb</span> &lt;+<span class="number">107</span>&gt;: leaq   <span class="number">0x44be</span>(%rip), %rdi        ; testSwift.s : testSwift.Shape</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用test函数，其中rdi作为参数传入</span></span><br><span class="line"><span class="number">0x100000fc2</span> &lt;+<span class="number">114</span>&gt;: callq  <span class="number">0x100001930</span>               ; testSwift.test(<span class="keyword">inout</span> Swift.Int) -&gt; () at main.swift:<span class="number">44</span></span><br></pre></td></tr></table></figure><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p> <strong>把属性<code>s.width</code>的地址值传递过去，进行修改</strong></p><ul><li>全局变量0x44be(%rip)的地址给寄存器rdi，rdi是全局变量s的地址</li><li>调用test函数，其中rdi作为参数传入</li></ul><ul><li><p>为什么我们代码中写的是 s.width ，但汇编传入的是s的地址呢？</p><ul><li>因为，width作为结构体的第一个属性变量，它的地址就是结构体s的地址</li></ul></li><li><p>为什么rdi是作为参数呢？</p><ul><li><a href="https://juejin.im/post/5d19f9816fb9a07f0a2df848" target="_blank" rel="noopener">汇编总结</a>中我们知道 rdi、rsi、rdx、rcx、r8、r9等寄存器常用于存放函数参数。</li></ul></li></ul><h2 id="inout-修改带有属性观察器的存储属性"><a href="#inout-修改带有属性观察器的存储属性" class="headerlink" title="inout 修改带有属性观察器的存储属性"></a>inout 修改带有属性观察器的存储属性</h2><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>首先分析一下，应该和前面存储属性不一样的，因为如果直接修改存储属性<code>side</code>的值，那怎么调动属性观察器的方法<code>willSet</code>和<code>didSet</code>呢？，</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 宽、边长</span></span><br><span class="line">    <span class="keyword">var</span> width: <span class="type">Int</span></span><br><span class="line">    <span class="comment">// 边的数量</span></span><br><span class="line">    <span class="keyword">var</span> side: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"willSetSide"</span>, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"didSetSide"</span>, oldValue, side)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 周长</span></span><br><span class="line">    <span class="keyword">var</span> girth: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="comment">// 边长 = 周长 / 边数</span></span><br><span class="line">            width = newValue / side</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"setGirth"</span>, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"getGirth"</span>)</span><br><span class="line">            <span class="comment">// 周长 = 边长 * 边数</span></span><br><span class="line">            <span class="keyword">return</span> width * side</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"width=\(width), side=\(side), girth=\(girth)"</span>)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(<span class="number">_</span> num: <span class="keyword">inout</span> Int)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"test"</span>);</span><br><span class="line">    num = <span class="number">8</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s = <span class="type">Shape</span>(width: <span class="number">10</span>, side: <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">test(&amp;s.side) <span class="comment">//这里打断点</span></span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test</span><br><span class="line">willSetSide 8</span><br><span class="line">didSetSide 4 8</span><br></pre></td></tr></table></figure><h3 id="查看汇编"><a href="#查看汇编" class="headerlink" title="查看汇编"></a>查看汇编</h3><p><img src="https://user-gold-cdn.xitu.io/2019/7/17/16bfcef673dc1585?w=2092&h=1244&f=png&s=814277" alt=""></p><p>关键汇编代码分析</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//全局变量0x44e4(%rip)的地址给寄存器rdi，地址是testSwift.Shape + 8也就是size的地址</span></span><br><span class="line"><span class="number">0x100000f9d</span> &lt;+<span class="number">109</span>&gt;: movq   <span class="number">0x44e4</span>(%rip), %rax        ; testSwift.s : testSwift.Shape + <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//size的地址给局部变量-0x28(%rbp)</span></span><br><span class="line"><span class="number">0x100000fa4</span> &lt;+<span class="number">116</span>&gt;: movq   %rax, <span class="number">-0x28</span>(%rbp)</span><br><span class="line"></span><br><span class="line"><span class="comment">//局部变量-0x28(%rbp)的值给寄存器 %rdi</span></span><br><span class="line"><span class="number">0x100000fa8</span> &lt;+<span class="number">120</span>&gt;: leaq   <span class="number">-0x28</span>(%rbp), %rdi</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用test函数，寄存器 %rdi作为参数传入</span></span><br><span class="line"><span class="number">0x100000fac</span> &lt;+<span class="number">124</span>&gt;: callq  <span class="number">0x100001930</span>               ; testSwift.test(<span class="keyword">inout</span> Swift.Int) -&gt; () at main.swift:<span class="number">44</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//此时已经修改完了局部变量 -0x28(%rbp)对应的值 并把局部变量 -0x28(%rbp)的值传给rdi,</span></span><br><span class="line"><span class="number">0x100000fb1</span> &lt;+<span class="number">129</span>&gt;: movq   <span class="number">-0x28</span>(%rbp), %rdi</span><br><span class="line"><span class="number">0x100000fb5</span> &lt;+<span class="number">133</span>&gt;: leaq   <span class="number">0x44c4</span>(%rip), %r13        ; testSwift.s : testSwift.Shape</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//从截图中也可以看到此时%rdi里面是8，也就是 test函数中的  num = 8</span></span><br><span class="line"><span class="number">0x100000fbc</span> &lt;+<span class="number">140</span>&gt;: callq  <span class="number">0x100001240</span>               ; testSwift.Shape.side.setter : Swift.Int at &lt;compiler-generated&gt;</span><br></pre></td></tr></table></figure><h3 id="testSwift-Shape-side-setter函数中，调用side-willset-和-side-didset"><a href="#testSwift-Shape-side-setter函数中，调用side-willset-和-side-didset" class="headerlink" title="testSwift.Shape.side.setter函数中，调用side.willset 和 side.didset"></a><code>testSwift.Shape.side.setter</code>函数中，调用<code>side.willset</code> 和 <code>side.didset</code></h3><p><img src="https://user-gold-cdn.xitu.io/2019/7/17/16bfcef675ec0101?w=1988&h=1154&f=png&s=538327" alt=""></p><h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><p>对于带有属性观察器的存储属性<code>size</code></p><ul><li>首先把<code>size</code>的地址放在一个局部变量中</li><li>然后调用<code>test</code>方法，把局部变量的值修改</li><li>再把局部变量传入到<code>setter</code>方法中，真正的修改计算属性<code>size</code></li></ul><h2 id="inout-修改计算属性girth"><a href="#inout-修改计算属性girth" class="headerlink" title="inout 修改计算属性girth"></a>inout 修改计算属性<code>girth</code></h2><h3 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h3><p>首先分析一下，应该和前面存储属性不一样的，因为计算属性<code>girth</code>没有自己的内存地址，</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 宽、边长</span></span><br><span class="line">    <span class="keyword">var</span> width: <span class="type">Int</span></span><br><span class="line">    <span class="comment">// 边的数量</span></span><br><span class="line">    <span class="keyword">var</span> side: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"willSetSide"</span>, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"didSetSide"</span>, oldValue, side)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 周长</span></span><br><span class="line">    <span class="keyword">var</span> girth: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="comment">// 边长 = 周长 / 边数</span></span><br><span class="line">            width = newValue / side</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"setGirth"</span>, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"getGirth"</span>)</span><br><span class="line">            <span class="comment">// 周长 = 边长 * 边数</span></span><br><span class="line">            <span class="keyword">return</span> width * side</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"width=\(width), side=\(side), girth=\(girth)"</span>)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(<span class="number">_</span> num: <span class="keyword">inout</span> Int)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"test"</span>);</span><br><span class="line">    num = <span class="number">8</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s = <span class="type">Shape</span>(width: <span class="number">10</span>, side: <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">test(&amp;s.girth) <span class="comment">//这里打断点</span></span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getGirth</span><br><span class="line">test</span><br><span class="line">setGirth 8</span><br></pre></td></tr></table></figure><h3 id="查看汇编-1"><a href="#查看汇编-1" class="headerlink" title="查看汇编"></a>查看汇编</h3><p><img src="https://user-gold-cdn.xitu.io/2019/7/17/16bfcef676ac3806?w=2008&h=1198&f=png&s=568740" alt=""></p><h3 id="汇编分析-1"><a href="#汇编分析-1" class="headerlink" title="汇编分析"></a>汇编分析</h3><p>关键汇编代码分析</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 调用testSwift.Shape.girth.getter 方法，返回值放在rax中</span></span><br><span class="line"><span class="number">0x100000fab</span> &lt;+<span class="number">123</span>&gt;: callq  <span class="number">0x100001580</span>               ; testSwift.Shape.girth.getter : Swift.Int at main.swift:<span class="number">33</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 把getter的返回值放在 局部变量-0x28(%rbp)中</span></span><br><span class="line"><span class="number">0x100000fb0</span> &lt;+<span class="number">128</span>&gt;: movq   %rax, <span class="number">-0x28</span>(%rbp)</span><br><span class="line"></span><br><span class="line"><span class="comment">//局部变量-0x28(%rbp)的地址值 放在寄存器rdi</span></span><br><span class="line"><span class="number">0x100000fb4</span> &lt;+<span class="number">132</span>&gt;: leaq   <span class="number">-0x28</span>(%rbp), %rdi</span><br><span class="line"></span><br><span class="line"><span class="comment">//寄存器rdi的地址值传到testSwift.test函数中，进行修改</span></span><br><span class="line"><span class="number">0x100000fb8</span> &lt;+<span class="number">136</span>&gt;: callq  <span class="number">0x100001930</span>               ; testSwift.test(<span class="keyword">inout</span> Swift.Int) -&gt; () at main.swift:<span class="number">44</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 局部变量-0x28(%rbp)的值，传到寄存器rdi中</span></span><br><span class="line"><span class="number">0x100000fbd</span> &lt;+<span class="number">141</span>&gt;: movq   <span class="number">-0x28</span>(%rbp), %rdi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">0x100000fc1</span> &lt;+<span class="number">145</span>&gt;: leaq   <span class="number">0x44b8</span>(%rip), %r13        ; testSwift.s : testSwift.Shape</span><br><span class="line"></span><br><span class="line"><span class="comment">// 寄存器rdi里面放的是局部变量-0x28(%rbp)的值 传入到Shape.girth.setter中</span></span><br><span class="line"><span class="number">0x100000fc8</span> &lt;+<span class="number">152</span>&gt;: callq  <span class="number">0x1000012f0</span>               ;  testSwift.Shape.girth.setter : Swift.Int at main.swift:<span class="number">28</span></span><br></pre></td></tr></table></figure><h3 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h3><p>因为计算属性本身没有地址值，所以过程略显复杂</p><p>对于<code>inout</code>修改计算属性<code>girth</code></p><ul><li>首先调用<code>getter</code>方法，把返回值放在一个局部变量中</li><li>然后调用<code>test</code>方法，把局部变量的值修改</li><li>再把局部变量传入到<code>setter</code>方法中，真正的修改计算属性<code>girth</code></li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="针对本文代码的总结"><a href="#针对本文代码的总结" class="headerlink" title="针对本文代码的总结"></a>针对本文代码的总结</h3><p>输入输出参数inout 本质就是引用传递，也就是地址传递，根据传过来的地址，修改对应的值。针对不同的情况，其他处理不同，</p><ul><li>普通存储属性，直接把地址值传过来修改就可以了。</li><li>对于<code>inout</code>带有属性观察器的存储属性<code>size</code><ul><li>首先把<code>size</code>的地址放在一个局部变量中</li><li>然后调用<code>test</code>方法，把局部变量的值修改</li><li>再把局部变量传入到<code>setter</code>方法中，真正的修改计算属性<code>size</code></li></ul></li><li>对于<code>inout</code>修改计算属性<code>girth</code><ul><li>首先调用<code>getter</code>方法，把返回值放在一个局部变量中</li><li>然后调用<code>test</code>方法，把局部变量的值修改</li><li>再把局部变量传入到<code>setter</code>方法中，真正的修改计算属性<code>girth</code></li></ul></li></ul><h3 id="针对inout的总结"><a href="#针对inout的总结" class="headerlink" title="针对inout的总结"></a>针对inout的总结</h3><ul><li>如果实参有物理内存地址，且没有设置属性观察器    <ul><li>直接将实参的内存地址传入函数（实参进行引用传递）</li><li>如果实参是计算属性 或者 设置了属性观察器</li></ul></li><li>采取了Copy In Copy Out的做法<ul><li>调用该函数时，先复制实参的值，产生副本【get】</li><li>将副本的内存地址传入函数（副本进行引用传递），在函数内部可以修改副本的值</li><li>函数返回后，再将副本的值覆盖实参的值【set】</li></ul></li><li>总结：inout的本质就是引用传递（地址传递）</li></ul><p>参考资料:</p><p><a href="https://github.com/apple/Swift" target="_blank" rel="noopener">Swift官方源码</a></p><p><a href="https://ke.qq.com/course/392094" target="_blank" rel="noopener">从入门到精通Swift编程</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/%E6%B1%87%E7%BC%96%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90inout%E6%9C%AC%E8%B4%A8.html&quot;&gt;个人博客&lt;/a&gt;&lt;/
      
    
    </summary>
    
    
      <category term="Swift" scheme="https://ityongzhen.github.io/categories/Swift/"/>
    
    
  </entry>
  
  <entry>
    <title>Swift之继承</title>
    <link href="https://ityongzhen.github.io/Swift%E4%B9%8B%E7%BB%A7%E6%89%BF.html/"/>
    <id>https://ityongzhen.github.io/Swift%E4%B9%8B%E7%BB%A7%E6%89%BF.html/</id>
    <published>2019-09-18T00:32:24.000Z</published>
    <updated>2019-12-12T06:31:53.459Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/Swift%E4%B9%8B%E7%BB%A7%E6%89%BF.html">个人博客</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>同其他语言一样，Swift中也是有继承的</p><ul><li>值类型（枚举、结构体）不支持继承，只有类支持继承</li><li>没有父类的类，称为：基类<ul><li>Swift并没有像OC、Java那样的规定：任何类最终都要继承自某个基类</li></ul></li><li>子类可以重写父类的下标、方法、属性，重写必须加上<code>override</code>关键字</li></ul><h2 id="类继承的内存结构"><a href="#类继承的内存结构" class="headerlink" title="类继承的内存结构"></a>类继承的内存结构</h2><ul><li>有如下<code>Animal类</code>,其中<code>Dog 类</code>继承<code>Animal类</code> ，其中<code>ErHa 类</code>继承<code>Dog类</code></li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">Animal</span> &#123;</span><br><span class="line">    var age = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Dog</span> : <span class="symbol">Animal</span> &#123;</span><br><span class="line">    var weight = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="symbol">ErHa</span> : <span class="symbol">Dog</span> &#123;</span><br><span class="line">    var iq = <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Animal类的内存"><a href="#Animal类的内存" class="headerlink" title="Animal类的内存"></a><code>Animal类</code>的内存</h3><p>如下代码查看类的内存大小和相应内存的值，需要用到工具<a href="https://github.com/CoderMJLee/Mems" target="_blank" rel="noopener">Mems</a><br>关于的使用可以看<a href="https://juejin.im/post/5d1eeca3f265da1ba6480cc7" target="_blank" rel="noopener">Swift之枚举</a>一文，或者直接看github上<a href="https://github.com/CoderMJLee/Mems" target="_blank" rel="noopener">Mems</a>的说明</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="constructor">Animal()</span></span><br><span class="line">a.age = <span class="number">5</span></span><br><span class="line">print(<span class="module-access"><span class="module"><span class="identifier">Mems</span>.</span></span>size(ofRef: a))</span><br><span class="line">print(<span class="module-access"><span class="module"><span class="identifier">Mems</span>.</span></span>mem<span class="constructor">Str(<span class="params">ofRef</span>: <span class="params">a</span>)</span>)</span><br></pre></td></tr></table></figure><p><code>Animal类</code>的内存大小和内容，分别为</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">32</span></span><br><span class="line"><span class="number">0x00000001000084d8</span> <span class="comment">//存放类的相关信息</span></span><br><span class="line"><span class="number">0x0000000000000002</span> <span class="comment">//引用技术</span></span><br><span class="line"><span class="number">0x0000000000000005</span>  <span class="comment">// age数值5</span></span><br><span class="line"><span class="number">0x0000000000000000</span><span class="comment">//没用到</span></span><br></pre></td></tr></table></figure><h3 id="Animal类的内存分析"><a href="#Animal类的内存分析" class="headerlink" title="Animal类的内存分析"></a><code>Animal类</code>的内存分析</h3><ul><li>首先类本身就要占用16个字节，其中8个存放类的信息，8个存放引用技术，具体分析见<a href="https://juejin.im/post/5d216d6bf265da1b957079d8" target="_blank" rel="noopener">Swift之类</a></li><li>然后是 age的值5 占用8个字节，总共24个字节，</li><li>因为内存对齐的原因，必须是16的倍数，所以需要32个字节，其中最后8个字节用不到，全是0</li></ul><h3 id="Dog类的内存"><a href="#Dog类的内存" class="headerlink" title="Dog类的内存"></a><code>Dog类</code>的内存</h3><p>如下代码查看类的内存大小和相应内存的值</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> d = <span class="constructor">Dog()</span></span><br><span class="line">d.age = <span class="number">6</span></span><br><span class="line">d.weight = <span class="number">7</span></span><br><span class="line">print(<span class="module-access"><span class="module"><span class="identifier">Mems</span>.</span></span>size(ofRef: d))</span><br><span class="line">print(<span class="module-access"><span class="module"><span class="identifier">Mems</span>.</span></span>mem<span class="constructor">Str(<span class="params">ofRef</span>: <span class="params">d</span>)</span>)</span><br></pre></td></tr></table></figure><p><code>Dog类</code>的内存大小和内容，分别为</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">32</span></span><br><span class="line"><span class="number">0x0000000100008588</span> <span class="comment">//存放类的相关信息</span></span><br><span class="line"><span class="number">0x0000000000000002</span> <span class="comment">//引用技术</span></span><br><span class="line"><span class="number">0x0000000000000006</span>  <span class="comment">// age数值6</span></span><br><span class="line"><span class="number">0x0000000000000007</span><span class="comment">//weight的值7</span></span><br></pre></td></tr></table></figure><h3 id="Dog类的内存分析"><a href="#Dog类的内存分析" class="headerlink" title="Dog类的内存分析"></a><code>Dog类</code>的内存分析</h3><ul><li>首先类本身就要占用16个字节，其中8个存放类的信息，8个存放引用技术，具体分析见<a href="https://juejin.im/post/5d216d6bf265da1b957079d8" target="_blank" rel="noopener">Swift之类</a></li><li>然后是 age的值6 占用8个字节，weight的值7 占用8个字节， 总共32个字节，</li><li>因为内存对齐的原因，必须是16的倍数，但是32正好是16的倍数，所以总共需要32个字</li></ul><h3 id="ErHa类的内存"><a href="#ErHa类的内存" class="headerlink" title="ErHa类的内存"></a><code>ErHa类</code>的内存</h3><p>如下代码查看类的内存大小和相应内存的值</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> e = <span class="constructor">ErHa()</span></span><br><span class="line">e.age = <span class="number">8</span></span><br><span class="line">e.weight = <span class="number">9</span></span><br><span class="line">e.iq = <span class="number">10</span></span><br><span class="line">print(<span class="module-access"><span class="module"><span class="identifier">Mems</span>.</span></span>size(ofRef: e))</span><br><span class="line">print(<span class="module-access"><span class="module"><span class="identifier">Mems</span>.</span></span>mem<span class="constructor">Str(<span class="params">ofRef</span>: <span class="params">e</span>)</span>)</span><br></pre></td></tr></table></figure><p><code>ErHa类</code>的内存大小和内容，分别为</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">48</span></span><br><span class="line"><span class="number">0x0000000100008658</span> <span class="comment">//存放类的相关信息</span></span><br><span class="line"><span class="number">0x0000000000000002</span> <span class="comment">//引用技术</span></span><br><span class="line"><span class="number">0x0000000000000008</span>  <span class="comment">// age数值8</span></span><br><span class="line"><span class="number">0x0000000000000009</span><span class="comment">//weight的值9</span></span><br><span class="line"><span class="number">0x000000000000000a</span><span class="comment">//iq的值10</span></span><br><span class="line"><span class="number">0x0000000000000000</span><span class="comment">//内存对齐增加的，没用到</span></span><br></pre></td></tr></table></figure><h3 id="ErHa类的内存分析"><a href="#ErHa类的内存分析" class="headerlink" title="ErHa类的内存分析"></a><code>ErHa类</code>的内存分析</h3><ul><li>首先类本身就要占用16个字节，其中8个存放类的信息，8个存放引用技术，具体分析见<a href="https://juejin.im/post/5d216d6bf265da1b957079d8" target="_blank" rel="noopener">Swift之类</a></li><li>然后是 age,weight,iq分别占用8个字节，16+24 = 40个字节了</li><li>因为内存对齐的原因，必须是16的倍数，所以需要48个字节</li></ul><h2 id="重写实例方法、下标"><a href="#重写实例方法、下标" class="headerlink" title="重写实例方法、下标"></a>重写实例方法、下标</h2><p>子类可以重写父类的实例方法、下标</p><p>有个<code>Animal</code> 类</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">speak</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Animal speak"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">subscript</span>(index: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> index</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>子类<code>Cat</code>继承<code>Animal</code>,如果重写示例方法，下标，必须用关键字<code>override</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">speak</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Animal speak"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">subscript</span>(index: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> index</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> : <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">speak</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.speak()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Cat speak"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">subscript</span>(index: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>[index] + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="重写类型方法、下标"><a href="#重写类型方法、下标" class="headerlink" title="重写类型方法、下标"></a>重写类型方法、下标</h2><p>上面的实例方法、下标。如果是类型方法、下标的话，有些许不同，</p><ul><li>被class修饰的类型方法、下标，允许被子类重写</li><li>被static修饰的类型方法、下标，不允许被子类重写</li></ul><p>eg</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line"><span class="comment">//static修饰</span></span><br><span class="line">    static func speak() &#123;</span><br><span class="line">        print(<span class="string">"Animal speak"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// class修饰</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">subscript</span></span>(index: <span class="built_in">Int</span>) -&gt; <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> index</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print(Animal[<span class="number">6</span>])</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> : <span class="type">Animal &#123;</span></span></span><br><span class="line"><span class="comment">//编译报错 Cannot override static method</span></span><br><span class="line">    <span class="keyword">override</span> <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">speak</span></span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>.speak()</span><br><span class="line">        print(<span class="string">"Cat speak"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//编译成功</span></span><br><span class="line">    <span class="keyword">override</span> <span class="class"><span class="keyword">class</span> <span class="title">subscript</span></span>(index: <span class="built_in">Int</span>) -&gt; <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>[index] + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如上面的代码所示<code>static</code>修饰的时候，子类重写，直接报错<code>Cannot override static method</code>。而<code>class</code>修饰时候，编译正常</p><h2 id="重写属性"><a href="#重写属性" class="headerlink" title="重写属性"></a>重写属性</h2><ul><li>子类可以将父类的属性（存储、计算）重写为计算属性</li><li>子类不可以将父类属性重写为存储属性</li><li>只能重写var属性，不能重写let属性</li><li>重写时，属性名、类型要一致</li><li>子类重写后的属性权限 不能小于 父类属性的权限<ul><li>如果父类属性是只读的，那么子类重写后的属性可以是只读的、也可以是可读写的</li><li>如果父类属性是可读写的，那么子类重写后的属性也必须是可读写的</li></ul></li></ul><h3 id="重写类型属性"><a href="#重写类型属性" class="headerlink" title="重写类型属性"></a>重写类型属性</h3><p> 重写类型属性，比较简单，不做赘述</p><h3 id="重写类型属性-1"><a href="#重写类型属性-1" class="headerlink" title="重写类型属性"></a>重写类型属性</h3><p><strong>注意的是：如果子类把父类的存储属性int 重写为计算属性，子类中依然有8个字节存储该int属性</strong></p><p><strong>再次需要注意的是，和重写类型方法、下标类似 如果重写类型属性</strong></p><ul><li>被class修饰的类型方法、下标，允许被子类重写</li><li>被static修饰的类型方法、下标，不允许被子类重写</li></ul><h2 id="属性观察器"><a href="#属性观察器" class="headerlink" title="属性观察器"></a>属性观察器</h2><h3 id="可以在子类中为父类属性（除了只读计算属性、let属性）增加属性观察器，依然是存储属性"><a href="#可以在子类中为父类属性（除了只读计算属性、let属性）增加属性观察器，依然是存储属性" class="headerlink" title="可以在子类中为父类属性（除了只读计算属性、let属性）增加属性观察器，依然是存储属性"></a>可以在子类中为父类属性（除了只读计算属性、let属性）增加属性观察器，依然是存储属性</h3><p>eg，子类<code>SubCircle</code>给父类<code>Circle</code>的存储属性<code>radius</code>增加属性观察器</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Int</span> = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubCircle</span> : <span class="title">Circle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> radius: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"SubCircle willSetRadius"</span>, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"SubCircle didSetRadius"</span>, oldValue, radius)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意点：子类增加属性观察器之后，依然是存储属性</strong></p><h3 id="如果父类本身就有属性观察器"><a href="#如果父类本身就有属性观察器" class="headerlink" title="如果父类本身就有属性观察器"></a>如果父类本身就有属性观察器</h3><p>eg:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Int</span> = <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Circle willSetRadius"</span>, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Circle didSetRadius"</span>, oldValue, radius)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubCircle</span> : <span class="title">Circle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> radius: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"SubCircle willSetRadius"</span>, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"SubCircle didSetRadius"</span>, oldValue, radius)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> circle = <span class="type">SubCircle</span>()</span><br></pre></td></tr></table></figure><p>输出为</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SubCircle willSetRadius <span class="number">10</span></span><br><span class="line">Circle willSetRadius <span class="number">10</span></span><br><span class="line">Circle didSetRadius <span class="number">1</span> <span class="number">10</span></span><br><span class="line">SubCircle didSetRadius <span class="number">1</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><h3 id="重写父类的计算属性"><a href="#重写父类的计算属性" class="headerlink" title="重写父类的计算属性"></a>重写父类的计算属性</h3><p>如下代码</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Circle setRadius"</span>, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Circle getRadius"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">20</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubCircle</span> : <span class="title">Circle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> radius: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"SubCircle willSetRadius"</span>, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"SubCircle didSetRadius"</span>, oldValue, radius)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var <span class="built_in">circle</span> = SubCircle()</span><br><span class="line"><span class="built_in">circle</span>.radius = <span class="number">10</span></span><br></pre></td></tr></table></figure><p>输出结果为</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Circle</span> <span class="string">getRadius</span></span><br><span class="line"><span class="attr">SubCircle</span> <span class="string">willSetRadius 10</span></span><br><span class="line"><span class="attr">Circle</span> <span class="string">setRadius 10</span></span><br><span class="line"><span class="attr">Circle</span> <span class="string">getRadius</span></span><br><span class="line"><span class="attr">SubCircle</span> <span class="string">didSetRadius 20 20</span></span><br></pre></td></tr></table></figure><p>输出结果分析</p><ul><li>调用<code>circle.radius = 10</code>的时候，先获取了<code>oldValue</code>，调用父类的<code>get</code>输出<code>Circle getRadius</code></li><li>然后调用子类<code>willSetRadius</code>准备赋值</li><li>调用父类<code>setRadius</code></li><li>准备调用子类的<code>print(&quot;SubCircle didSetRadius&quot;, oldValue, radius)</code>之前，要先获取<code>radius</code>的值，所以，需要先执行父类的<code>getRadius</code></li><li>执行子类的<code>didSet</code>方法</li></ul><h2 id="final关键字"><a href="#final关键字" class="headerlink" title="final关键字"></a>final关键字</h2><ul><li>被final修饰的方法、下标、属性，禁止被重写</li><li>被final修饰的类，禁止被继承</li></ul><p>参考资料:</p><p><a href="https://github.com/apple/Swift" target="_blank" rel="noopener">Swift官方源码</a></p><p><a href="https://ke.qq.com/course/392094" target="_blank" rel="noopener">从入门到精通Swift编程</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/Swift%E4%B9%8B%E7%BB%A7%E6%89%BF.html&quot;&gt;个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlin
      
    
    </summary>
    
    
      <category term="Swift" scheme="https://ityongzhen.github.io/categories/Swift/"/>
    
    
  </entry>
  
  <entry>
    <title>Swift之方法</title>
    <link href="https://ityongzhen.github.io/Swift%E4%B9%8B%E6%96%B9%E6%B3%95.html/"/>
    <id>https://ityongzhen.github.io/Swift%E4%B9%8B%E6%96%B9%E6%B3%95.html/</id>
    <published>2019-08-30T00:32:24.000Z</published>
    <updated>2019-12-12T06:33:40.310Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/Swift%E4%B9%8B%E6%96%B9%E6%B3%95.html">个人博客</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>方法，也就是函数。同其他语言一样，在Swift中，也是分为实例方法和类型方法</p><h2 id="枚举、结构体、类都可以定义实例方法、类型方法"><a href="#枚举、结构体、类都可以定义实例方法、类型方法" class="headerlink" title="枚举、结构体、类都可以定义实例方法、类型方法"></a>枚举、结构体、类都可以定义实例方法、类型方法</h2><h3 id="实例方法（Instance-Method）：通过实例对象调用"><a href="#实例方法（Instance-Method）：通过实例对象调用" class="headerlink" title="实例方法（Instance Method）：通过实例对象调用"></a>实例方法（Instance Method）：通过实例对象调用</h3><h3 id="类型方法（Type-Method）：通过类型调用，用static或者class关键字定义，类似OC中的类方法"><a href="#类型方法（Type-Method）：通过类型调用，用static或者class关键字定义，类似OC中的类方法" class="headerlink" title="类型方法（Type Method）：通过类型调用，用static或者class关键字定义，类似OC中的类方法"></a>类型方法（Type Method）：通过类型调用，用static或者class关键字定义，类似OC中的类方法</h3><p>例如有个类Car,有实例方法<code>getnNum</code>和类型方法<code>getCount</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> cout = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="type">Car</span>.cout += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 类型方法</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">getCount</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123; cout &#125;</span><br><span class="line">    <span class="comment">// 实例方法</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getnNum</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        num</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c0 = <span class="type">Car</span>()</span><br><span class="line"><span class="keyword">let</span> c1 = <span class="type">Car</span>()</span><br><span class="line"><span class="keyword">let</span> c2 = <span class="type">Car</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="type">Car</span>.getCount()) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">c0.num = <span class="number">10</span></span><br><span class="line">c1.num = <span class="number">11</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c1.num) <span class="comment">//11</span></span><br><span class="line"><span class="built_in">print</span>(c2.num) <span class="comment">//0</span></span><br></pre></td></tr></table></figure><h3 id="self"><a href="#self" class="headerlink" title="self"></a>self</h3><p>不管是实例方法，还是类型方法，里面都可以调用 <code>self</code></p><ul><li>在实例方法中代表实例对象</li><li>在类型方法中代表类型<ul><li>在类型方法static func getCount中</li><li>cout等价于self.cout、Car.self.cout、Car.cout</li></ul></li></ul><p>例如上面的代码可以写成</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> cout = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="type">Car</span>.cout += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 类型方法</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">getCount</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.cout <span class="comment">//self代表类型</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">getnNum</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.num <span class="comment">//self代表实例</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="关键字mutating"><a href="#关键字mutating" class="headerlink" title="关键字mutating"></a>关键字<code>mutating</code></h2><ul><li>结构体和枚举是值类型，默认情况下，值类型的属性不能被自身的实例方法修改</li><li>在func关键字前加mutating可以允许这种修改行为</li></ul><p>eg:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">     <span class="function"><span class="keyword">func</span> <span class="title">moveBy</span><span class="params">(deltaX: Double, deltaY: Double)</span></span> &#123;</span><br><span class="line">        x += deltaX <span class="comment">//编译报错 Left side of mutating operator isn't mutable: 'self' is immutable</span></span><br><span class="line">        y += deltaY <span class="comment">//编译报错 Left side of mutating operator isn't mutable: 'self' is immutable</span></span><br><span class="line">         <span class="keyword">self</span> = <span class="type">Point</span>(x: x + deltaX, y: y + deltaY) <span class="comment">//编译报错 Cannot assign to value: 'self' is immutable</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">StateSwitch</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> low, middle, high</span><br><span class="line">     <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .low:</span><br><span class="line">            <span class="keyword">self</span> = .middle<span class="comment">//编译报错 Cannot assign to value: 'self' is immutable</span></span><br><span class="line">        <span class="keyword">case</span> .middle:</span><br><span class="line">            <span class="keyword">self</span> = .high<span class="comment">//编译报错 Cannot assign to value: 'self' is immutable</span></span><br><span class="line">        <span class="keyword">case</span> .high:</span><br><span class="line">            <span class="keyword">self</span> = .low<span class="comment">//编译报错 Cannot assign to value: 'self' is immutable</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>加上关键字<code>mutating</code>之后就可以了</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">moveBy</span><span class="params">(deltaX: Double, deltaY: Double)</span></span> &#123;</span><br><span class="line">        x += deltaX </span><br><span class="line">        y += deltaY </span><br><span class="line">        <span class="keyword">self</span> = <span class="type">Point</span>(x: x + deltaX, y: y + deltaY) </span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">StateSwitch</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> low, middle, high</span><br><span class="line">   <span class="keyword">mutating</span>  <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .low:</span><br><span class="line">            <span class="keyword">self</span> = .middle</span><br><span class="line">        <span class="keyword">case</span> .middle:</span><br><span class="line">            <span class="keyword">self</span> = .high</span><br><span class="line">        <span class="keyword">case</span> .high:</span><br><span class="line">            <span class="keyword">self</span> = .low        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="关键字-discardableResult"><a href="#关键字-discardableResult" class="headerlink" title="关键字@discardableResult"></a>关键字<code>@discardableResult</code></h2><ul><li>在func前面加个@discardableResult，可以消除：函数调用后返回值未被使用的警告⚠</li></ul><p>eg:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">     <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">moveX</span><span class="params">(deltaX: Double)</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        x += deltaX</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="type">Point</span>()</span><br><span class="line">p.moveX(deltaX: <span class="number">10</span>)</span><br></pre></td></tr></table></figure><p>因为方法<code>moveX</code>的返回值没有使用，编译器会报警告</p><p><img src="https://user-gold-cdn.xitu.io/2019/7/15/16bf284e958adef2?w=871&h=216&f=png&s=50207" alt=""></p><ul><li>如果加了关键字<code>@discardableResult</code>就不会警告了</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">    <span class="meta">@discardableResult</span> <span class="keyword">mutating</span> </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">moveX</span><span class="params">(deltaX: Double)</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        x += deltaX</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="type">Point</span>()</span><br><span class="line">p.moveX(deltaX: <span class="number">10</span>)</span><br></pre></td></tr></table></figure><p>参考资料:</p><p><a href="https://github.com/apple/Swift" target="_blank" rel="noopener">Swift官方源码</a></p><p><a href="https://ke.qq.com/course/392094" target="_blank" rel="noopener">从入门到精通Swift编程</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/Swift%E4%B9%8B%E6%96%B9%E6%B3%95.html&quot;&gt;个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlin
      
    
    </summary>
    
    
      <category term="Swift" scheme="https://ityongzhen.github.io/categories/Swift/"/>
    
    
  </entry>
  
  <entry>
    <title>Swift之属性</title>
    <link href="https://ityongzhen.github.io/Swift%E4%B9%8B%E5%B1%9E%E6%80%A7.html/"/>
    <id>https://ityongzhen.github.io/Swift%E4%B9%8B%E5%B1%9E%E6%80%A7.html/</id>
    <published>2019-08-20T00:32:24.000Z</published>
    <updated>2019-12-12T06:26:53.513Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/Swift之属性.html">我的个人博客</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前面了解了 <a href="https://juejin.im/post/5d216d6bf265da1b957079d8" target="_blank" rel="noopener">Swift之类</a>  和 <a href="https://juejin.im/post/5d216e1ff265da1bb27752aa" target="_blank" rel="noopener">Swift之结构体</a>  </p><p>这篇文章分享一下Swift中的属性</p><h2 id="Swift中跟实例相关的属性可以分为2大类"><a href="#Swift中跟实例相关的属性可以分为2大类" class="headerlink" title="Swift中跟实例相关的属性可以分为2大类"></a>Swift中跟实例相关的属性可以分为2大类</h2><h3 id="存储属性（Stored-Property）"><a href="#存储属性（Stored-Property）" class="headerlink" title="存储属性（Stored Property）"></a>存储属性（Stored Property）</h3><ul><li>类似于成员变量这个概念</li><li>存储在实例的内存中</li><li>结构体、类可以定义存储属性</li><li>枚举不可以定义存储属性<ul><li>关于枚举不可以定义存储属性，根据之前的<a href="https://juejin.im/post/5d1eeca3f265da1ba6480cc7" target="_blank" rel="noopener">Swift枚举</a>一文可知，<br>枚举中存储关联值或者keys，不存储属性的。</li></ul></li></ul><h4 id="关于存储属性，Swift有个明确的规定"><a href="#关于存储属性，Swift有个明确的规定" class="headerlink" title="关于存储属性，Swift有个明确的规定"></a>关于存储属性，Swift有个明确的规定</h4><ul><li>在创建类 或 结构体的实例时，必须为所有的存储属性设置一个合适的初始值<ul><li>可以在初始化器里为存储属性设置一个初始值</li><li>可以分配一个默认的属性值作为属性定义的一部分</li></ul></li></ul><p>关于这个规定，我们在<a href="https://juejin.im/post/5d216e1ff265da1bb27752aa" target="_blank" rel="noopener">Swift之结构体</a>   一文中已经说过了，这里稍微提一下，比如下面代码，x和y都是存储属性，当初始化的时候，如果没值，编译器会直接报错。</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">struct Point&#123;</span><br><span class="line">    var x: Int</span><br><span class="line">    var y: Int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var p1 = Point(x: 10, y: <span class="number">20</span>)</span><br><span class="line">var p2 = Point(y: <span class="number">20</span>) //报错 <span class="literal">Missing</span> argument <span class="keyword">for</span> parameter <span class="string">'x'</span> <span class="keyword">in</span> <span class="keyword">call</span></span><br><span class="line">var p3 = Point(x: <span class="number">10</span>) //报错 <span class="literal">Missing</span> argument <span class="keyword">for</span> parameter <span class="string">'y'</span> <span class="keyword">in</span> <span class="keyword">call</span></span><br><span class="line">var p4 = Point()    //报错 <span class="literal">Missing</span> argument <span class="keyword">for</span> parameter <span class="string">'x'</span> <span class="keyword">in</span> <span class="keyword">call</span></span><br></pre></td></tr></table></figure><h3 id="计算属性（Computed-Property）"><a href="#计算属性（Computed-Property）" class="headerlink" title="计算属性（Computed Property）"></a>计算属性（Computed Property）</h3><ul><li>本质就是方法（函数）</li><li>不占用实例的内存</li><li>枚举、结构体、类都可以定义计算属性</li><li>set传入的新值默认叫做newValue，也可以自定义</li></ul><p>如下面结构体<code>Circle</code>包括了存储属性<code>radius</code>和计算属性<code>diameter</code></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">truct Circle &#123;</span><br><span class="line">    <span class="comment">// 存储属性</span></span><br><span class="line">    var radius: Double</span><br><span class="line">    <span class="comment">// 计算属性</span></span><br><span class="line">    var diameter: Double &#123;</span><br><span class="line">        <span class="built_in">set</span> &#123;</span><br><span class="line">            radius = newValue / <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">get</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> radius * <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var <span class="built_in">circle</span> = Circle(radius: <span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">circle</span>.radius) <span class="comment">// 5.0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">circle</span>.diameter) <span class="comment">// 10.0</span></span><br><span class="line"><span class="built_in">circle</span>.diameter = <span class="number">12</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">circle</span>.radius) <span class="comment">// 6.0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">circle</span>.diameter) <span class="comment">// 12.0</span></span><br></pre></td></tr></table></figure><ul><li>只读计算属性：只有get，没有set<br>如下</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">struct Circle &#123;</span><br><span class="line">    var radius: Double</span><br><span class="line">    var diameter: Double &#123;</span><br><span class="line">        <span class="builtin-name">get</span> &#123;</span><br><span class="line">           <span class="built_in"> radius </span>* 2</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>只读计算属性可以简写，例如上面的代码可以如下表示</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">struct Circle &#123;</span><br><span class="line">    var radius: Double</span><br><span class="line">    var diameter: Double &#123;<span class="built_in"> radius </span>* 2 &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="计算属性不占用实例的内存"><a href="#计算属性不占用实例的内存" class="headerlink" title="计算属性不占用实例的内存"></a>计算属性不占用实例的内存</h4><p>关于不占用实例的内存，可以如下代码证明</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 存储属性</span></span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span></span><br><span class="line">    <span class="comment">// 计算属性</span></span><br><span class="line">    <span class="keyword">var</span> diameter: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            radius = newValue / <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> radius * <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Double占用字节"</span>, <span class="type">MemoryLayout</span>&lt;<span class="type">Double</span>&gt;.<span class="built_in">stride</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Circle占用字节"</span>,<span class="type">MemoryLayout</span>&lt;<span class="type">Circle</span>&gt;.<span class="built_in">stride</span>) <span class="comment">// 8</span></span><br></pre></td></tr></table></figure><p>输出为</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Double占用字节 <span class="number">8</span></span><br><span class="line">Circle占用字节 <span class="number">8</span></span><br></pre></td></tr></table></figure><p>也就是说<code>Circle</code>占用的仅仅是其存储属性<code>radius</code>所占用的内存。和计算属性无关的，读者也可以多写几个计算属性，自行验证。</p><h3 id="汇编分析存储属性和计算属性的区别"><a href="#汇编分析存储属性和计算属性的区别" class="headerlink" title="汇编分析存储属性和计算属性的区别"></a>汇编分析存储属性和计算属性的区别</h3><p>代码如下</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">struct Circle &#123;</span><br><span class="line">    <span class="comment">// 存储属性</span></span><br><span class="line">    <span class="keyword">var</span> radius: <span class="built_in">Int</span></span><br><span class="line">    <span class="comment">// 计算属性</span></span><br><span class="line">    <span class="keyword">var</span> diameter: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            radius = newValue / <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> radius * <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> circle = Circle(radius: <span class="number">9</span>)</span><br><span class="line">circle.radius = <span class="number">5</span> </span><br><span class="line">circle.diameter = <span class="number">8</span> <span class="comment">//这里打断点</span></span><br></pre></td></tr></table></figure><p><img src="https://user-gold-cdn.xitu.io/2019/7/14/16bee94ad12510f0?w=1114&h=800&f=png&s=400156" alt=""></p><ul><li><p>5存储到了全局变量<code>0x3e96(%rip)</code>,全局变量只有<code>circle</code>，所以也就是说存储属性的值，被直接放在了结构体的内存中。</p></li><li><p>8赋值给寄存器<code>%r8d</code>，又给寄存器%edi，作为参数调用函数<code>0x100001ae0</code>的时候传入，而函数<code>0x100001ae0</code>就是<code>testSwift.Circle.diameter.setter</code>这就是存储属性和计算属性的区别</p></li></ul><h2 id="枚举rawValue的原理"><a href="#枚举rawValue的原理" class="headerlink" title="枚举rawValue的原理"></a>枚举rawValue的原理</h2><p>在<a href="https://juejin.im/post/5d1eeca3f265da1ba6480cc7" target="_blank" rel="noopener">Swift枚举</a>一文中，我们说过枚举原始值是不占用内存的。</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Season</span>: <span class="title">Int</span>&#123;</span></span><br><span class="line">    <span class="keyword">case</span> test1 = <span class="number">1</span>, test2, test3, test4</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var s = Season.test2</span><br><span class="line">print(s.rawValue) /<span class="regexp">/输出2</span></span><br></pre></td></tr></table></figure><p>上面代码输出为2。<br>这些原始值 test1 = 1, test2, test3, test4，系统内部完全可以写成只读计算属性</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Season</span>: <span class="title">Int</span>&#123;</span></span><br><span class="line">    <span class="keyword">case</span> test1 = <span class="number">1</span>, test2, test3, test4</span><br><span class="line">    </span><br><span class="line">    var rawValue : Int &#123;</span><br><span class="line">        switch <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="symbol">test1:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">11</span></span><br><span class="line">        <span class="keyword">case</span> .<span class="symbol">test2:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">12</span></span><br><span class="line">        <span class="keyword">case</span> .<span class="symbol">test3:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">13</span></span><br><span class="line">        <span class="keyword">case</span> .<span class="symbol">test4:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">14</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var s = Season.test2</span><br><span class="line">print(s.rawValue) /<span class="regexp">/输出12</span></span><br></pre></td></tr></table></figure><p>上面代码输出为12，这样就完成了获取枚举的原始值的时候，直接获取的是只读计算属性。光看结果是不够令人信服的，那就看汇编</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Season</span>: <span class="title">Int</span>&#123;</span></span><br><span class="line">    <span class="keyword">case</span> test1 = <span class="number">1</span>, test2, test3, test4</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var s = Season.test2</span><br><span class="line">print(s.rawValue) /<span class="regexp">/这里打断点</span></span><br></pre></td></tr></table></figure><p>上述代码在最后一行打断点</p><p><img src="https://user-gold-cdn.xitu.io/2019/7/14/16bee94ad1350252?w=1077&h=611&f=png&s=261495" alt=""></p><p>可以看到，确实调用了<code>rawValue.getter</code>。</p><p>所以汇编才是看出本质的神器。</p><h2 id="延迟存储属性（Lazy-Stored-Property）"><a href="#延迟存储属性（Lazy-Stored-Property）" class="headerlink" title="延迟存储属性（Lazy Stored Property）"></a>延迟存储属性（Lazy Stored Property）</h2><h3 id="使用lazy可以定义一个延迟存储属性，在第一次用到属性的时候才会进行初始化"><a href="#使用lazy可以定义一个延迟存储属性，在第一次用到属性的时候才会进行初始化" class="headerlink" title="使用lazy可以定义一个延迟存储属性，在第一次用到属性的时候才会进行初始化"></a>使用lazy可以定义一个延迟存储属性，在第一次用到属性的时候才会进行初始化</h3><ul><li>lazy属性必须是var，不能是let<ul><li>let必须在实例的初始化方法完成之前就拥有值</li></ul></li><li>如果多条线程同时第一次访问lazy属性<ul><li>无法保证属性只被初始化1次</li></ul></li></ul><p>eg:有类 Car和类Person ，car作为Person的延迟存储属性，那么当使用car的是，才会调用car的初始化方法。</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Car init!"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Car is running!"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> car = <span class="type">Car</span>()</span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Person init!"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">goOut</span><span class="params">()</span></span> &#123;</span><br><span class="line">        car.run()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> p = <span class="type">Person</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"--------"</span>)</span><br><span class="line">p.goOut()</span><br></pre></td></tr></table></figure><p>输出为</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Person init!</span><br><span class="line">--------</span><br><span class="line">Car init!</span><br><span class="line">Car is running!</span><br></pre></td></tr></table></figure><h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a><strong>注意点</strong></h3><ul><li>当结构体包含一个延迟存储属性时，只有var才能访问延迟存储属性<ul><li>因为延迟属性初始化时需要改变结构体的内存</li></ul></li></ul><h2 id="属性观察器"><a href="#属性观察器" class="headerlink" title="属性观察器"></a>属性观察器</h2><ul><li>可以为非lazy的var存储属性设置属性观察器</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Circle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"willSet"</span>, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"didSet"</span>, oldValue, radius)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="keyword">self</span>.radius = <span class="number">1.0</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Circle init!"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> circle = <span class="type">Circle</span>()<span class="comment">// 输出 Circle init!</span></span><br><span class="line"></span><br><span class="line">circle.radius = <span class="number">10.5</span> </span><br><span class="line"><span class="comment">// 输出 willSet 10.5 </span></span><br><span class="line"><span class="comment">// didSet 1.0 10.5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(circle.radius) <span class="comment">//输出 10.5</span></span><br></pre></td></tr></table></figure><h3 id="注意点-1"><a href="#注意点-1" class="headerlink" title="注意点"></a>注意点</h3><ul><li>willSet会传递新值，默认叫newValue</li><li>didSet会传递旧值，默认叫oldValue</li><li>在初始化器中设置属性值不会触发willSet和didSet</li><li>在属性定义时设置初始值也不会触发willSet和didSet</li></ul><h2 id="全局变量、局部变量"><a href="#全局变量、局部变量" class="headerlink" title="全局变量、局部变量"></a>全局变量、局部变量</h2><ul><li>属性观察器、计算属性的功能，同样可以应用在全局变量、局部变量身上</li></ul><p>eg:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num: <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"setNum"</span>, newValue)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">num = <span class="number">11</span> <span class="comment">// setNum 11</span></span><br><span class="line"><span class="built_in">print</span>(num) <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> age = <span class="number">10</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"willSet"</span>, newValue)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"didSet"</span>, oldValue, age)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    age = <span class="number">11</span></span><br><span class="line">    <span class="comment">// willSet 11</span></span><br><span class="line">    <span class="comment">// didSet 10 11</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test()</span><br></pre></td></tr></table></figure><h2 id="类型属性（Type-Property）"><a href="#类型属性（Type-Property）" class="headerlink" title="类型属性（Type Property）"></a>类型属性（Type Property）</h2><h3 id="类型属性分类"><a href="#类型属性分类" class="headerlink" title="类型属性分类"></a>类型属性分类</h3><ol><li>实例属性（Instance Property）：只能通过实例去访问<ul><li>存储实例属性（Stored Instance Property）：存储在实例的内存中，每个实例都有1份</li><li>计算实例属性（Computed Instance Property）</li></ul></li><li>类型属性（Type Property）：只能通过类型去访问<ul><li>存储类型属性（Stored Type Property）：整个程序运行过程中，就只有1份内存（类似于全局变量）</li><li>计算类型属性（Computed Type Property）</li></ul></li><li>可以通过static定义类型属性<ul><li>如果是类，也可以用关键字class</li></ul></li></ol><p>eg:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="type">Car</span>.<span class="built_in">count</span> += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c1 = <span class="type">Car</span>()</span><br><span class="line"><span class="keyword">let</span> c2 = <span class="type">Car</span>()</span><br><span class="line"><span class="keyword">let</span> c3 = <span class="type">Car</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="type">Car</span>.<span class="built_in">count</span>) <span class="comment">// 输出3</span></span><br></pre></td></tr></table></figure><h3 id="类型属性细节"><a href="#类型属性细节" class="headerlink" title="类型属性细节"></a>类型属性细节</h3><ol><li>不同于存储实例属性，你必须给存储类型属性设定初始值<ul><li>因为类型没有像实例那样的init初始化器来初始化存储属性</li></ul></li><li>存储类型属性默认就是lazy，会在第一次使用的时候才初始化<ul><li>就算被多个线程同时访问，保证只会初始化一次</li><li>存储类型属性可以是let</li></ul></li><li>枚举类型也可以定义类型属性（存储类型属性、计算类型属性）</li></ol><h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><p>关于单例模式，可以参考我的另一篇文章<a href="https://juejin.im/post/5d295106e51d45105d63a5b2" target="_blank" rel="noopener">你真的懂单例模式么</a></p><p>不同语言的单例模式，都是类似的，这里给出Swift版本单例的实现。</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileManager</span> </span>&#123;</span><br><span class="line"><span class="comment">//单例模式</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> shared = <span class="type">FileManager</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果单例里面代码过多，可以写成如下</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> shared = &#123;</span><br><span class="line">        <span class="comment">// ....</span></span><br><span class="line">        <span class="comment">// ....</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">FileManager</span>()</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="汇编分析-static"><a href="#汇编分析-static" class="headerlink" title="汇编分析 static"></a>汇编分析 static</h2><p>下面的代码</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YZPerson</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span>  <span class="keyword">var</span> <span class="built_in">count</span> = <span class="number">3</span> <span class="comment">//这里打断点</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">YZPerson</span>.<span class="built_in">count</span> = <span class="number">6</span></span><br></pre></td></tr></table></figure><p>如下图所示，可以看出，会调用 <code>swift_once</code>函数，来到这个调用位置，si汇编调试指令，一直跟进去</p><p><img src="https://user-gold-cdn.xitu.io/2019/7/14/16bee94ad15fe540?w=1950&h=678&f=png&s=272688" alt=""></p><p>最终会来到这里，调用<code>dispatch_once_f</code><br><img src="https://user-gold-cdn.xitu.io/2019/7/14/16bee94ad1e7961e?w=1932&h=790&f=png&s=288329" alt=""></p><p>也就是说<code>static</code>内部封装了<code>dispatch_once_</code> 而<code>dispatch_once_</code>能保证线程安全的，只能被初始化一次，所以单例的时候可以用<code>static</code> 关于 <code>dispatch_once</code>的分析，可以看这篇文章<a href="https://juejin.im/post/5d295106e51d45105d63a5b2" target="_blank" rel="noopener">你真的懂单例模式么</a></p><ul><li>同样的，我们可以从代码角度，汇编角度分别证明 <code>static</code> 修饰的变量，属于全局变量。读者有兴趣自己证明。这里不再赘述。</li></ul><p>参考资料:</p><p><a href="https://github.com/apple/Swift" target="_blank" rel="noopener">Swift官方源码</a></p><p><a href="https://ke.qq.com/course/392094" target="_blank" rel="noopener">从入门到精通Swift编程</a></p><p><a href="https://juejin.im/post/5d295106e51d45105d63a5b2" target="_blank" rel="noopener">你真的懂单例模式么</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/Swift之属性.html&quot;&gt;我的个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/
      
    
    </summary>
    
    
      <category term="Swift" scheme="https://ityongzhen.github.io/categories/Swift/"/>
    
    
  </entry>
  
  <entry>
    <title>Swift之通过汇编探究闭包本质</title>
    <link href="https://ityongzhen.github.io/Swift%E4%B9%8B%E9%80%9A%E8%BF%87%E6%B1%87%E7%BC%96%E6%8E%A2%E7%A9%B6%E9%97%AD%E5%8C%85%E6%9C%AC%E8%B4%A8.html/"/>
    <id>https://ityongzhen.github.io/Swift%E4%B9%8B%E9%80%9A%E8%BF%87%E6%B1%87%E7%BC%96%E6%8E%A2%E7%A9%B6%E9%97%AD%E5%8C%85%E6%9C%AC%E8%B4%A8.html/</id>
    <published>2019-08-10T00:32:24.000Z</published>
    <updated>2019-12-12T06:22:54.825Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/Swift%E4%B9%8B%E9%80%9A%E8%BF%87%E6%B1%87%E7%BC%96%E6%8E%A2%E7%A9%B6%E9%97%AD%E5%8C%85%E6%9C%AC%E8%B4%A8.html">我的个人博客</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>先回顾一下，上一篇  <a href="https://juejin.im/post/5d229738f265da1b715317b7" target="_blank" rel="noopener">Swift之闭包(Closure)</a>中对闭包的解释</p><ul><li>一个函数和它所捕获的变量\常量环境组合起来，称为闭包<ul><li>一般指定义在函数内部的函数</li><li>一般它捕获的是外层函数的局部变量\常量</li></ul></li><li>可以把闭包想象成是一个类的实例对象<ul><li>内存在堆空间</li><li>捕获的局部变量\常量就是对象的成员(存储属性) </li><li>组成闭包的函数就是类内部定义的方法</li></ul></li></ul><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>先看下面一段代码，猜猜会输出什么</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">typealias <span class="function"><span class="keyword">Fn</span> </span>= (Int) -&gt; Int</span><br><span class="line">func <span class="built_in">getFn</span>() -&gt; <span class="function"><span class="keyword">Fn</span>&#123;</span></span><br><span class="line"><span class="function">    // 局部变量</span></span><br><span class="line"><span class="function">    <span class="title">var</span> <span class="title">num</span> </span>= <span class="number">0</span></span><br><span class="line">    func <span class="built_in">plus</span>(_ i: Int) -&gt; Int&#123;</span><br><span class="line">        num += i</span><br><span class="line">        <span class="keyword">return</span> num</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">plus</span>(_:)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var <span class="function"><span class="keyword">fn</span> </span>= <span class="built_in">getFn</span>()</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">fn</span>(<span class="number">1</span>)) <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">fn</span>(<span class="number">2</span>))<span class="comment">// 3</span></span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">fn</span>(<span class="number">3</span>))<span class="comment">// 6</span></span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">fn</span>(<span class="number">4</span>))<span class="comment">// 10</span></span><br></pre></td></tr></table></figure><p>结果是输出</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure><p>那么，问题来了，为什么输出的是10呢？因为按照常识，var num = 0 是局部变量，执行完就销毁了，怎么能再后面继续使用呢？</p><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>我们先从简单的说起<br>首先是下面一端代码</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">Fn</span> = (<span class="type">Int</span>) -&gt; <span class="type">Int</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getFn</span><span class="params">()</span></span> -&gt; <span class="type">Fn</span>&#123;</span><br><span class="line">    <span class="comment">// 局部变量</span></span><br><span class="line">    <span class="keyword">var</span> num = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">plus</span><span class="params">(<span class="number">_</span> i: Int)</span></span> -&gt; <span class="type">Int</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> i </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> plus(<span class="number">_</span>:) <span class="comment">// 这里打断点</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn = getFn()</span><br><span class="line"><span class="built_in">print</span>(fn(<span class="number">1</span>))</span><br></pre></td></tr></table></figure><p>先不适用num ,直接 return i 并在这里打断点，结果如下</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">testSwift`getFn():</span><br><span class="line">    <span class="number">0x100001f70</span> &lt;+<span class="number">0</span>&gt;:  pushq  %rbp</span><br><span class="line">    <span class="number">0x100001f71</span> &lt;+<span class="number">1</span>&gt;:  movq   %rsp, %rbp</span><br><span class="line">    <span class="number">0x100001f74</span> &lt;+<span class="number">4</span>&gt;:  movq   $<span class="number">0x0</span>, <span class="number">-0x8</span>(%rbp)</span><br><span class="line">-&gt;  <span class="number">0x100001f7c</span> &lt;+<span class="number">12</span>&gt;: leaq   <span class="number">0xd</span>(%rip), %rax           ; plus #<span class="number">1</span> (Swift.Int) -&gt; Swift.Int <span class="keyword">in</span> testSwift.getFn() -&gt; (Swift.Int) -&gt; Swift.Int at main.swift:<span class="number">23</span></span><br><span class="line">    <span class="number">0x100001f83</span> &lt;+<span class="number">19</span>&gt;: xorl   %ecx, %ecx</span><br><span class="line">    <span class="number">0x100001f85</span> &lt;+<span class="number">21</span>&gt;: movl   %ecx, %edx</span><br><span class="line">    <span class="number">0x100001f87</span> &lt;+<span class="number">23</span>&gt;: popq   %rbp</span><br><span class="line">    <span class="number">0x100001f88</span> &lt;+<span class="number">24</span>&gt;: retq</span><br></pre></td></tr></table></figure><p><img src="https://user-gold-cdn.xitu.io/2019/7/8/16bcf1fb505d92c2?w=1243&h=825&f=png&s=356842" alt=""></p><p>可知，0xd(%rip), %rax  这段代码，把地址值，也就是getFn() 函数的地址值给了rax,<br>根本没有alloc malloc等代码，也就是说，没有开辟堆空间。那么接下来我们看下面的代码</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">typealias <span class="function"><span class="keyword">Fn</span> </span>= (Int) -&gt; Int</span><br><span class="line">func <span class="built_in">getFn</span>() -&gt; <span class="function"><span class="keyword">Fn</span>&#123;</span></span><br><span class="line"><span class="function">    // 局部变量</span></span><br><span class="line"><span class="function">    <span class="title">var</span> <span class="title">num</span> </span>= <span class="number">0</span></span><br><span class="line">    func <span class="built_in">plus</span>(_ i: Int) -&gt; Int&#123;</span><br><span class="line"> num += i</span><br><span class="line"> <span class="keyword">return</span> num </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">plus</span>(_:) <span class="comment">// 这里打断点</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var <span class="function"><span class="keyword">fn</span> </span>= <span class="built_in">getFn</span>()</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">fn</span>(<span class="number">1</span>))</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">fn</span>(<span class="number">2</span>))</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">fn</span>(<span class="number">3</span>))</span><br></pre></td></tr></table></figure><p>断点如下</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">testSwift`getFn():</span><br><span class="line">    <span class="number">0x100001de0</span> &lt;+<span class="number">0</span>&gt;:  pushq  %rbp</span><br><span class="line">    <span class="number">0x100001de1</span> &lt;+<span class="number">1</span>&gt;:  movq   %rsp, %rbp</span><br><span class="line">    <span class="number">0x100001de4</span> &lt;+<span class="number">4</span>&gt;:  subq   $<span class="number">0x20</span>, %rsp</span><br><span class="line">    <span class="number">0x100001de8</span> &lt;+<span class="number">8</span>&gt;:  leaq   <span class="number">0x3301</span>(%rip), %rdi</span><br><span class="line">    <span class="number">0x100001def</span> &lt;+<span class="number">15</span>&gt;: movl   $<span class="number">0x18</span>, %esi</span><br><span class="line">    <span class="number">0x100001df4</span> &lt;+<span class="number">20</span>&gt;: movl   $<span class="number">0x7</span>, %edx</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 这里swift_allocObject 说明产生了堆空间</span></span><br><span class="line">    <span class="number">0x100001df9</span> &lt;+<span class="number">25</span>&gt;: callq  <span class="number">0x1000046f8</span>        ; symbol stub <span class="keyword">for</span>: swift_allocObject</span><br><span class="line">    <span class="number">0x100001dfe</span> &lt;+<span class="number">30</span>&gt;: movq   %rax, %rdx</span><br><span class="line">    <span class="number">0x100001e01</span> &lt;+<span class="number">33</span>&gt;: addq   $<span class="number">0x10</span>, %rdx</span><br><span class="line">    <span class="number">0x100001e05</span> &lt;+<span class="number">37</span>&gt;: movq   %rdx, %rsi</span><br><span class="line">    <span class="number">0x100001e08</span> &lt;+<span class="number">40</span>&gt;: movq   $<span class="number">0x0</span>, <span class="number">0x10</span>(%rax)</span><br><span class="line">-&gt;  <span class="number">0x100001e10</span> &lt;+<span class="number">48</span>&gt;: movq   %rax, %rdi</span><br><span class="line">    <span class="number">0x100001e13</span> &lt;+<span class="number">51</span>&gt;: movq   %rax, <span class="number">-0x8</span>(%rbp)</span><br><span class="line">    <span class="number">0x100001e17</span> &lt;+<span class="number">55</span>&gt;: movq   %rdx, <span class="number">-0x10</span>(%rbp)</span><br><span class="line">    <span class="number">0x100001e1b</span> &lt;+<span class="number">59</span>&gt;: callq  <span class="number">0x100004758</span>         ; symbol stub <span class="keyword">for</span>: swift_retain</span><br><span class="line">    <span class="number">0x100001e20</span> &lt;+<span class="number">64</span>&gt;: movq   <span class="number">-0x8</span>(%rbp), %rdi</span><br><span class="line">    <span class="number">0x100001e24</span> &lt;+<span class="number">68</span>&gt;: movq   %rax, <span class="number">-0x18</span>(%rbp)</span><br><span class="line">    <span class="number">0x100001e28</span> &lt;+<span class="number">72</span>&gt;: callq  <span class="number">0x100004752</span>         ; symbol stub <span class="keyword">for</span>: swift_release</span><br><span class="line">    <span class="number">0x100001e2d</span> &lt;+<span class="number">77</span>&gt;: movq   <span class="number">-0x10</span>(%rbp), %rax</span><br><span class="line">    <span class="number">0x100001e31</span> &lt;+<span class="number">81</span>&gt;: leaq   <span class="number">0x178</span>(%rip), %rax   ; partial apply forwarder <span class="keyword">for</span> plus #<span class="number">1</span> (Swift.Int) -&gt; Swift.Int <span class="keyword">in</span> testSwift.getFn() -&gt; (Swift.Int) -&gt; Swift.Int at &lt;compiler-generated&gt;</span><br><span class="line">    <span class="number">0x100001e38</span> &lt;+<span class="number">88</span>&gt;: movq   <span class="number">-0x8</span>(%rbp), %rdx</span><br><span class="line">    <span class="number">0x100001e3c</span> &lt;+<span class="number">92</span>&gt;: addq   $<span class="number">0x20</span>, %rsp</span><br><span class="line">    <span class="number">0x100001e40</span> &lt;+<span class="number">96</span>&gt;: popq   %rbp</span><br><span class="line">    <span class="number">0x100001e41</span> &lt;+<span class="number">97</span>&gt;: retq</span><br></pre></td></tr></table></figure><p>进一步验证，下面的代码是因为，写文章的时候，重新跑了一遍，所以函数 getFn() 函数的抵制和截图不一致，是</p><blockquote><p>rax = 0x0000000101849fd0</p></blockquote><p>这次我们在 </p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">typealias <span class="function"><span class="keyword">Fn</span> </span>= (Int) -&gt; Int</span><br><span class="line">func <span class="built_in">getFn</span>() -&gt; <span class="function"><span class="keyword">Fn</span>&#123;</span></span><br><span class="line"><span class="function">    // 局部变量</span></span><br><span class="line"><span class="function">    <span class="title">var</span> <span class="title">num</span> </span>= <span class="number">0</span></span><br><span class="line">    func <span class="built_in">plus</span>(_ i: Int) -&gt; Int&#123;</span><br><span class="line"> num += i</span><br><span class="line"> <span class="keyword">return</span> num  <span class="comment">// 第二次这里打断点 查看getFn()地址的内容</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">plus</span>(_:) <span class="comment">// 第一次这里打断点 获取getFn()地址</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var <span class="function"><span class="keyword">fn</span> </span>= <span class="built_in">getFn</span>()</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">fn</span>(<span class="number">1</span>)) </span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">fn</span>(<span class="number">2</span>))</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">fn</span>(<span class="number">3</span>))</span><br></pre></td></tr></table></figure><p>因为调用了三次 fn分别为 fn(1) 、 fn(2)、fn(3)，所以在 return num 地方，会断三次<br>我们分别查看函数getFn() 函数地址的内容</p><p>结果如图<br><img src="https://user-gold-cdn.xitu.io/2019/7/8/16bcf1fb506737cb?w=1139&h=886&f=png&s=362546" alt=""></p><p>图中可知，确实是操作同一块堆空间，而且之前<a href="https://ityongzhen.github.io/Swift%E4%B9%8B%E7%B1%BB.html">Swift之类</a>中讲过，前面16个字节，分别存放 类的信息，引用技术，然后后面才是值，可知，</p><p>刚开始分配完，堆空间里面是垃圾数据<br>执行完 print(fn(1))  之后，堆空间里面放的是1<br>执行完 print(fn(2))  之后，堆空间里面放的是3<br>执行完 print(fn(3))  之后，堆空间里面放的是6</p><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>这也解释了，文章开头的那个疑问，因为闭包捕获了局部变量，在堆中开辟空间，然后后面调用的时候，操作的是堆空间的内存，所以结果是</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure><p>关于汇编的调试指令可以参考</p><p><a href="https://ityongzhen.github.io/%E6%B1%87%E7%BC%96%E6%80%BB%E7%BB%93.html">汇编总结</a></p><p><a href="https://github.com/apple/Swift" target="_blank" rel="noopener">Swift官方源码</a></p><p><a href="https://ke.qq.com/course/392094" target="_blank" rel="noopener">从入门到精通Swift编程</a></p><p><a href="https://ityongzhen.github.io/%E6%B1%87%E7%BC%96%E6%80%BB%E7%BB%93.html">汇编总结</a></p><p><a href="https://juejin.im/post/5d229738f265da1b715317b7" target="_blank" rel="noopener">Swift之闭包(Closure)</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/Swift%E4%B9%8B%E9%80%9A%E8%BF%87%E6%B1%87%E7%BC%96%E6%8E%A2%E7%A9%B6%E9%97%AD%E5%8C%85%E6%9C%A
      
    
    </summary>
    
    
      <category term="Swift" scheme="https://ityongzhen.github.io/categories/Swift/"/>
    
    
  </entry>
  
  <entry>
    <title>Swift之闭包(Closure)</title>
    <link href="https://ityongzhen.github.io/Swift%E4%B9%8B%E9%97%AD%E5%8C%85(Closure).html/"/>
    <id>https://ityongzhen.github.io/Swift%E4%B9%8B%E9%97%AD%E5%8C%85(Closure).html/</id>
    <published>2019-07-25T00:32:24.000Z</published>
    <updated>2019-12-12T06:21:30.208Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/Swift%E4%B9%8B%E9%97%AD%E5%8C%85(Closure).html">我的个人博客</a></p><h2 id="什么是闭包"><a href="#什么是闭包" class="headerlink" title="什么是闭包"></a>什么是闭包</h2><ul><li>一个函数和它所捕获的变量\常量环境组合起来，称为闭包<ul><li>一般指定义在函数内部的函数</li><li>一般它捕获的是外层函数的局部变量\常量</li></ul></li><li>可以把闭包想象成是一个类的实例对象<ul><li>内存在堆空间</li><li>捕获的局部变量\常量就是对象的成员(存储属性) </li><li>组成闭包的函数就是类内部定义的方法</li></ul></li></ul><p>eg:<br>我们有一个函数 sum</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(<span class="number">_</span> v1: Int, <span class="number">_</span> v2: Int)</span></span> -&gt; <span class="type">Int</span> &#123; v1 + v2 &#125;</span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure><p>如果用闭包表达式定义一个函数</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn = &#123;</span><br><span class="line">    (v1: <span class="built_in">Int</span>, v2: <span class="built_in">Int</span>) -&gt; <span class="built_in">Int</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> v1 + v2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line">fn(<span class="number">10</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure><p>当然了，也可以</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    (v1: <span class="built_in">Int</span>, v2: <span class="built_in">Int</span>) -&gt; <span class="built_in">Int</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> v1 + v2</span><br><span class="line">&#125;(<span class="number">10</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure><p>总结起来就是</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="params">(参数列表)</span> -&gt;</span> 返回值类型 <span class="keyword">in</span> 函数体代码</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="闭包表达式的简写"><a href="#闭包表达式的简写" class="headerlink" title="闭包表达式的简写"></a>闭包表达式的简写</h2><p>我们定义如下的函数 exec ，它接收三个参数，分别为两个Int 和一个函数，而且这个函数，接收两个Int 参数，返回一个Int结果，exec 的作用就是，把前两个参数传给第三个参数(也就是函数)去执行，然后结果打印出来</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// 函数 我们定义如下的函数 exec ，它接收三个参数，分别为两个<span class="built_in">Int</span> 和一个函数，而且这个函数，接收两个<span class="built_in">Int</span> 参数，返回一个<span class="built_in">Int</span>结果，exec 的作用就是，把前两个参数传给第三个参数(也就是函数)去执行，然后结果打印出来</span><br><span class="line">func exec(v1: <span class="built_in">Int</span>, v2: <span class="built_in">Int</span>, fn: (<span class="built_in">Int</span>, <span class="built_in">Int</span>) -&gt; <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(fn(v1, v2))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果用闭包表达式来定义的话</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 闭包表达式</span><br><span class="line"><span class="symbol">exec</span>(<span class="built_in">v1</span>: <span class="number">10</span>, <span class="built_in">v2</span>: <span class="number">20</span>, <span class="meta">fn</span>: &#123;</span><br><span class="line">    (<span class="built_in">v1</span>: Int, <span class="built_in">v2</span>: Int) -&gt; Int in</span><br><span class="line">    return <span class="built_in">v1</span> + <span class="built_in">v2</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>当然了，我们可以省略很多，如下</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// 省略参数类型 因为<span class="keyword">swift可以自己推断类型</span></span><br><span class="line"><span class="keyword">exec(v1: </span><span class="number">10</span>, <span class="built_in">v2</span>: <span class="number">20</span>, <span class="meta">fn</span>: &#123;</span><br><span class="line">    <span class="built_in">v1</span>, <span class="built_in">v2</span> in return <span class="built_in">v1</span> + <span class="built_in">v2</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// return 也可以省略</span><br><span class="line"><span class="symbol">exec</span>(<span class="built_in">v1</span>: <span class="number">10</span>, <span class="built_in">v2</span>: <span class="number">20</span>, <span class="meta">fn</span>: &#123;</span><br><span class="line">    <span class="built_in">v1</span>, <span class="built_in">v2</span> in <span class="built_in">v1</span> + <span class="built_in">v2</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 省略掉参数列表，用<span class="number">$0</span>代表第<span class="number">0</span>个参数，<span class="number">$1</span>代表第<span class="number">1</span>个参数</span><br><span class="line"><span class="symbol">exec</span>(<span class="built_in">v1</span>: <span class="number">10</span>, <span class="built_in">v2</span>: <span class="number">20</span>, <span class="meta">fn</span>: &#123;</span><br><span class="line">    <span class="number">$0</span> + <span class="number">$1</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 终极省略</span><br><span class="line"><span class="symbol">exec</span>(<span class="built_in">v1</span>: <span class="number">10</span>, <span class="built_in">v2</span>: <span class="number">20</span>, <span class="meta">fn</span>: +)</span><br></pre></td></tr></table></figure><h2 id="尾随闭包"><a href="#尾随闭包" class="headerlink" title="尾随闭包"></a>尾随闭包</h2><ul><li>如果将一个很长的闭包表达式作为函数的最后一个实参，使用尾随闭包可以增强函数的可读性<ul><li>尾随闭包是一个被书写在函数调用括号外面(后面)的闭包表达式</li></ul></li></ul><p>有如下的函数 闭包表达式作为函数的最后一个实参</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exec</span><span class="params">(v1: Int, v2: Int, fn: <span class="params">(Int, Int)</span></span></span> -&gt; <span class="type">Int</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(fn(v1, v2))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用尾随闭包为</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exec(v1: <span class="number">10</span>, v2: <span class="number">20</span>) &#123;</span><br><span class="line">    $<span class="number">0</span> + $<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>如果闭包表达式是函数的唯一实参，而且使用了尾随闭包的语法，那就不需要在函数名后边写圆括号</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 这个闭包表达式表达式是函数的唯一实参</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exec</span><span class="params">(fn: <span class="params">(Int, Int)</span></span></span> -&gt; <span class="type">Int</span>) &#123; </span><br><span class="line"><span class="built_in">print</span>(fn(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以使用尾随闭包如下</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 使用尾随闭包如下三种都可以</span></span><br><span class="line"><span class="keyword">exec</span>(fn: &#123; $0 + $1 &#125;)</span><br><span class="line"><span class="keyword">exec</span>() &#123; $0 + $1 &#125;</span><br><span class="line"><span class="keyword">exec</span> &#123; $0 + $1 &#125;</span><br></pre></td></tr></table></figure><h2 id="尾随闭包实战"><a href="#尾随闭包实战" class="headerlink" title="尾随闭包实战"></a>尾随闭包实战</h2><h3 id="系统自带的排序"><a href="#系统自带的排序" class="headerlink" title="系统自带的排序"></a>系统自带的排序</h3><p>假设我们有个包含Int元素的数组，想对立面的元素进行排序</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">numberSort</span><span class="params">()</span></span>  &#123;</span><br><span class="line">    <span class="keyword">var</span> arr = [<span class="number">6</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">10</span>]</span><br><span class="line">    arr.<span class="built_in">sort</span>()</span><br><span class="line">    <span class="built_in">print</span>(arr) <span class="comment">//[1, 6, 8, 10]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">numberSort()</span><br></pre></td></tr></table></figure><p>打印结果为</p><blockquote><p>[1, 6, 8, 10]</p></blockquote><p>查看官方对sort的源码为</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 官方代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sort</span><span class="params">(by areInIncreasingOrder: <span class="params">(Element, Element)</span></span></span> -&gt; <span class="type">Bool</span>)</span><br></pre></td></tr></table></figure><h3 id="自定义排序"><a href="#自定义排序" class="headerlink" title="自定义排序"></a>自定义排序</h3><p>假如我们想自定义排序</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/// 返回<span class="keyword">true</span>: <span class="keyword">i1</span>排在<span class="keyword">i2</span>前面</span><br><span class="line">/// 返回<span class="keyword">false</span>: <span class="keyword">i1</span>排在<span class="keyword">i2</span>后面</span><br><span class="line">func cmp(<span class="keyword">i1</span>: Int, <span class="keyword">i2</span>: Int) -&gt; Bool &#123;</span><br><span class="line">    // 大的排在前面</span><br><span class="line">    return <span class="keyword">i1</span> &gt; <span class="keyword">i2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用的时候</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">var nums = [<span class="number">6</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">10</span>]</span><br><span class="line">nums.sort(by: cmp)</span><br><span class="line">print(nums)</span><br></pre></td></tr></table></figure><p>打印结果为</p><blockquote><p>[10, 8, 6, 1]</p></blockquote><h3 id="用尾随闭包书写"><a href="#用尾随闭包书写" class="headerlink" title="用尾随闭包书写"></a>用尾随闭包书写</h3><p>上面的代码 </p><p>可以写成</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">nums.sort(<span class="keyword">by</span>: &#123;</span><br><span class="line">    (i1: <span class="built_in">Int</span>, i2: <span class="built_in">Int</span>) -&gt; Bool <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> i1 &gt; i2</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>也可以等价于下面几种</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">nums.<span class="keyword">sort</span>(<span class="keyword">by</span>: &#123; i1, i2 <span class="keyword">in</span> <span class="keyword">return</span> i1 &gt; i2 &#125;)</span><br><span class="line">nums.<span class="keyword">sort</span>(<span class="keyword">by</span>: &#123; i1, i2 <span class="keyword">in</span> i1 &gt; i2 &#125;)</span><br><span class="line">nums.<span class="keyword">sort</span>(<span class="keyword">by</span>: &#123; <span class="variable">$0</span> &gt; <span class="variable">$1</span> &#125;)</span><br><span class="line">nums.<span class="keyword">sort</span>(<span class="keyword">by</span>: &gt; )</span><br><span class="line">nums.<span class="keyword">sort</span>() &#123; <span class="variable">$0</span> &gt; <span class="variable">$1</span> &#125;</span><br><span class="line">nums.<span class="keyword">sort</span> &#123; <span class="variable">$0</span> &gt; <span class="variable">$1</span> &#125;</span><br></pre></td></tr></table></figure><h2 id="忽略参数"><a href="#忽略参数" class="headerlink" title="忽略参数"></a>忽略参数</h2><p>Swift中，很多时候，如果我们对于参数不做处理，可以用 下划线 _ 来代替</p><p>例如下面的闭包</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">func <span class="built_in">exec</span>(fn: (Int, Int) -&gt; Int) &#123;</span><br><span class="line">    <span class="keyword">print</span>(<span class="keyword">fn</span>(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(<span class="built_in">exec</span>&#123;_,_ in <span class="number">100</span> &#125;)  <span class="comment">// 100</span></span><br></pre></td></tr></table></figure><p>输出  </p><blockquote><p>100</p></blockquote><h2 id="自动闭包"><a href="#自动闭包" class="headerlink" title="自动闭包"></a>自动闭包</h2><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>假设我们定义一个这样的函数，要求 如果第1个数大于0，返回第一个数。否则返回第2个数</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">func getFirstPositive(_ v1: Int, _ v2:  Int) -&gt; Int? &#123;</span><br><span class="line">    <span class="keyword">return</span> v1 &gt; <span class="number">0</span> ? v1 : v2</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line">getFirstPositive(<span class="number">10</span>, <span class="number">20</span>) <span class="comment">// 10</span></span><br><span class="line">getFirstPositive(<span class="number">-2</span>, <span class="number">20</span>) <span class="comment">// 20</span></span><br><span class="line">getFirstPositive(<span class="number">0</span>, <span class="number">-4</span>) <span class="comment">// -4</span></span><br></pre></td></tr></table></figure><p>现在假如说，我们这么传入的话</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getNum</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line"><span class="comment">// 这里每次都执行</span></span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">100</span></span><br><span class="line">    <span class="keyword">let</span> b = <span class="number">200</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getFirstPositive2</span><span class="params">(<span class="number">_</span> v1: Int, <span class="number">_</span> v2:  Int)</span></span> -&gt; <span class="type">Int?</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> v1 &gt; <span class="number">0</span> ? v1 : v2</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getFirstPositive2(<span class="number">10</span>, getNum())</span><br></pre></td></tr></table></figure><h3 id="改成函数类型的参数"><a href="#改成函数类型的参数" class="headerlink" title="改成函数类型的参数"></a>改成函数类型的参数</h3><p>因为第一个参数已经是10 大于0了，第二个参数，也就是getNum() 根本没必要去执行，浪费性能，所以，有没有什么办法能做到，当第一个参数不满足时候，才去执行getNum()呢？答案是有的</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 改成函数类型的参数，可以让v2延迟加载</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getFirstPositive2</span><span class="params">(<span class="number">_</span> v1: Int, <span class="number">_</span> v2: <span class="params">()</span></span></span> -&gt; <span class="type">Int</span>) -&gt; <span class="type">Int?</span> &#123;</span><br><span class="line"><span class="comment">// 这里判断 v1 &gt; 0 不会调用 v2()</span></span><br><span class="line">    <span class="keyword">return</span> v1 &gt; <span class="number">0</span> ? v1 : v2()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getFirstPositive2(<span class="number">10</span>, &#123;</span><br><span class="line"><span class="comment">// 第一个参数大于0的时候，这里不会执行</span></span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">100</span></span><br><span class="line">    <span class="keyword">let</span> b = <span class="number">200</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h3><p>如果改成这样写就报错了</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/ 改成函数类型的参数，可以让v2延迟加载</span><br><span class="line">func getFirstPositive2(_ v1: <span class="type">Int</span>, _ v2: () -&gt; <span class="type">Int</span>) -&gt; <span class="type">Int</span>? &#123;</span><br><span class="line">// 这里判断 v1 &gt; <span class="number">0</span> 不会调用 v2()</span><br><span class="line">    <span class="keyword">return</span> v1 &gt; <span class="number">0</span> ? v1 : v2()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getFirstPositive2(<span class="number">10</span>,  <span class="number">20</span>) //报错 Cannot convert <span class="keyword">value</span> <span class="keyword">of</span> <span class="keyword">type</span> <span class="string">'Int'</span> <span class="keyword">to</span> expected argument <span class="keyword">type</span> <span class="string">'() -&gt; Int'</span></span><br></pre></td></tr></table></figure><p>因为需要的是() -&gt; Int类型，给的是Int</p><p>我们可以写成下面两种都可以</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/ 改成函数类型的参数，可以让v2延迟加载</span><br><span class="line">func getFirstPositive2(_ v1: Int, _ v2: () -&gt; Int) -&gt; Int? &#123;</span><br><span class="line">// 这里判断 v1 &gt; 0 不会调用 v2()</span><br><span class="line">   <span class="built_in"> return </span>v1 &gt; 0 ? v1<span class="keyword"> :</span> v2()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getFirstPositive2(10) &#123; 20&#125;</span><br><span class="line"></span><br><span class="line">getFirstPositive2(10, &#123;20&#125;)</span><br></pre></td></tr></table></figure><h3 id="autoclosure"><a href="#autoclosure" class="headerlink" title="@autoclosure"></a>@autoclosure</h3><p>上面的也可以用自动闭包技术</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">func</span> <span class="selector-tag">getFirstPositive3</span>(_ <span class="attribute">v1</span>: Int, _ <span class="attribute">v2</span>: <span class="variable">@autoclosure</span> () -&gt; Int) <span class="selector-tag">-</span>&gt; <span class="selector-tag">Int</span>? &#123;</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">v1</span> &gt; <span class="selector-tag">0</span> ? <span class="selector-tag">v1</span> : <span class="selector-tag">v2</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">getFirstPositive3</span>(-<span class="number">4</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure><h3 id="需要的注意点："><a href="#需要的注意点：" class="headerlink" title="需要的注意点："></a>需要的注意点：</h3><ul><li>为了避免与期望冲突，使用了@autoclosure的地方最好明确注释清楚:这个值会被推迟执行</li><li>@autoclosure 会自动将 20 封装成闭包 { 20 }</li><li>@autoclosure 只支持 () -&gt; T 格式的参数 n@autoclosure 并非只支持最后1个参数</li><li>空合并运算符 ?? 使用了 @autoclosure 技术</li><li>有@autoclosure、无@autoclosure，构成了函数重载</li></ul><p><a href="https://github.com/apple/Swift" target="_blank" rel="noopener">Swift官方源码</a></p><p><a href="https://ke.qq.com/course/392094" target="_blank" rel="noopener">从入门到精通Swift编程</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/Swift%E4%B9%8B%E9%97%AD%E5%8C%85(Closure).html&quot;&gt;我的个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;什么是闭包&quot;&gt;&lt;a href=&quot;#什么是闭包&quot;
      
    
    </summary>
    
    
      <category term="Swift" scheme="https://ityongzhen.github.io/categories/Swift/"/>
    
    
  </entry>
  
  <entry>
    <title>Swift之结构体</title>
    <link href="https://ityongzhen.github.io/Swift%E4%B9%8B%E7%BB%93%E6%9E%84%E4%BD%93.html/"/>
    <id>https://ityongzhen.github.io/Swift%E4%B9%8B%E7%BB%93%E6%9E%84%E4%BD%93.html/</id>
    <published>2019-07-16T00:32:24.000Z</published>
    <updated>2019-12-12T06:20:27.548Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/Swift之结构体.html">我的个人博客</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul><li>在 Swift 标准库中，绝大多数的公开类型都是结构体，而枚举和类只占很小一部分 <ul><li>比如Bool、Int、Double、 String、Array、Dictionary等常见类型都是结构体</li></ul></li></ul><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">struct <span class="built_in">Date</span> &#123;</span><br><span class="line">var <span class="built_in">year</span>: <span class="built_in">Int</span></span><br><span class="line">var <span class="built_in">month</span>: <span class="built_in">Int</span></span><br><span class="line">var <span class="built_in">day</span>: <span class="built_in">Int</span></span><br><span class="line">&#125;</span><br><span class="line">var <span class="built_in">date</span> = <span class="built_in">Date</span>(<span class="built_in">year</span>: <span class="number">2019</span>, <span class="built_in">month</span>: <span class="number">6</span>, <span class="built_in">day</span>: <span class="number">23</span>)</span><br></pre></td></tr></table></figure><ul><li>所有的结构体都有一个编译器自动生成的初始化器(initializer，初始化方法、构造器、构造方法) <ul><li>在最后一行调用的，可以传入所有成员值，用以初始化所有成员(存储属性，Stored Property)</li></ul></li></ul><h2 id="结构体的初始化器"><a href="#结构体的初始化器" class="headerlink" title="结构体的初始化器"></a>结构体的初始化器</h2><ul><li>编译器会根据情况，可能会为结构体生成多个初始化器，宗旨是:保证所有成员都有初始值</li></ul><p>eg:</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">struct Point&#123;</span><br><span class="line">    var x: Int</span><br><span class="line">    var y: Int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var p1 = Point(x: 10, y: <span class="number">20</span>)</span><br><span class="line">var p2 = Point(y: <span class="number">20</span>) //报错 <span class="literal">Missing</span> argument <span class="keyword">for</span> parameter <span class="string">'x'</span> <span class="keyword">in</span> <span class="keyword">call</span></span><br><span class="line">var p3 = Point(x: <span class="number">10</span>) //报错 <span class="literal">Missing</span> argument <span class="keyword">for</span> parameter <span class="string">'y'</span> <span class="keyword">in</span> <span class="keyword">call</span></span><br><span class="line">var p4 = Point()    //报错 <span class="literal">Missing</span> argument <span class="keyword">for</span> parameter <span class="string">'x'</span> <span class="keyword">in</span> <span class="keyword">call</span></span><br></pre></td></tr></table></figure><p>如果给定一个初始值</p><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">struct Point&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="symbol">x</span>: Int = <span class="number">10</span></span><br><span class="line">    <span class="keyword">var</span> <span class="symbol">y</span>: Int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = Point(<span class="symbol">x</span>: <span class="number">10</span>, <span class="symbol">y</span>: <span class="number">20</span>)</span><br><span class="line"><span class="keyword">var</span> p2 = Point(<span class="symbol">y</span>: <span class="number">20</span>)</span><br><span class="line"><span class="keyword">var</span> p3 = Point(<span class="symbol">x</span>: <span class="number">10</span>) <span class="comment">//报错 Missing argument for parameter 'y' in call</span></span><br><span class="line"><span class="keyword">var</span> p4 = Point()    <span class="comment">//报错 Missing argument for parameter 'y' in call</span></span><br></pre></td></tr></table></figure><p>如果x 和 y都有初始值的话，就怎么都不会报错了，因为 所有成员都有初始值</p><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">struct Point&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="symbol">x</span>: Int = <span class="number">10</span></span><br><span class="line">    <span class="keyword">var</span> <span class="symbol">y</span>: Int = <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = Point(<span class="symbol">x</span>: <span class="number">10</span>, <span class="symbol">y</span>: <span class="number">20</span>)</span><br><span class="line"><span class="keyword">var</span> p2 = Point(<span class="symbol">y</span>: <span class="number">20</span>)</span><br><span class="line"><span class="keyword">var</span> p3 = Point(<span class="symbol">x</span>: <span class="number">10</span>) </span><br><span class="line"><span class="keyword">var</span> p4 = Point()</span><br></pre></td></tr></table></figure><p>初始值为nil的话，也可以编译通过，比如下面这种</p><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">struct Point&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="symbol">x</span>: Int?</span><br><span class="line">    <span class="keyword">var</span> <span class="symbol">y</span>: Int?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = Point(<span class="symbol">x</span>: <span class="number">10</span>, <span class="symbol">y</span>: <span class="number">20</span>)</span><br><span class="line"><span class="keyword">var</span> p2 = Point(<span class="symbol">y</span>: <span class="number">20</span>)</span><br><span class="line"><span class="keyword">var</span> p3 = Point(<span class="symbol">x</span>: <span class="number">10</span>) </span><br><span class="line"><span class="keyword">var</span> p4 = Point()</span><br></pre></td></tr></table></figure><h2 id="自定义初始化器"><a href="#自定义初始化器" class="headerlink" title="自定义初始化器"></a>自定义初始化器</h2><ul><li>一旦在定义结构体时自定义了初始化器，编译器就不会再帮它自动生成其他初始化器</li></ul><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">struct Point&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="symbol">x</span>: Int = <span class="number">10</span></span><br><span class="line">    <span class="keyword">var</span> <span class="symbol">y</span>: Int = <span class="number">20</span></span><br><span class="line">    init(<span class="symbol">x</span>: Int, <span class="symbol">y</span>: Int) &#123;</span><br><span class="line">        <span class="literal">self</span>.<span class="symbol">x</span> = <span class="symbol">x</span></span><br><span class="line">        <span class="literal">self</span>.<span class="symbol">y</span> = <span class="symbol">y</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = Point(<span class="symbol">x</span>: <span class="number">10</span>, <span class="symbol">y</span>: <span class="number">20</span>)</span><br><span class="line"><span class="keyword">var</span> p2 = Point(<span class="symbol">y</span>: <span class="number">20</span>) <span class="comment">//报错 Missing argument for parameter 'x' in call</span></span><br><span class="line"><span class="keyword">var</span> p3 = Point(<span class="symbol">x</span>: <span class="number">10</span>) <span class="comment">//报错 Missing argument for parameter 'y' in call</span></span><br><span class="line"><span class="keyword">var</span> p4 = Point()    <span class="comment">//报错 Missing argument for parameter 'x' in call</span></span><br></pre></td></tr></table></figure><h2 id="窥探初始化器的本质"><a href="#窥探初始化器的本质" class="headerlink" title="窥探初始化器的本质"></a>窥探初始化器的本质</h2><h3 id="以下2段代码完全等效"><a href="#以下2段代码完全等效" class="headerlink" title="以下2段代码完全等效"></a>以下2段代码完全等效</h3><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">struct Point &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="symbol">x</span>: Int = <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> <span class="symbol">y</span>: Int = <span class="number">0</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">struct Point &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="symbol">x</span>: Int</span><br><span class="line">    <span class="keyword">var</span> <span class="symbol">y</span>: Int</span><br><span class="line">init() &#123; </span><br><span class="line"><span class="symbol">x</span>=<span class="number">0</span> </span><br><span class="line"><span class="symbol">y</span>=<span class="number">0</span></span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> x: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">        <span class="keyword">var</span> y: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> p = <span class="type">Point</span>() <span class="comment">//这一行打断点</span></span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line">&#125;</span><br><span class="line">test()</span><br></pre></td></tr></table></figure><p>和</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> x: <span class="type">Int</span> </span><br><span class="line">        <span class="keyword">var</span> y: <span class="type">Int</span> </span><br><span class="line">      <span class="keyword">init</span>() &#123;</span><br><span class="line">           x=<span class="number">0</span></span><br><span class="line">            y=<span class="number">0</span></span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> p = <span class="type">Point</span>() <span class="comment">//这一行打断点</span></span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line">&#125;</span><br><span class="line">test()</span><br></pre></td></tr></table></figure><p>查看汇编，两段代码都是</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">testSwift`init() <span class="keyword">in</span> Point #<span class="number">1</span> <span class="keyword">in</span> test():</span><br><span class="line">-&gt;  <span class="number">0x100001d50</span> &lt;+<span class="number">0</span>&gt;:  pushq  %rbp</span><br><span class="line">    <span class="number">0x100001d51</span> &lt;+<span class="number">1</span>&gt;:  movq   %rsp, %rbp</span><br><span class="line">    <span class="number">0x100001d54</span> &lt;+<span class="number">4</span>&gt;:  xorps  %xmm0, %xmm0</span><br><span class="line">    <span class="number">0x100001d57</span> &lt;+<span class="number">7</span>&gt;:  movaps %xmm0, <span class="number">-0x10</span>(%rbp)</span><br><span class="line">    <span class="number">0x100001d5b</span> &lt;+<span class="number">11</span>&gt;: movq   $<span class="number">0x0</span>, <span class="number">-0x10</span>(%rbp)</span><br><span class="line">    <span class="number">0x100001d63</span> &lt;+<span class="number">19</span>&gt;: movq   $<span class="number">0x0</span>, <span class="number">-0x8</span>(%rbp)</span><br><span class="line">    <span class="number">0x100001d6b</span> &lt;+<span class="number">27</span>&gt;: xorl   %eax, %eax</span><br><span class="line">    <span class="number">0x100001d6d</span> &lt;+<span class="number">29</span>&gt;: movl   %eax, %ecx</span><br><span class="line">    <span class="number">0x100001d6f</span> &lt;+<span class="number">31</span>&gt;: movq   %rcx, %rax</span><br><span class="line">    <span class="number">0x100001d72</span> &lt;+<span class="number">34</span>&gt;: movq   %rcx, %rdx</span><br><span class="line">    <span class="number">0x100001d75</span> &lt;+<span class="number">37</span>&gt;: popq   %rbp</span><br><span class="line">    <span class="number">0x100001d76</span> &lt;+<span class="number">38</span>&gt;: retq</span><br></pre></td></tr></table></figure><p>这两段代码的汇编一样的，也就是说，这两段代码完全等效</p><h2 id="结构体的内存结构"><a href="#结构体的内存结构" class="headerlink" title="结构体的内存结构"></a>结构体的内存结构</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">struct Point &#123;</span><br><span class="line">       <span class="selector-tag">var</span> x: Int = <span class="number">0</span></span><br><span class="line">       <span class="selector-tag">var</span> y: Int = <span class="number">0</span></span><br><span class="line">       <span class="selector-tag">var</span> origin: Bool = true</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(MemoryLayout&lt;Point&gt;.size)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(MemoryLayout&lt;Point&gt;.stride)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(MemoryLayout&lt;Point&gt;.alignment)</span></span></span><br></pre></td></tr></table></figure><p>打印结果为</p><blockquote><p>17</p></blockquote><blockquote><p>24</p></blockquote><blockquote><p>8</p></blockquote><p>是因为内存对齐的缘故，17是因为 实际使用的是 8+8+1 = 17<br>24 是因为，要内存对齐，8*3 = 24</p><p>参考资料:</p><p><a href="https://github.com/apple/Swift" target="_blank" rel="noopener">Swift官方源码</a></p><p><a href="https://ke.qq.com/course/392094" target="_blank" rel="noopener">从入门到精通Swift编程</a></p><p><a href="https://github.com/CoderMJLee/Mems" target="_blank" rel="noopener">窥探内存细节的小工具</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/Swift之结构体.html&quot;&gt;我的个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;
      
    
    </summary>
    
    
      <category term="Swift" scheme="https://ityongzhen.github.io/categories/Swift/"/>
    
    
  </entry>
  
  <entry>
    <title>Swift之类</title>
    <link href="https://ityongzhen.github.io/Swift%E4%B9%8B%E7%B1%BB.html/"/>
    <id>https://ityongzhen.github.io/Swift%E4%B9%8B%E7%B1%BB.html/</id>
    <published>2019-07-08T00:32:24.000Z</published>
    <updated>2019-12-12T06:19:53.749Z</updated>
    
    <content type="html"><![CDATA[<p>文章首发于<a href="https://ityongzhen.github.io/Swift之类.html">我的个人博客</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>类的定义和结构体类似，但编译器并没有为类自动生成可以传入成员值的初始化器<br>eg 如下代码不会报错</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> Point &#123;</span><br><span class="line">    var x: Int = <span class="number">0</span></span><br><span class="line">var y: Int = <span class="number">0</span> </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> p1 = <span class="constructor">Point()</span></span><br><span class="line"><span class="keyword">let</span> p2 = <span class="constructor">Point(<span class="params">x</span>: 10, <span class="params">y</span>: 20)</span></span><br><span class="line"><span class="keyword">let</span> p3 = <span class="constructor">Point(<span class="params">x</span>: 10)</span></span><br><span class="line"><span class="keyword">let</span> p4 = <span class="constructor">Point(<span class="params">y</span>: 20)</span></span><br></pre></td></tr></table></figure><p>但是如果改成了类就不能编译通过</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="type">Point</span> &#123;</span><br><span class="line">    var x: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    var y: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">let p1 = <span class="type">Point</span>()</span><br><span class="line">let p2 = <span class="type">Point</span>(x: <span class="number">10</span>, y: <span class="number">20</span>)//报错Argument passed <span class="keyword">to</span> <span class="keyword">call</span> that takes <span class="keyword">no</span> arguments</span><br><span class="line">let p3 = <span class="type">Point</span>(x: <span class="number">10</span>)//报错Argument passed <span class="keyword">to</span> <span class="keyword">call</span> that takes <span class="keyword">no</span> arguments</span><br><span class="line">let p4 = <span class="type">Point</span>(y: <span class="number">20</span>)//报错Argument passed <span class="keyword">to</span> <span class="keyword">call</span> that takes <span class="keyword">no</span> arguments</span><br></pre></td></tr></table></figure><h2 id="类的初始化器"><a href="#类的初始化器" class="headerlink" title="类的初始化器"></a>类的初始化器</h2><ul><li>如果类的所有成员都在定义的时候指定了初始值，编译器会为类生成无参的初始化器  </li><li>成员的初始化是在这个初始化器中完成的</li></ul><h3 id="以下2段代码完全等效"><a href="#以下2段代码完全等效" class="headerlink" title="以下2段代码完全等效"></a>以下2段代码完全等效</h3><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">struct Point &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="symbol">x</span>: Int = <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> <span class="symbol">y</span>: Int = <span class="number">0</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">struct Point &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="symbol">x</span>: Int</span><br><span class="line">    <span class="keyword">var</span> <span class="symbol">y</span>: Int</span><br><span class="line">init() &#123; </span><br><span class="line"><span class="symbol">x</span>=<span class="number">0</span> </span><br><span class="line"><span class="symbol">y</span>=<span class="number">0</span></span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="结构体与类的本质区别"><a href="#结构体与类的本质区别" class="headerlink" title="结构体与类的本质区别"></a>结构体与类的本质区别</h2><h3 id="结构体是值类型-枚举也是值类型-，类是引用类型-指针类型"><a href="#结构体是值类型-枚举也是值类型-，类是引用类型-指针类型" class="headerlink" title="结构体是值类型(枚举也是值类型)，类是引用类型(指针类型)"></a>结构体是值类型(枚举也是值类型)，类是引用类型(指针类型)</h3><p>eg:我们有如下的结构体point 和类 size</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类size</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Size</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> width = <span class="number">1</span></span><br><span class="line">    <span class="keyword">var</span> height = <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类 Point</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">3</span></span><br><span class="line">    <span class="keyword">var</span> y = <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 变量 size 接收类Size</span></span><br><span class="line"><span class="keyword">var</span> size = <span class="type">Size</span>()</span><br><span class="line"><span class="comment">// 变量 point 接收结构体point</span></span><br><span class="line"><span class="keyword">var</span> point = <span class="type">Point</span>()</span><br></pre></td></tr></table></figure><p>我们假设 执行完test() 之后，point的内存地址为 0x10000 size的内存地址为 0x10010<br>可以用一幅图来表示</p><p><img src="https://user-gold-cdn.xitu.io/2019/7/7/16bca935cf3172a9?w=923&h=410&f=png&s=139924" alt=""></p><p>上图表示，point是值拷贝，直接把  3 和 4 放在了point对应的内存中，而 指针变量size是引用拷贝，是放了 Size() 的指针 0x90000 ，而对应的 堆空间 0x90000中才真正的存放1和2，当然了，前面有16个字节，存放了类的信息，和引用计数，因为Swift和OC一样使用的引用计数来内存管理的，所以Size对象用了32个字节</p><h3 id="汇编验证"><a href="#汇编验证" class="headerlink" title="汇编验证"></a>汇编验证</h3><p>代码如下</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">unc test1()&#123;</span><br><span class="line">    <span class="comment">// 类size</span></span><br><span class="line">    class Size &#123;</span><br><span class="line">        <span class="selector-tag">var</span> <span class="attribute">width</span> = <span class="number">1</span></span><br><span class="line">        <span class="selector-tag">var</span> <span class="attribute">height</span> = <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类 Point</span></span><br><span class="line">    struct Point &#123;</span><br><span class="line">        <span class="selector-tag">var</span> x = <span class="number">3</span></span><br><span class="line">        <span class="selector-tag">var</span> y = <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line">    <span class="comment">// 变量 point 接收结构体point</span></span><br><span class="line">    <span class="selector-tag">var</span> point = Point()</span><br><span class="line">     <span class="comment">// 变量 size 接收类Size</span></span><br><span class="line">    <span class="selector-tag">var</span> size = Size()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">test1</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><h4 id="汇编验证验证结构体"><a href="#汇编验证验证结构体" class="headerlink" title="汇编验证验证结构体"></a>汇编验证验证结构体</h4><p>上面的代码，先在 var point = Point() 处打断点</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">testSwift`__allocating_init() <span class="keyword">in</span> Size #<span class="number">1</span> <span class="keyword">in</span> test1():</span><br><span class="line">    <span class="number">0x100001030</span> &lt;+<span class="number">0</span>&gt;:  pushq  %rbp</span><br><span class="line">    <span class="number">0x100001031</span> &lt;+<span class="number">1</span>&gt;:  movq   %rsp, %rbp</span><br><span class="line">    <span class="number">0x100001034</span> &lt;+<span class="number">4</span>&gt;:  pushq  %r13</span><br><span class="line">    <span class="number">0x100001036</span> &lt;+<span class="number">6</span>&gt;:  subq   $<span class="number">0x18</span>, %rsp</span><br><span class="line">    <span class="number">0x10000103a</span> &lt;+<span class="number">10</span>&gt;: xorl   %eax, %eax</span><br><span class="line">    <span class="number">0x10000103c</span> &lt;+<span class="number">12</span>&gt;: movl   %eax, %edi</span><br><span class="line">-&gt;  <span class="number">0x10000103e</span> &lt;+<span class="number">14</span>&gt;: callq  <span class="number">0x100001250</span>               ; type metadata accessor <span class="keyword">for</span> Size #<span class="number">1</span> <span class="keyword">in</span> testSwift.test1() -&gt; () at &lt;compiler-generated&gt;</span><br><span class="line">    <span class="number">0x100001043</span> &lt;+<span class="number">19</span>&gt;: movl   $<span class="number">0x20</span>, %ecx</span><br><span class="line">    <span class="number">0x100001048</span> &lt;+<span class="number">24</span>&gt;: movl   %ecx, %esi</span><br><span class="line">    <span class="number">0x10000104a</span> &lt;+<span class="number">26</span>&gt;: movl   $<span class="number">0x7</span>, %ecx</span><br><span class="line">    <span class="number">0x10000104f</span> &lt;+<span class="number">31</span>&gt;: movl   %ecx, %edi</span><br><span class="line">    <span class="number">0x100001051</span> &lt;+<span class="number">33</span>&gt;: movq   %rdi, <span class="number">-0x10</span>(%rbp)</span><br><span class="line">    <span class="number">0x100001055</span> &lt;+<span class="number">37</span>&gt;: movq   %rax, %rdi</span><br><span class="line">    <span class="number">0x100001058</span> &lt;+<span class="number">40</span>&gt;: movq   <span class="number">-0x10</span>(%rbp), %rax</span><br><span class="line">    <span class="number">0x10000105c</span> &lt;+<span class="number">44</span>&gt;: movq   %rdx, <span class="number">-0x18</span>(%rbp)</span><br><span class="line">    <span class="number">0x100001060</span> &lt;+<span class="number">48</span>&gt;: movq   %rax, %rdx</span><br><span class="line">    <span class="number">0x100001063</span> &lt;+<span class="number">51</span>&gt;: callq  <span class="number">0x100005046</span>               ; symbol stub <span class="keyword">for</span>: swift_allocObject</span><br><span class="line">    <span class="number">0x100001068</span> &lt;+<span class="number">56</span>&gt;: movq   %rax, %r13</span><br><span class="line">    <span class="number">0x10000106b</span> &lt;+<span class="number">59</span>&gt;: callq  <span class="number">0x100001e30</span>               ; init() -&gt; Size #<span class="number">1</span> <span class="keyword">in</span> testSwift.test1() -&gt; () <span class="keyword">in</span> Size #<span class="number">1</span> <span class="keyword">in</span> testSwift.test1() -&gt; () at main.swift:<span class="number">15</span></span><br><span class="line">    <span class="number">0x100001070</span> &lt;+<span class="number">64</span>&gt;: addq   $<span class="number">0x18</span>, %rsp</span><br><span class="line">    <span class="number">0x100001074</span> &lt;+<span class="number">68</span>&gt;: popq   %r13</span><br><span class="line">    <span class="number">0x100001076</span> &lt;+<span class="number">70</span>&gt;: popq   %rbp</span><br><span class="line">    <span class="number">0x100001077</span> &lt;+<span class="number">71</span>&gt;: retq</span><br></pre></td></tr></table></figure><p>从 </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x10000103e &lt;+14&gt;: callq  0x100001250 ;<span class="built_in"> type </span>metadata accessor <span class="keyword">for</span> Size #1 <span class="keyword">in</span> testSwift.test1() -&gt; () at &lt;compiler-generated&gt;</span><br></pre></td></tr></table></figure><p>处执行lldb命令 si 跟踪进去</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">testSwift`init() <span class="keyword">in</span> Point #<span class="number">1</span> <span class="keyword">in</span> test1():</span><br><span class="line">-&gt;  <span class="number">0x100001030</span> &lt;+<span class="number">0</span>&gt;:  pushq  %rbp</span><br><span class="line">    <span class="number">0x100001031</span> &lt;+<span class="number">1</span>&gt;:  movq   %rsp, %rbp</span><br><span class="line">    <span class="number">0x100001034</span> &lt;+<span class="number">4</span>&gt;:  xorps  %xmm0, %xmm0</span><br><span class="line">    <span class="number">0x100001037</span> &lt;+<span class="number">7</span>&gt;:  movaps %xmm0, <span class="number">-0x10</span>(%rbp)</span><br><span class="line">    <span class="number">0x10000103b</span> &lt;+<span class="number">11</span>&gt;: movq   $<span class="number">0x3</span>, <span class="number">-0x10</span>(%rbp)</span><br><span class="line">    <span class="number">0x100001043</span> &lt;+<span class="number">19</span>&gt;: movq   $<span class="number">0x4</span>, <span class="number">-0x8</span>(%rbp)</span><br><span class="line">    <span class="number">0x10000104b</span> &lt;+<span class="number">27</span>&gt;: movl   $<span class="number">0x3</span>, %eax</span><br><span class="line">    <span class="number">0x100001050</span> &lt;+<span class="number">32</span>&gt;: movl   $<span class="number">0x4</span>, %ecx</span><br><span class="line">    <span class="number">0x100001055</span> &lt;+<span class="number">37</span>&gt;: movl   %ecx, %edx</span><br><span class="line">    <span class="number">0x100001057</span> &lt;+<span class="number">39</span>&gt;: popq   %rbp</span><br><span class="line">    <span class="number">0x100001058</span> &lt;+<span class="number">40</span>&gt;: retq</span><br></pre></td></tr></table></figure><p>可以看到赋值操作 直接是把 $0x3 和 $0x4 赋值给栈空间 (-0x10(%rbp) 和 -0x8(%rbp) )的，没有调用malloc alloc 等方法，也就是没有开辟堆空间</p><h4 id="汇编验证验证类"><a href="#汇编验证验证类" class="headerlink" title="汇编验证验证类"></a>汇编验证验证类</h4><p>上面的代码，先在 var size = Size() 处打断点</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">0x100000fe0</span> &lt;+<span class="number">0</span>&gt;:  pushq  %rbp</span><br><span class="line">    <span class="number">0x100000fe1</span> &lt;+<span class="number">1</span>&gt;:  movq   %rsp, %rbp</span><br><span class="line">    <span class="number">0x100000fe4</span> &lt;+<span class="number">4</span>&gt;:  pushq  %r13</span><br><span class="line">    <span class="number">0x100000fe6</span> &lt;+<span class="number">6</span>&gt;:  subq   $<span class="number">0x28</span>, %rsp</span><br><span class="line">    <span class="number">0x100000fea</span> &lt;+<span class="number">10</span>&gt;: movq   $<span class="number">0x0</span>, <span class="number">-0x10</span>(%rbp)</span><br><span class="line">    <span class="number">0x100000ff2</span> &lt;+<span class="number">18</span>&gt;: xorps  %xmm0, %xmm0</span><br><span class="line">    <span class="number">0x100000ff5</span> &lt;+<span class="number">21</span>&gt;: movaps %xmm0, <span class="number">-0x20</span>(%rbp)</span><br><span class="line">    <span class="number">0x100000ff9</span> &lt;+<span class="number">25</span>&gt;: xorl   %eax, %eax</span><br><span class="line">    <span class="number">0x100000ffb</span> &lt;+<span class="number">27</span>&gt;: movl   %eax, %edi</span><br><span class="line">-&gt;  <span class="number">0x100000ffd</span> &lt;+<span class="number">29</span>&gt;: callq  <span class="number">0x100001250</span>               ; type metadata accessor <span class="keyword">for</span> Size #<span class="number">1</span> <span class="keyword">in</span> testSwift.test1() -&gt; () at &lt;compiler-generated&gt;</span><br><span class="line">    <span class="number">0x100001002</span> &lt;+<span class="number">34</span>&gt;: movq   %rax, %r13</span><br><span class="line">    <span class="number">0x100001005</span> &lt;+<span class="number">37</span>&gt;: movq   %rdx, <span class="number">-0x28</span>(%rbp)</span><br><span class="line">    <span class="number">0x100001009</span> &lt;+<span class="number">41</span>&gt;: callq  <span class="number">0x100001030</span>               ; __allocating_init() -&gt; Size #<span class="number">1</span> <span class="keyword">in</span> testSwift.test1() -&gt; () <span class="keyword">in</span> Size #<span class="number">1</span> <span class="keyword">in</span> testSwift.test1() -&gt; () at main.swift:<span class="number">15</span></span><br><span class="line">    <span class="number">0x10000100e</span> &lt;+<span class="number">46</span>&gt;: movq   %rax, <span class="number">-0x10</span>(%rbp)</span><br><span class="line">    <span class="number">0x100001012</span> &lt;+<span class="number">50</span>&gt;: callq  <span class="number">0x100001080</span>               ; init() -&gt; Point #<span class="number">1</span> <span class="keyword">in</span> testSwift.test1() -&gt; () <span class="keyword">in</span> Point #<span class="number">1</span> <span class="keyword">in</span> testSwift.test1() -&gt; () at main.swift:<span class="number">21</span></span><br><span class="line">    <span class="number">0x100001017</span> &lt;+<span class="number">55</span>&gt;: movq   %rax, <span class="number">-0x20</span>(%rbp)</span><br><span class="line">    <span class="number">0x10000101b</span> &lt;+<span class="number">59</span>&gt;: movq   %rdx, <span class="number">-0x18</span>(%rbp)</span><br><span class="line">    <span class="number">0x10000101f</span> &lt;+<span class="number">63</span>&gt;: movq   <span class="number">-0x10</span>(%rbp), %rdi</span><br><span class="line">    <span class="number">0x100001023</span> &lt;+<span class="number">67</span>&gt;: callq  <span class="number">0x1000050ac</span>               ; symbol stub <span class="keyword">for</span>: swift_release</span><br><span class="line">    <span class="number">0x100001028</span> &lt;+<span class="number">72</span>&gt;: addq   $<span class="number">0x28</span>, %rsp</span><br><span class="line">    <span class="number">0x10000102c</span> &lt;+<span class="number">76</span>&gt;: popq   %r13</span><br><span class="line">    <span class="number">0x10000102e</span> &lt;+<span class="number">78</span>&gt;: popq   %rbp</span><br><span class="line">    <span class="number">0x10000102f</span> &lt;+<span class="number">79</span>&gt;: retq</span><br></pre></td></tr></table></figure><p>进入 </p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span><span class="function"><span class="title">x100001009</span> &lt;+41&gt;: callq  0x100001030               ; __allocating_init() -&gt;</span> S<span class="function"><span class="title">ize</span> #1 <span class="built_in">in</span> testSwift.test1() -&gt;</span> () <span class="function"><span class="title">in</span> Size #1 <span class="built_in">in</span> testSwift.test1() -&gt;</span> () <span class="built_in">at</span> main.swift:<span class="number">15</span></span><br></pre></td></tr></table></figure><p>一路跟踪进入，最终来到了如下图所示位置</p><p><img src="https://user-gold-cdn.xitu.io/2019/7/7/16bca935cf4541ea?w=812&h=499&f=png&s=235950" alt=""></p><p>也就是确实分配了堆空间，验证了我们前面的结论</p><h2 id="对象的堆空间申请过程"><a href="#对象的堆空间申请过程" class="headerlink" title="对象的堆空间申请过程"></a>对象的堆空间申请过程</h2><ul><li>在Swift中，创建类的实例对象，要向堆空间申请内存，大概流程如下 </li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Class</span><span class="selector-class">.__allocating_init</span>() </span><br><span class="line"><span class="selector-tag">libswiftCore</span><span class="selector-class">.dylib</span><span class="selector-pseudo">:_swift_allocObject_</span> </span><br><span class="line"><span class="selector-tag">libswiftCore</span><span class="selector-class">.dylib</span><span class="selector-pseudo">:swift_slowAlloc</span> </span><br><span class="line"><span class="selector-tag">libsystem_malloc</span><span class="selector-class">.dylib</span><span class="selector-pseudo">:malloc</span></span><br></pre></td></tr></table></figure><ul><li>在Mac、iOS中的malloc函数分配的内存大小总是16的倍数</li><li>通过class_getInstanceSize可以得知:类的对象至少需要占用多少内存</li></ul><p>eg:</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Point  &#123;</span><br><span class="line">    var x = <span class="number">11</span></span><br><span class="line">    var test = <span class="literal">true</span></span><br><span class="line">var y = <span class="number">22</span> </span><br><span class="line">&#125;</span><br><span class="line">var p = <span class="constructor">Point()</span> </span><br><span class="line"><span class="keyword">class</span><span class="constructor">_getInstanceSize(<span class="params">type</span>(<span class="params">of</span>: <span class="params">p</span>)</span>) <span class="comment">// 40</span></span><br><span class="line"><span class="keyword">class</span><span class="constructor">_getInstanceSize(Point.<span class="params">self</span>)</span> <span class="comment">// 40</span></span><br></pre></td></tr></table></figure><h2 id="值类型"><a href="#值类型" class="headerlink" title="值类型"></a>值类型</h2><ul><li><p>值类型赋值给var、let或者给函数传参，是直接将所有内容拷贝一份 </p></li><li><p>类似于对文件进行copy、paste操作，产生了全新的文件副本。属于深拷贝(deep copy)</p></li><li><p>在Swift标准库中，为了提升性能，String、Array、Dictionary、Set采取了Copy On Write的技术 </p><ul><li>比如仅当有“写”操作时，才会真正执行拷贝操作<ul><li>对于标准库值类型的赋值操作，Swift 能确保最佳性能，所有没必要为了保证最佳性能来避免赋值</li></ul></li></ul></li><li><p>建议:不需要修改的，尽量定义成let</p></li></ul><h2 id="引用类型"><a href="#引用类型" class="headerlink" title="引用类型"></a>引用类型</h2><ul><li>引用赋值给var、let或者给函数传参，是将内存地址拷贝一份 </li><li>类似于制作一个文件的替身(快捷方式、链接)，指向的是同一个文件。属于浅拷贝(shallow copy)</li></ul><h2 id="枚举、结构体、类都可以定义方法"><a href="#枚举、结构体、类都可以定义方法" class="headerlink" title="枚举、结构体、类都可以定义方法"></a>枚举、结构体、类都可以定义方法</h2><h3 id="一般把定义在枚举、结构体、类内部的函数，叫做方法"><a href="#一般把定义在枚举、结构体、类内部的函数，叫做方法" class="headerlink" title="一般把定义在枚举、结构体、类内部的函数，叫做方法"></a>一般把定义在枚举、结构体、类内部的函数，叫做方法</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类中定义方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Size</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> width = <span class="number">10</span></span><br><span class="line">    <span class="keyword">var</span> height = <span class="number">10</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"width=\(width), height=\(height)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> s = <span class="type">Size</span>()</span><br><span class="line">s.show() <span class="comment">// width=10, height=10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体中定义方法</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">10</span></span><br><span class="line">    <span class="keyword">var</span> y = <span class="number">10</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"x=\(x), y=\(y)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> p = <span class="type">Point</span>()</span><br><span class="line">p.show() <span class="comment">// x=10, y=10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举中定义方法</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">grade</span> : <span class="title">Character</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> a = <span class="string">"a"</span></span><br><span class="line">    <span class="keyword">case</span> b = <span class="string">"b"</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"res is \(rawValue)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> g = grade.a</span><br><span class="line">g.show() <span class="comment">// res is a</span></span><br></pre></td></tr></table></figure><p>参考资料:</p><p><a href="https://github.com/apple/Swift" target="_blank" rel="noopener">Swift官方源码</a></p><p><a href="https://ke.qq.com/course/392094" target="_blank" rel="noopener">从入门到精通Swift编程</a></p><p><a href="https://github.com/CoderMJLee/Mems" target="_blank" rel="noopener">窥探内存细节的小工具</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;文章首发于&lt;a href=&quot;https://ityongzhen.github.io/Swift之类.html&quot;&gt;我的个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h
      
    
    </summary>
    
    
      <category term="Swift" scheme="https://ityongzhen.github.io/categories/Swift/"/>
    
    
  </entry>
  
  <entry>
    <title>Swift之可选项</title>
    <link href="https://ityongzhen.github.io/Swift%E4%B9%8B%E5%8F%AF%E9%80%89%E9%A1%B9.html/"/>
    <id>https://ityongzhen.github.io/Swift%E4%B9%8B%E5%8F%AF%E9%80%89%E9%A1%B9.html/</id>
    <published>2019-06-30T00:32:24.000Z</published>
    <updated>2019-12-12T06:19:04.296Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/categories/Swift/">我的个人博客</a></p><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><ul><li>可选项，一般也叫可选类型，它允许将值设置为nil </li><li>在类型名称后面加个问号? 来定义一个可选项</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name: <span class="type">String?</span> = <span class="string">"Jack"</span></span><br><span class="line">name = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> age: <span class="type">Int?</span> <span class="comment">// 默认就是nil </span></span><br><span class="line">age = <span class="number">10</span></span><br><span class="line">age = <span class="literal">nil</span></span><br></pre></td></tr></table></figure><h2 id="强制解包"><a href="#强制解包" class="headerlink" title="强制解包"></a>强制解包</h2><ul><li>可选项是对其他类型的一层包装，可以将它理解为一个盒子 <ul><li>如果为nil，那么它是个空盒子 </li><li>如果不为nil，那么盒子里装的是:被包装类型的数据</li></ul></li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> age: <span class="type">Int?</span> <span class="comment">// 默认就是nil </span></span><br><span class="line">age = <span class="number">10</span></span><br><span class="line">age = <span class="literal">nil</span></span><br></pre></td></tr></table></figure><ul><li>如果要从可选项中取出被包装的数据(将盒子里装的东西取出来)，需要使用感叹号! 进行强制解包</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">var age:</span> <span class="string">Int?</span> <span class="string">=</span> <span class="number">10</span></span><br><span class="line"><span class="attr">let ageInt:</span> <span class="string">Int</span> <span class="string">=</span> <span class="string">age!</span></span><br><span class="line"><span class="string">ageInt</span> <span class="string">+=</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><ul><li>如果对值为nil的可选项(空盒子)进行强制解包，将会产生运行时错误</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> age: <span class="built_in">Int</span>?</span><br><span class="line">age!<span class="comment">// 报错：Fatal error: Unexpectedly found nil while unwrapping an Optional value</span></span><br></pre></td></tr></table></figure><h2 id="判断可选项是否包含值"><a href="#判断可选项是否包含值" class="headerlink" title="判断可选项是否包含值"></a>判断可选项是否包含值</h2><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">let</span> <span class="variable">number</span> = <span class="function"><span class="title">Int</span>(<span class="string">"123"</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">number</span> <span class="variable">!</span>= <span class="variable"><span class="literal">nil</span></span> &#123;</span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="string">"字符串转换整数成功:\(number!)"</span>) </span></span><br><span class="line"><span class="function">&#125; <span class="variable"><span class="keyword">else</span></span> &#123;</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="string">"字符串转换整数失败"</span>) </span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 字符串转换整数成功:123</span></span></span><br></pre></td></tr></table></figure><h2 id="可选项绑定"><a href="#可选项绑定" class="headerlink" title="可选项绑定"></a>可选项绑定</h2><ul><li>可以使用可选项绑定来判断可选项是否包含值<ul><li>如果包含就自动解包，把值赋给一个临时的常量(let)或者变量(var)，并返回true，否则返回false</li></ul></li></ul><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> number = <span class="keyword">Int</span>(<span class="string">"123"</span>) &#123;</span><br><span class="line">   <span class="keyword">print</span>(<span class="string">"字符串转换整数成功:\(number)"</span>) </span><br><span class="line">    <span class="comment">// number是强制解包之后的Int值</span></span><br><span class="line"><span class="comment">// number作用域仅限于这个大括号</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line"><span class="keyword">print</span>(<span class="string">"字符串转换整数失败"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串转换整数成功:123</span></span><br></pre></td></tr></table></figure><p>eg:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Season</span> : <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> spring = <span class="number">1</span>, summer, autumn, winter</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> season = <span class="type">Season</span>(rawValue: <span class="number">6</span>) &#123;</span><br><span class="line"><span class="keyword">switch</span> season &#123; </span><br><span class="line"><span class="keyword">case</span> .spring:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"the season is spring"</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"the season is other"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"no such season"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// no such season</span></span><br></pre></td></tr></table></figure><h2 id="等价写法"><a href="#等价写法" class="headerlink" title="等价写法"></a>等价写法</h2><p>可选项绑定中，如果多个条件比如下面</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> <span class="keyword">if</span> <span class="built_in">let</span> <span class="built_in">first</span> = Int(<span class="string">"4"</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">let</span> <span class="built_in">second</span> = Int(<span class="string">"42"</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">first</span> &lt; <span class="built_in">second</span> &amp;&amp; <span class="built_in">second</span> &lt; <span class="number">100</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"\(first) &lt; \(second) &lt; 100"</span>)</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">// <span class="number">4</span> &lt; <span class="number">42</span> &lt; <span class="number">100</span></span><br></pre></td></tr></table></figure><p>可以用 , 分割开，看起来更简单</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">if</span> <span class="built_in">let</span> <span class="built_in">first</span> = Int(<span class="string">"4"</span>),</span><br><span class="line">    <span class="built_in">let</span> <span class="built_in">second</span> = Int(<span class="string">"42"</span>),</span><br><span class="line">    <span class="built_in">first</span> &lt; <span class="built_in">second</span> &amp;&amp; <span class="built_in">second</span> &lt; <span class="number">100</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\(second) &lt; \(second) &lt; 100"</span>)</span><br><span class="line">&#125;</span><br><span class="line">// <span class="number">4</span> &lt; <span class="number">42</span> &lt; <span class="number">100</span></span><br></pre></td></tr></table></figure><h2 id="while循环中使用可选项绑定"><a href="#while循环中使用可选项绑定" class="headerlink" title="while循环中使用可选项绑定"></a>while循环中使用可选项绑定</h2><ul><li>有如下需求<br>//遍历数组，将遇到的正数都加起来，如果遇到负数或者非数字，停止遍历</li></ul><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//遍历数组，将遇到的正数都加起来，如果遇到负数或者非数字，停止遍历</span><br><span class="line">// <span class="built_in">var</span> strs = [<span class="string">"10"</span>, <span class="string">"20"</span>, <span class="string">"abc"</span>, <span class="string">"-20"</span>, <span class="string">"30"</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">var</span> index = <span class="number">0</span></span><br><span class="line"><span class="built_in">var</span> <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">let</span> <span class="built_in">num</span> = Int(strs[index]), <span class="built_in">num</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="built_in">sum</span> += <span class="built_in">num</span></span><br><span class="line">index += <span class="number">1</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>)</span><br></pre></td></tr></table></figure><h2 id="空合并运算符-Nil-Coalescing-Operator"><a href="#空合并运算符-Nil-Coalescing-Operator" class="headerlink" title="空合并运算符 ??(Nil-Coalescing Operator)"></a>空合并运算符 ??(Nil-Coalescing Operator)</h2><p>eg:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> ?? &lt;T&gt;<span class="params">(<span class="keyword">optional</span>: T?, defaultValue: @autoclosure <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T?</span>) <span class="keyword">rethrows</span> -&gt; <span class="type">T?</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> ?? &lt;T&gt;<span class="params">(<span class="keyword">optional</span>: T?, defaultValue: @autoclosure <span class="params">()</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T</span>) <span class="keyword">rethrows</span> -&gt; <span class="type">T</span></span><br></pre></td></tr></table></figure><ul><li>a ?? b<ul><li>a 是可选项</li><li>b 是可选项 或者 不是可选项</li><li>b 跟 a 的存储类型必须相同</li><li>如果 a 不为nil，就返回 a</li><li>如果 a 为nil，就返回 b</li><li>如果 b 不是可选项，返回 a 时会自动解包</li></ul></li></ul><p><strong>规律： 返回的类型取决于b</strong></p><p>举例如下：</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a: <span class="type">Int?</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> b: <span class="type">Int?</span> = <span class="number">2</span></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">c</span> = a ?? b <span class="comment">// c是Int? , Optional(1)</span></span><br></pre></td></tr></table></figure><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> a: <span class="built_in">Int</span>? = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> b: <span class="built_in">Int</span> = <span class="number">2</span></span><br><span class="line"><span class="keyword">let</span> c = a ?? b <span class="comment">// c是Int , 1</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> a: <span class="type">Int?</span> = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">let</span> b: <span class="type">Int</span> = <span class="number">2</span></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">c</span> = a ?? b <span class="comment">// c是Int , 2</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> a: <span class="type">Int?</span> = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">let</span> b: <span class="type">Int?</span> = <span class="number">2</span></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">c</span> = a ?? b <span class="comment">// c是Int? , Optional(2)</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> a: <span class="type">Int?</span> = <span class="literal">nil</span> </span><br><span class="line"><span class="keyword">let</span> b: <span class="type">Int</span> = <span class="number">2</span></span><br><span class="line"><span class="comment">// 如果不使用??运算符 </span></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">c</span>: <span class="type">Int</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> tmp = a &#123;</span><br><span class="line">    <span class="built_in">c</span> = tmp</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line"><span class="built_in">c</span>=b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 ？？ 运算符</span></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">c</span> = a ?? b <span class="comment">// c是Int? , nil</span></span><br></pre></td></tr></table></figure><h2 id="多个-一起使用"><a href="#多个-一起使用" class="headerlink" title="多个 ?? 一起使用"></a>多个 ?? 一起使用</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> a: <span class="type">Int?</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> b: <span class="type">Int?</span> = <span class="number">2</span></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">c</span> = a ?? b ?? <span class="number">3</span> <span class="comment">// c是Int , 1</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a: <span class="type">Int?</span> = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">let</span> b: <span class="type">Int?</span> = <span class="number">2</span></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">c</span> = a ?? b ?? <span class="number">3</span> <span class="comment">// c是Int , 2</span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a: <span class="type">Int?</span> = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">let</span> b: <span class="type">Int?</span> = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">c</span> = a ?? b ?? <span class="number">3</span> <span class="comment">// c是Int , 3</span></span><br></pre></td></tr></table></figure><h2 id="跟if-let配合使用"><a href="#跟if-let配合使用" class="headerlink" title="??跟if let配合使用"></a>??跟if let配合使用</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> a: <span class="type">Int?</span> = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">let</span> b: <span class="type">Int?</span> = <span class="number">2</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="built_in">c</span> = a ?? b &#123;</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">c</span>) </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 类似于if a != nil || b != nil</span></span><br></pre></td></tr></table></figure><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> c = a, <span class="keyword">let</span> d = b &#123;</span><br><span class="line">    <span class="keyword">print</span>(c)</span><br><span class="line"><span class="keyword">print</span>(d) </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 类似于if a != nil &amp;&amp; b != nil</span></span><br></pre></td></tr></table></figure><h2 id="guard语句"><a href="#guard语句" class="headerlink" title="guard语句"></a>guard语句</h2><ul><li>当guard语句的条件为false时，就会执行大括号里面的代码 </li><li>当guard语句的条件为true时，就会跳过guard语句</li><li>guard语句特别适合用来“提前退出”</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">guard 条件 <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="regexp">//</span> <span class="keyword">do</span> something....</span><br><span class="line">退出当前作用域</span><br><span class="line"><span class="regexp">//</span> return、<span class="keyword">break</span>、<span class="keyword">continue</span>、throw error &#125;</span><br></pre></td></tr></table></figure><ul><li>当使用guard语句进行可选项绑定时，绑定的常量(let)、变量(var)也能在外层作用域中使用</li></ul><p>假设我们有个登陆的需求，要求输入账号，密码。缺一不可。</p><h3 id="用if语句书写"><a href="#用if语句书写" class="headerlink" title="用if语句书写"></a>用if语句书写</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//if语句实现登陆</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">login</span><span class="params">(<span class="number">_</span> info: [String : String])</span></span> &#123; </span><br><span class="line"><span class="keyword">let</span> username: <span class="type">String</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> tmp = info[<span class="string">"username"</span>] &#123;</span><br><span class="line">        username = tmp</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"请输入用户名"</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> password: <span class="type">String</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> tmp = info[<span class="string">"password"</span>] &#123;</span><br><span class="line">        password = tmp</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"请输入密码"</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 能来到这里，说明，username和password都是有值的</span></span><br><span class="line"><span class="comment">// if username ....</span></span><br><span class="line"><span class="comment">// if password ....</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"用户名:\(username)"</span>, <span class="string">"密码:\(password)"</span>, <span class="string">"登陆ing"</span>)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">login([<span class="string">"username"</span> : <span class="string">"jack"</span>, <span class="string">"password"</span> : <span class="string">"123456"</span>]) <span class="comment">// 用户名:jack 密码:123456 登陆ing </span></span><br><span class="line"></span><br><span class="line">login([<span class="string">"password"</span> : <span class="string">"123456"</span>]) <span class="comment">// 请输入密码</span></span><br><span class="line"></span><br><span class="line">login([<span class="string">"username"</span> : <span class="string">"jack"</span>]) <span class="comment">// 请输入用户名</span></span><br></pre></td></tr></table></figure><h3 id="如果用guard来书写"><a href="#如果用guard来书写" class="headerlink" title="如果用guard来书写"></a>如果用guard来书写</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">login</span><span class="params">(<span class="number">_</span> info: [String : String])</span></span> &#123;</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> username = info[<span class="string">"username"</span>] <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"请输入用户名"</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> password = info[<span class="string">"password"</span>] <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"请输入密码"</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// if username ....</span></span><br><span class="line"><span class="comment">// if password ....</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"用户名:\(username)"</span>, <span class="string">"密码:\(password)"</span>, <span class="string">"登陆ing"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="隐式解包-Implicitly-Unwrapped-Optional"><a href="#隐式解包-Implicitly-Unwrapped-Optional" class="headerlink" title="隐式解包(Implicitly Unwrapped Optional)"></a>隐式解包(Implicitly Unwrapped Optional)</h2><ul><li>在某些情况下，可选项一旦被设定值之后，就会一直拥有值</li><li>在这种情况下，可以去掉检查，也不必每次访问的时候都进行解包，因为它能确定每次访问的时候都有值 </li><li>可以在类型后面加个感叹号 ! 定义一个隐式解包的可选项</li></ul><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> num1: Int! = <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> num2: Int = num1</span><br><span class="line"><span class="keyword">if</span> num1 != nil &#123;</span><br><span class="line">    <span class="keyword">print</span>(num1 + <span class="number">6</span>) <span class="comment">// 16</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> num3 = num1 &#123;</span><br><span class="line">    <span class="keyword">print</span>(num3) <span class="comment">//10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意不能设置为nil</strong></p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num1: <span class="built_in">Int</span>! = nil</span><br><span class="line"><span class="comment">// Fatal error: Unexpectedly found nil while implicitly unwrapping an Optional value</span></span><br><span class="line"><span class="keyword">let</span> num2: <span class="built_in">Int</span> = num1</span><br></pre></td></tr></table></figure><p><strong>尽量不要使用这个强制解包。<br>除非你设计接口，不希望接收空值，如果别人传Nil过来，直接报错</strong></p><h2 id="字符串插值"><a href="#字符串插值" class="headerlink" title="字符串插值"></a>字符串插值</h2><ul><li>可选项在字符串插值或者直接打印时，编译器会发出警告</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> age: <span class="type">Int?</span> = <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"My age is \(age)"</span>)</span><br></pre></td></tr></table></figure><ul><li>至少有3种方法消除警告</li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="built_in">print</span>(<span class="string">"My age is \(age!)"</span>)</span><br><span class="line"><span class="comment">// My age is 10</span></span><br><span class="line"></span><br><span class="line"> <span class="built_in">print</span>(<span class="string">"My age is \(String(describing: age))"</span>)</span><br><span class="line"><span class="comment">// My age is Optional(10)</span></span><br><span class="line"></span><br><span class="line"> <span class="built_in">print</span>(<span class="string">"My age is \(age ?? 0)"</span>)</span><br><span class="line"><span class="comment">// My age is 10</span></span><br></pre></td></tr></table></figure><h2 id="多重可选项"><a href="#多重可选项" class="headerlink" title="多重可选项"></a>多重可选项</h2><ul><li>可以使用lldb指令 frame variable –R 或者 fr v –R 查看区别</li></ul><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> <span class="built_in">n</span><span class="symbol">um1:</span> <span class="built_in">Int</span>? = <span class="number">10</span></span><br><span class="line"><span class="built_in">var</span> <span class="built_in">n</span><span class="symbol">um2:</span> <span class="built_in">Int</span>?? = num1</span><br><span class="line"><span class="built_in">var</span> <span class="built_in">n</span><span class="symbol">um3:</span> <span class="built_in">Int</span>?? = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(num2 == num3) // <span class="built_in">true</span></span><br></pre></td></tr></table></figure><p>还有下面这种</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num1: <span class="type">Int?</span> = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">var</span> num2: <span class="type">Int?</span>? = num1</span><br><span class="line"><span class="keyword">var</span> num3: <span class="type">Int?</span>? = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(num2 == num3) <span class="comment">// false</span></span><br><span class="line">(num2 ?? <span class="number">1</span>) ?? <span class="number">2</span> <span class="comment">// 2</span></span><br><span class="line">(num3 ?? <span class="number">1</span>) ?? <span class="number">2</span> <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><p>参考资料:</p><p><a href="https://github.com/apple/Swift" target="_blank" rel="noopener">Swift官方源码</a></p><p><a href="https://ke.qq.com/course/392094" target="_blank" rel="noopener">从入门到精通Swift编程</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/categories/Swift/&quot;&gt;我的个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;定义&quot;&gt;&lt;a href=&quot;#定义&quot; class=&quot;headerlink&quot; title=&quot;定义&quot;&gt;&lt;/a&gt;
      
    
    </summary>
    
    
      <category term="Swift" scheme="https://ityongzhen.github.io/categories/Swift/"/>
    
    
  </entry>
  
  <entry>
    <title>Swift之枚举</title>
    <link href="https://ityongzhen.github.io/Swift%E4%B9%8B%E6%9E%9A%E4%B8%BE.html/"/>
    <id>https://ityongzhen.github.io/Swift%E4%B9%8B%E6%9E%9A%E4%B8%BE.html/</id>
    <published>2019-06-20T00:32:24.000Z</published>
    <updated>2019-12-12T06:18:31.474Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/categories/Swift/">我的个人博客</a></p><h2 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h2><h3 id="枚举的基本用法"><a href="#枚举的基本用法" class="headerlink" title="枚举的基本用法"></a>枚举的基本用法</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义方向的枚举</span></span><br><span class="line">enum <span class="built_in">Direction</span> &#123;</span><br><span class="line">     <span class="keyword">case</span> north</span><br><span class="line">     <span class="keyword">case</span> south</span><br><span class="line"> <span class="keyword">case</span> <span class="literal">east</span></span><br><span class="line"> <span class="keyword">case</span> <span class="literal">west</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面也可以写成</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Direction</span> &#123;</span></span><br><span class="line">    <span class="keyword">case</span> north, south, east, west</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> dir = Direction<span class="selector-class">.west</span> </span><br><span class="line">dir = Direction<span class="selector-class">.east</span> </span><br><span class="line">dir = .north</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(dir)</span></span> <span class="comment">// north</span></span><br></pre></td></tr></table></figure><p>也可以在switch中使用</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">switch</span> dir &#123; </span><br><span class="line"><span class="keyword">case</span> .north:</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"north"</span>) </span><br><span class="line"><span class="keyword">case</span> .south:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"south"</span>) </span><br><span class="line"><span class="keyword">case</span> .east:</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"east"</span>) </span><br><span class="line"><span class="keyword">case</span> .west:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"west"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="关联值"><a href="#关联值" class="headerlink" title="关联值"></a>关联值</h2><h3 id="有时将枚举的成员值跟其他类型的值关联存储在一起，会非常有用，可以认为将值直接存入到枚举的内存中"><a href="#有时将枚举的成员值跟其他类型的值关联存储在一起，会非常有用，可以认为将值直接存入到枚举的内存中" class="headerlink" title="有时将枚举的成员值跟其他类型的值关联存储在一起，会非常有用，可以认为将值直接存入到枚举的内存中"></a>有时将枚举的成员值跟其他类型的值关联存储在一起，会非常有用，可以认为将值直接存入到枚举的内存中</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">Score</span> &#123;</span></span><br><span class="line">    <span class="keyword">case</span> points(Int)</span><br><span class="line">    <span class="keyword">case</span> grade(Character)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如下使用：</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="keyword">score</span> = <span class="keyword">Score</span>.points(88) </span><br><span class="line"><span class="keyword">score</span> = .grade(<span class="string">"A"</span>)</span><br></pre></td></tr></table></figure><p>如果我们想使用枚举的具体值，可以如下用 i 来保存数据</p><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> score &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> .points(i):</span><br><span class="line"><span class="keyword">print</span>(i, <span class="string">"points"</span>) </span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> .grade(i):</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">"grade"</span>, i)</span><br><span class="line">&#125; <span class="comment">// grade A</span></span><br></pre></td></tr></table></figure><p>再比如我们想定义日期的枚举值，可以如下：</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">enum</span> Date &#123;</span><br><span class="line">    <span class="keyword">case</span> digit(<span class="built_in">year</span>: Int, <span class="built_in">month</span>: Int, <span class="built_in">day</span>: Int)</span><br><span class="line">    <span class="keyword">case</span> string(<span class="keyword">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用的时候，可以直接传年月日，或者传字符串</span></span><br><span class="line"></span><br><span class="line">var date = Date.digit(<span class="built_in">year</span>: <span class="number">2011</span>, <span class="built_in">month</span>: <span class="number">9</span>, <span class="built_in">day</span>: <span class="number">10</span>) </span><br><span class="line">date = .string(<span class="string">"2011-09-10"</span>)</span><br><span class="line"><span class="keyword">switch</span> date &#123;</span><br><span class="line"><span class="keyword">case</span> .digit(let <span class="built_in">year</span>, let <span class="built_in">month</span>, let <span class="built_in">day</span>):</span><br><span class="line">rint(<span class="built_in">year</span>, <span class="built_in">month</span>, <span class="built_in">day</span>) </span><br><span class="line"><span class="keyword">case</span> let .string(value):</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="必要时let也可以改为var"><a href="#必要时let也可以改为var" class="headerlink" title="必要时let也可以改为var"></a>必要时let也可以改为var</h3><h2 id="原始值"><a href="#原始值" class="headerlink" title="原始值"></a>原始值</h2><h3 id="枚举成员可以使用相同类型的默认值预先对应，这个默认值叫做-原始值"><a href="#枚举成员可以使用相同类型的默认值预先对应，这个默认值叫做-原始值" class="headerlink" title="枚举成员可以使用相同类型的默认值预先对应，这个默认值叫做:原始值"></a>枚举成员可以使用相同类型的默认值预先对应，这个默认值叫做:原始值</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 定义枚举</span></span><br><span class="line">enum Grade : String &#123;</span><br><span class="line">    case perfect = <span class="string">"A"</span></span><br><span class="line">    case great = <span class="string">"B"</span></span><br><span class="line">    case good = <span class="string">"C"</span></span><br><span class="line">    case bad = <span class="string">"D"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(Grade.perfect.rawValue)</span></span> <span class="comment">// A </span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(Grade.great.rawValue)</span></span> <span class="comment">// B </span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(Grade.good.rawValue)</span></span> <span class="comment">// C </span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(Grade.bad.rawValue)</span></span> <span class="comment">// D</span></span><br></pre></td></tr></table></figure><h3 id="注意-原始值不占用枚举变量的内存"><a href="#注意-原始值不占用枚举变量的内存" class="headerlink" title="注意:原始值不占用枚举变量的内存"></a>注意:原始值不占用枚举变量的内存</h3><h2 id="隐式原始值-Implicitly-Assigned-Raw-Values"><a href="#隐式原始值-Implicitly-Assigned-Raw-Values" class="headerlink" title="隐式原始值(Implicitly Assigned Raw Values)"></a>隐式原始值(Implicitly Assigned Raw Values)</h2><h3 id="如果枚举的原始值类型是Int、String，Swift会自动分配原始值"><a href="#如果枚举的原始值类型是Int、String，Swift会自动分配原始值" class="headerlink" title="如果枚举的原始值类型是Int、String，Swift会自动分配原始值"></a>如果枚举的原始值类型是Int、String，Swift会自动分配原始值</h3><h3 id="原始值是-String-类型枚举值"><a href="#原始值是-String-类型枚举值" class="headerlink" title="原始值是 String 类型枚举值"></a>原始值是 String 类型枚举值</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/<span class="regexp">/ 定义枚举值</span></span><br><span class="line"><span class="regexp">  enum Direction : String &#123;</span></span><br><span class="line"><span class="regexp">    case north = "north"</span></span><br><span class="line"><span class="regexp">    case south = "south"</span></span><br><span class="line"><span class="regexp">    case east = "east"</span></span><br><span class="line"><span class="regexp">    case west = "west"</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 等价于</span></span><br><span class="line"><span class="regexp">enum Direction : String &#123;</span></span><br><span class="line"><span class="regexp">    case north, south, east, west</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 使用</span></span><br><span class="line"><span class="regexp">print(Direction.north) /</span><span class="regexp">/ north </span></span><br><span class="line"><span class="regexp">print(Direction.north.rawValue) /</span><span class="regexp">/ north</span></span><br></pre></td></tr></table></figure><h3 id="原始值是-Int-类型枚举值"><a href="#原始值是-Int-类型枚举值" class="headerlink" title="原始值是 Int 类型枚举值"></a>原始值是 Int 类型枚举值</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">enum Season : Int &#123;</span><br><span class="line">    case spring, summer, autumn, winter</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(Season.spring.rawValue)</span></span> <span class="comment">// 0 </span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(Season.summer.rawValue)</span></span> <span class="comment">// 1 </span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(Season.autumn.rawValue)</span></span> <span class="comment">// 2 </span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(Season.winter.rawValue)</span></span> <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><h3 id="如果自己指定了原始值"><a href="#如果自己指定了原始值" class="headerlink" title="如果自己指定了原始值"></a>如果自己指定了原始值</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">enum Season : Int &#123;</span><br><span class="line">    case spring = <span class="number">1</span>, summer, autumn = <span class="number">8</span>, winter</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(Season.spring.rawValue)</span></span> <span class="comment">// 1 </span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(Season.summer.rawValue)</span></span> <span class="comment">// 2 </span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(Season.autumn.rawValue)</span></span> <span class="comment">// 8 </span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(Season.winter.rawValue)</span></span> <span class="comment">// 9</span></span><br></pre></td></tr></table></figure><h2 id="递归枚举"><a href="#递归枚举" class="headerlink" title="递归枚举"></a>递归枚举</h2><h3 id="递归枚举要加上关键字-indirect"><a href="#递归枚举要加上关键字-indirect" class="headerlink" title="递归枚举要加上关键字 indirect"></a>递归枚举要加上关键字 indirect</h3><p>eg:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 递归枚举</span></span><br><span class="line"><span class="keyword">indirect</span> <span class="class"><span class="keyword">enum</span> <span class="title">ArithExpr</span> </span>&#123;</span><br><span class="line"><span class="keyword">case</span> number(<span class="type">Int</span>)</span><br><span class="line"><span class="keyword">case</span> sum(<span class="type">ArithExpr</span>, <span class="type">ArithExpr</span>)</span><br><span class="line"><span class="keyword">case</span> difference(<span class="type">ArithExpr</span>, <span class="type">ArithExpr</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面的递归枚举和下面的等效</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">ArithExpr</span> </span>&#123;</span><br><span class="line"><span class="keyword">case</span> number(<span class="type">Int</span>)</span><br><span class="line"><span class="keyword">indirect</span> <span class="keyword">case</span> sum(<span class="type">ArithExpr</span>, <span class="type">ArithExpr</span>) </span><br><span class="line"><span class="keyword">indirect</span> <span class="keyword">case</span> difference(<span class="type">ArithExpr</span>, <span class="type">ArithExpr</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下列几种使用枚举都是可以的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> five = <span class="type">ArithExpr</span>.number(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">let</span> four = <span class="type">ArithExpr</span>.number(<span class="number">4</span>)</span><br><span class="line"><span class="keyword">let</span> two = <span class="type">ArithExpr</span>.number(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> sum = <span class="type">ArithExpr</span>.sum(five, four)</span><br><span class="line"><span class="keyword">let</span> difference = <span class="type">ArithExpr</span>.difference(sum, two)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自己写个 calculate 方法，</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calculate</span><span class="params">(<span class="number">_</span> expr: ArithExpr)</span></span> -&gt; <span class="type">Int</span> &#123; </span><br><span class="line"><span class="keyword">switch</span> expr &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> .number(value): </span><br><span class="line"><span class="keyword">return</span> value</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> .sum(<span class="keyword">left</span>, <span class="keyword">right</span>):</span><br><span class="line"><span class="keyword">return</span> calculate(<span class="keyword">left</span>) + calculate(<span class="keyword">right</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> .difference(<span class="keyword">left</span>, <span class="keyword">right</span>):</span><br><span class="line"><span class="keyword">return</span> calculate(<span class="keyword">left</span>) - calculate(<span class="keyword">right</span>)</span><br><span class="line">&#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//最终调用，计算差值</span></span><br><span class="line">calculate(difference)</span><br></pre></td></tr></table></figure><h2 id="MemoryLayout"><a href="#MemoryLayout" class="headerlink" title="MemoryLayout"></a>MemoryLayout</h2><h3 id="可以使用MemoryLayout获取数据类型占用的内存大小"><a href="#可以使用MemoryLayout获取数据类型占用的内存大小" class="headerlink" title="可以使用MemoryLayout获取数据类型占用的内存大小"></a>可以使用MemoryLayout获取数据类型占用的内存大小</h3><h4 id="关联值-1"><a href="#关联值-1" class="headerlink" title="关联值"></a>关联值</h4><ul><li>将关联值直接存入到枚举内存中</li></ul><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义枚举</span></span><br><span class="line"> <span class="class"><span class="keyword">enum</span> <span class="title">Password</span> &#123;</span></span><br><span class="line">    <span class="keyword">case</span> number(<span class="keyword">Int</span>, <span class="keyword">Int</span>, <span class="keyword">Int</span>, <span class="keyword">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> other</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MemoryLayout&lt;Password&gt;.stride <span class="comment">// 40, 分配占用的空间大小 </span></span><br><span class="line">MemoryLayout&lt;Password&gt;.size <span class="comment">// 33, 实际用到的空间大小 4*8 + 1 = 33</span></span><br><span class="line">MemoryLayout&lt;Password&gt;.alignment <span class="comment">// 8, 对齐参数</span></span><br></pre></td></tr></table></figure><p>定义变量来使用</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">var pwd = <span class="module-access"><span class="module"><span class="identifier">Password</span>.</span></span>number(<span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">MemoryLayout</span>.</span></span>stride(ofValue: pwd) <span class="comment">// 40</span></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">MemoryLayout</span>.</span></span>size(ofValue: pwd) <span class="comment">// 33 </span></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">MemoryLayout</span>.</span></span>alignment(ofValue: pwd) <span class="comment">// 8</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 如果改变了pwd</span></span><br><span class="line"> pwd = .other </span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">MemoryLayout</span>.</span></span>stride(ofValue: pwd) <span class="comment">// 40</span></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">MemoryLayout</span>.</span></span>size(ofValue: pwd) <span class="comment">// 33 </span></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">MemoryLayout</span>.</span></span>alignment(ofValue: pwd) <span class="comment">// 8</span></span><br></pre></td></tr></table></figure><h4 id="原始值-1"><a href="#原始值-1" class="headerlink" title="原始值"></a>原始值</h4><ul><li>原始值不会直接存入到枚举内存中</li><li>如果是下面这种枚举，只需要1个字节就可以了</li><li>一个字节可以存放 FF 也就是 0~255个枚举值。如果</li></ul><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Season</span> : <span class="title">Int</span> &#123;</span></span><br><span class="line">    <span class="keyword">case</span> spring, summer, autumn = <span class="number">8</span>, winter</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MemoryLayout&lt;Season&gt;.stride /<span class="regexp">/ 1, 分配占用的空间大小 </span></span><br><span class="line"><span class="regexp">MemoryLayout&lt;Season&gt;.size /</span><span class="regexp">/ 1, 实际用到的空间大小 1</span></span><br><span class="line"><span class="regexp">MemoryLayout&lt;Season&gt;.alignment /</span><span class="regexp">/ 1, 对齐参数</span></span><br></pre></td></tr></table></figure><h2 id="窥探内存"><a href="#窥探内存" class="headerlink" title="窥探内存"></a>窥探内存</h2><p>使用 <a href="https://github.com/CoderMJLee/Mems" target="_blank" rel="noopener">窥探内存细节的小工具</a> 我们可以很轻松的获取swift中，这些枚举值的内存地址</p><h3 id="简单枚举内存"><a href="#简单枚举内存" class="headerlink" title="简单枚举内存"></a>简单枚举内存</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">TestEnum</span>&#123;</span></span><br><span class="line">    <span class="keyword">case</span> k0,k1,k2,k3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var t = TestEnum.k1</span><br><span class="line">print(Mems.ptr(<span class="symbol">ofVal:</span> &amp;t)) </span><br><span class="line"></span><br><span class="line">t = TestEnum.k2</span><br></pre></td></tr></table></figure><p>执行完 print(Mems.ptr(ofVal: &amp;t))  代码之后<br>输出</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x00000001000054b8</span></span><br></pre></td></tr></table></figure><p>此时去查看 0x00000001000054b8地址的数据，</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br></pre></td></tr></table></figure><p>执行完 t = TestEnum.k2 之后</p><p>此时去查看 0x00000001000054b8地址的数据，</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">02</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br></pre></td></tr></table></figure><h3 id="具体查看内存"><a href="#具体查看内存" class="headerlink" title="具体查看内存"></a>具体查看内存</h3><p>假设我们有这么下面带代码，考虑下内存怎么布局呢？</p><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">enum TestEnum &#123;</span><br><span class="line">        <span class="keyword">case</span> test1(<span class="keyword">Int</span>, <span class="keyword">Int</span>, <span class="keyword">Int</span>)</span><br><span class="line">        <span class="keyword">case</span> test2(<span class="keyword">Int</span>, <span class="keyword">Int</span>)</span><br><span class="line">        <span class="keyword">case</span> test3(<span class="keyword">Int</span>)</span><br><span class="line">        <span class="keyword">case</span> test4(<span class="keyword">Bool</span>)</span><br><span class="line">        <span class="keyword">case</span> test5</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(MemoryLayout&lt;TestEnum&gt;.size)  <span class="comment">// 25, 分配占用的空间大小</span></span><br><span class="line"><span class="keyword">print</span>(MemoryLayout&lt;TestEnum&gt;.stride)    <span class="comment">//32, 实际用到的空间大小</span></span><br><span class="line"><span class="keyword">print</span>(MemoryLayout&lt;TestEnum&gt;.alignment)<span class="comment">// 8, 对齐参数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> e = TestEnum.test1(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">print</span>(Mems.ptr(ofVal: &amp;e))</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">e = .test2(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"><span class="keyword">print</span>(Mems.memStr(ofVal: &amp;e))</span><br><span class="line">    </span><br><span class="line">e = .test3(<span class="number">6</span>)</span><br><span class="line">     </span><br><span class="line">e = .test4(<span class="keyword">true</span>)</span><br><span class="line">      </span><br><span class="line">e = .test5</span><br></pre></td></tr></table></figure><p>执行完之后,可知 </p><p>TestEnum 这个占用内存为：</p><ul><li>print(MemoryLayout<TestEnum>.size)  // 25, 分配占用的空间大小</li><li>print(MemoryLayout<TestEnum>.stride)    //32, 实际用到的空间大小</li><li>print(MemoryLayout<TestEnum>.alignment)// 8, 对齐参数</li></ul><p>具体内存里面存的是什么呢？可以借助上面说的 <a href="https://github.com/CoderMJLee/Mems" target="_blank" rel="noopener">窥探内存细节的小工具</a> 打印出来内存，然后利用Xcode的 view Memory 查看具体内存的值</p><p>结果如下</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">enum</span> <span class="string">TestEnum</span> <span class="string">&#123;</span></span><br><span class="line">       <span class="string">case</span> <span class="string">test1(Int,</span> <span class="string">Int,</span> <span class="string">Int)</span></span><br><span class="line">       <span class="string">case</span> <span class="string">test2(Int,</span> <span class="string">Int)</span></span><br><span class="line">       <span class="string">case</span> <span class="string">test3(Int)</span></span><br><span class="line">       <span class="string">case</span> <span class="string">test4(Bool)</span></span><br><span class="line">       <span class="string">case</span> <span class="string">test5</span></span><br><span class="line">   <span class="string">&#125;</span></span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   <span class="string">print(MemoryLayout&lt;TestEnum&gt;.size)</span>  <span class="string">//</span> <span class="number">25</span><span class="string">,</span> <span class="string">分配占用的空间大小</span></span><br><span class="line">   <span class="string">print(MemoryLayout&lt;TestEnum&gt;.stride)</span>    <span class="string">//32,</span> <span class="string">实际用到的空间大小</span></span><br><span class="line">   <span class="string">print(MemoryLayout&lt;TestEnum&gt;.alignment)//</span> <span class="number">8</span><span class="string">,</span> <span class="string">对齐参数</span></span><br><span class="line"></span><br><span class="line">   <span class="string">//</span> <span class="number">1</span><span class="string">个字节存储成员值</span></span><br><span class="line">   <span class="string">//</span> <span class="string">N个字节存储关联值（N取占用内存最大的关联值），任何一个case的关联值都共用这N个字节</span></span><br><span class="line">   <span class="string">//</span> <span class="string">共用体</span></span><br><span class="line">   </span><br><span class="line">   <span class="string">//</span> <span class="string">小端：高高低低</span></span><br><span class="line">   <span class="string">//</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  <span class="string">//对应的TestEnum.test1传入的数值</span></span><br><span class="line">   <span class="string">//</span> <span class="number">02</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">//</span> <span class="number">03</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">//</span> <span class="number">00</span>                <span class="string">//</span> <span class="string">TestEnum.test1在第0个位置</span></span><br><span class="line">   <span class="string">//</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">var</span> <span class="string">e</span> <span class="string">=</span> <span class="string">TestEnum.test1(1,</span> <span class="number">2</span><span class="string">,</span> <span class="number">3</span><span class="string">)</span></span><br><span class="line">   <span class="string">print(Mems.ptr(ofVal:</span> <span class="string">&amp;e))</span></span><br><span class="line">   </span><br><span class="line">   <span class="string">//</span> <span class="number">04</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">//</span> <span class="number">05</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">//</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">//</span> <span class="number">01</span> <span class="string">//</span> <span class="string">TestEnum.test1在第1个位置</span></span><br><span class="line">   <span class="string">//</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">e</span> <span class="string">=</span> <span class="string">.test2(4,</span> <span class="number">5</span><span class="string">)</span></span><br><span class="line">   <span class="string">print(Mems.memStr(ofVal:</span> <span class="string">&amp;e))</span></span><br><span class="line">   </span><br><span class="line">   <span class="string">//</span> <span class="number">06</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">//</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">//</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">//</span> <span class="number">02</span></span><br><span class="line">   <span class="string">//</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">e</span> <span class="string">=</span> <span class="string">.test3(6)</span></span><br><span class="line">   </span><br><span class="line">   <span class="string">//</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">//</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">//</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">//</span> <span class="number">03</span></span><br><span class="line">   <span class="string">//</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">e</span> <span class="string">=</span> <span class="string">.test4(true)</span></span><br><span class="line">   </span><br><span class="line">   <span class="string">//</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">//</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">//</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">//</span> <span class="number">04</span></span><br><span class="line">   <span class="string">//</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">   <span class="string">e</span> <span class="string">=</span> <span class="string">.test5</span></span><br></pre></td></tr></table></figure><h3 id="只有一个case"><a href="#只有一个case" class="headerlink" title="只有一个case"></a>只有一个case</h3><p>假如只有一个case,其占用的空间为0，不需要存值来区分是哪个case</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">TestEnum</span> &#123;</span></span><br><span class="line">    <span class="keyword">case</span> spring</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print(MemoryLayout&lt;TestEnum&gt;.size)      /<span class="regexp">/ 0, 分配占用的空间大小</span></span><br><span class="line"><span class="regexp">print(MemoryLayout&lt;TestEnum&gt;.stride)    /</span><span class="regexp">/1, 实际用到的空间大小</span></span><br><span class="line"><span class="regexp">print(MemoryLayout&lt;TestEnum&gt;.alignment)/</span><span class="regexp">/ 1, 对齐参数</span></span><br></pre></td></tr></table></figure><h3 id="只有一个case，有关联值"><a href="#只有一个case，有关联值" class="headerlink" title="只有一个case，有关联值"></a>只有一个case，有关联值</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">TestEnum</span> &#123;</span></span><br><span class="line">    <span class="keyword">case</span> spring(Int)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print(MemoryLayout&lt;TestEnum&gt;.size)      /<span class="regexp">/ 8, 分配占用的空间大小</span></span><br><span class="line"><span class="regexp">print(MemoryLayout&lt;TestEnum&gt;.stride)    /</span><span class="regexp">/8, 实际用到的空间大小</span></span><br><span class="line"><span class="regexp">print(MemoryLayout&lt;TestEnum&gt;.alignment)/</span><span class="regexp">/ 8, 对齐参数</span></span><br></pre></td></tr></table></figure><p>参考资料:</p><p><a href="https://github.com/apple/Swift" target="_blank" rel="noopener">Swift官方源码</a></p><p><a href="https://ke.qq.com/course/392094" target="_blank" rel="noopener">从入门到精通Swift编程</a></p><p><a href="https://github.com/CoderMJLee/Mems" target="_blank" rel="noopener">窥探内存细节的小工具</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/categories/Swift/&quot;&gt;我的个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;枚举&quot;&gt;&lt;a href=&quot;#枚举&quot; class=&quot;headerlink&quot; title=&quot;枚举&quot;&gt;&lt;/a&gt;
      
    
    </summary>
    
    
      <category term="Swift" scheme="https://ityongzhen.github.io/categories/Swift/"/>
    
    
  </entry>
  
  <entry>
    <title>Swift之函数</title>
    <link href="https://ityongzhen.github.io/Swift%E4%B9%8B%E5%87%BD%E6%95%B0.html/"/>
    <id>https://ityongzhen.github.io/Swift%E4%B9%8B%E5%87%BD%E6%95%B0.html/</id>
    <published>2019-06-10T00:32:24.000Z</published>
    <updated>2019-12-12T06:17:38.542Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/categories/Swift/">我的个人博客</a></p><h2 id="函数定义"><a href="#函数定义" class="headerlink" title="函数定义"></a>函数定义</h2><ul><li>形参默认是let 并且只能是let</li></ul><ol><li><p>无参无返回值</p><p>可以省略Void 也可以不省略，如下三种都可以</p></li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sayHello</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"hello"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sayHello</span><span class="params">()</span> -&gt; <span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"hello"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sayHello</span><span class="params">()</span> -&gt; <span class="params">(Void)</span></span>&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"hello"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>无参有返回值</li></ol><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pi</span><span class="params">()</span> -&gt; <span class="title">Double</span> &#123;</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">3.1415</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>有参有返回值<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(a: Int, b: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="隐式返回"><a href="#隐式返回" class="headerlink" title="隐式返回"></a>隐式返回</h2><ul><li>如果函数体是个单一表达式，那么函数会返回这个表达式<br>比如上面的代码可以去掉 return 写成</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(a: Int, b: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="返回元组：可以实现多返回值"><a href="#返回元组：可以实现多返回值" class="headerlink" title="返回元组：可以实现多返回值"></a>返回元组：可以实现多返回值</h2><p>例如 </p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">func calculate(a: <span class="built_in">Int</span>, b: <span class="built_in">Int</span>) -&gt; (<span class="built_in">sum</span>: <span class="built_in">Int</span>, average: <span class="built_in">Int</span>) &#123;</span><br><span class="line">      let <span class="built_in">sum</span> = a + b</span><br><span class="line">      <span class="keyword">return</span> (<span class="built_in">sum</span>, <span class="built_in">sum</span> &gt;&gt; <span class="number">1</span>)</span><br><span class="line"> &#125;</span><br><span class="line"> 调用 calculate(a: <span class="number">2</span>, b: <span class="number">8</span>)</span><br><span class="line"> 返回 (<span class="built_in">sum</span>: <span class="number">10</span>, average: <span class="number">5</span>)</span><br></pre></td></tr></table></figure><h2 id="文档注释"><a href="#文档注释" class="headerlink" title="文档注释"></a>文档注释</h2><ul><li>把光标定位到需要添加注释文档的对象起始行，或上方的空白行。按下“command + Option + /”，即“⌘ + ⌥ + /”。（如果是 Windows 键盘则为“Win键 + ALT + /”）</li></ul><p>例如上文代码增加注释</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 计算两个数之和</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameters:</span></span><br><span class="line">  <span class="comment">///   - a: 第一个参数</span></span><br><span class="line">  <span class="comment">///   - b: 第二个参数</span></span><br><span class="line">  <span class="comment">/// - Returns: 返回两个参数之和</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(a: Int, b: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> a + b</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="参数标签"><a href="#参数标签" class="headerlink" title="参数标签"></a>参数标签</h2><ul><li>可以修改参数标签</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goToWork</span><span class="params">(at time: String)</span> -&gt; <span class="params">()</span></span> &#123;</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">"this time is \(time)"</span>)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ul><li>可以使用下划线 _ 省略参数标签</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum2</span><span class="params">(<span class="number">_</span> a: Int, <span class="number">_</span> b: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> a + b</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="默认参数值"><a href="#默认参数值" class="headerlink" title="默认参数值"></a>默认参数值</h2><ul><li>同C++ 中一样参数可以有默认值</li><li>但是C++里面默认参数有个限制：必须从右向左设置。而Swift中拥有参数标签，所以没有这个限制    </li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">定义：func <span class="keyword">check</span>(<span class="keyword">name</span>: <span class="keyword">String</span> = <span class="string">"jack"</span>, age: <span class="built_in">Int</span>, job: <span class="keyword">String</span> = <span class="string">"teacher"</span>) &#123;</span><br><span class="line">       print(<span class="string">"name = \(name), age = \(age), job = \(job)"</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">调用：<span class="keyword">check</span>(age: <span class="number">22</span>)</span><br><span class="line"></span><br><span class="line">输出： <span class="keyword">name</span> = jack, age = <span class="number">22</span>, job = teacher</span><br></pre></td></tr></table></figure><h2 id="可变参数"><a href="#可变参数" class="headerlink" title="可变参数"></a>可变参数</h2><p>例如：</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">func <span class="built_in">sum</span>(<span class="symbol">_</span> numbers: Int...) -&gt; Int&#123;</span><br><span class="line">       <span class="built_in">var</span> total = <span class="number">0</span></span><br><span class="line">       <span class="keyword">for</span> <span class="built_in">num</span> <span class="keyword">in</span> numbers &#123;</span><br><span class="line">           total += <span class="built_in">num</span></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="built_in">return</span> total</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">调用: <span class="built_in">sum</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure><ul><li>一个函数最多只能有一个可变参数</li><li>紧跟着可变参数后面的参数不能省略参数标签(否则编译起来有歧义)</li></ul><p>例如</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数string 不能省略标签</span></span><br><span class="line"> <span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(<span class="number">_</span> numers: Int..., string: String)</span></span> -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="输入输出参数"><a href="#输入输出参数" class="headerlink" title="输入输出参数"></a>输入输出参数</h2><ul><li>前面说了形参只能是let，但是如果我们想再内部修改外部实参的值，可以用 inpot 定义输入输出参数</li></ul><p>例如</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">func swapValues(_ v1: <span class="keyword">inout</span> Int, _ v2: <span class="keyword">inout</span> Int) &#123;</span><br><span class="line">     let tmp = v1</span><br><span class="line">     v1 = v2</span><br><span class="line">     v2 = tmp</span><br><span class="line">     <span class="comment">//前面三行也可以换成  (v1, v2) = (v2, v1) 效果一样</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line">  var num1 = <span class="number">10</span></span><br><span class="line">  var num2 = <span class="number">20</span></span><br><span class="line">  swapValues(&amp;num1, &amp;num2)</span><br><span class="line"> print(<span class="string">"num1 = \(num1), num2 = \(num2)"</span>)</span><br><span class="line">    </span><br><span class="line">  输出： num1 = <span class="number">20</span>, num2 = <span class="number">10</span></span><br></pre></td></tr></table></figure><p>注意点:</p><ul><li>可变参数不能标记为input</li><li>input参数不能有默认值</li><li>input参数的本质是地址传递(引用传递)</li><li>input参数只能传入可以被多次赋值的</li></ul><h2 id="函数重载"><a href="#函数重载" class="headerlink" title="函数重载"></a>函数重载</h2><h3 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h3><ul><li>函数名相同</li><li>参数个数不同 或者 参数类型不同 或者 参数标签不同</li></ul><p>注意点是：</p><ul><li>返回值类型与函数重载无关</li><li>默认参数值和函数重载一起使用产生二义性时候，编译器不会报错(c++中会报错)</li></ul><p>例如</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">func</span> sum(<span class="built_in">v1</span>: Int, <span class="built_in">v2</span>: Int) -&gt; Int &#123;</span><br><span class="line">      <span class="built_in">v1</span> + <span class="built_in">v2</span></span><br><span class="line">  &#125;</span><br><span class="line">  func sum(<span class="built_in">v1</span>: Int, <span class="built_in">v2</span>: Int, <span class="built_in">v3</span>: Int = <span class="number">10</span>) -&gt; Int &#123;</span><br><span class="line">      <span class="built_in">v1</span> + <span class="built_in">v2</span> + <span class="built_in">v3</span></span><br><span class="line">      </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  // 会调用sum(<span class="built_in">v1</span>: Int, <span class="built_in">v2</span>: Int) </span><br><span class="line">  sum(<span class="built_in">v1</span>: <span class="number">10</span>, <span class="built_in">v2</span>: <span class="number">20</span>)</span><br></pre></td></tr></table></figure><ul><li>可变参数、省略参数标签、函数重载一起使用产生二义性时，编译器有可能会报错</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(v1: Int, v2: Int)</span></span> -&gt; <span class="type">Int</span> &#123; v1 + v2</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(<span class="number">_</span> v1: Int, <span class="number">_</span> v2: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    v1 + v2 &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(<span class="number">_</span> numbers: Int...)</span></span> -&gt; <span class="type">Int</span> &#123; <span class="keyword">var</span> total = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        total += number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// error: ambiguous use of 'sum'</span></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure><h2 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型</h2><ul><li>每一个函数都是有类型的，函数类型由形式参数类型、返回值类型组成</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func test<span class="function"><span class="params">()</span> &#123; &#125; // <span class="params">()</span> -&gt;</span> Void 或者 <span class="function"><span class="params">()</span> -&gt;</span> ()</span><br><span class="line">func sum<span class="function"><span class="params">(a: Int, b: Int)</span> -&gt;</span> Int &#123;</span><br><span class="line">    a+b</span><br><span class="line">&#125; <span class="regexp">// (Int, Int) -&gt; Int</span></span><br><span class="line"><span class="regexp">//</span> 定义变量</span><br><span class="line"><span class="keyword">var</span> fn: <span class="function"><span class="params">(Int, Int)</span> -&gt;</span> Int = sum</span><br><span class="line">调用: fn(<span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure><h2 id="函数类型作为函数参数"><a href="#函数类型作为函数参数" class="headerlink" title="函数类型作为函数参数"></a>函数类型作为函数参数</h2><p>例如</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(v1: Int, v2: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">       v1 + v2</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="title">difference</span><span class="params">(v1: Int, v2: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">       v1 - v2</span><br><span class="line">       </span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 用一个函数类型作为参数 上面两个函数类型都是 (Int, Int) -&gt; Int</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="title">printResult</span><span class="params">(<span class="number">_</span> mathFn: <span class="params">(Int, Int)</span></span></span> -&gt; <span class="type">Int</span>, <span class="number">_</span> a: <span class="type">Int</span>, <span class="number">_</span> b: <span class="type">Int</span>) &#123; <span class="built_in">print</span>(<span class="string">"Result: \(mathFn(a, b))"</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 调用</span></span><br><span class="line">   printResult(sum, <span class="number">5</span>, <span class="number">2</span>) <span class="comment">// Result: 7</span></span><br><span class="line">   printResult(difference, <span class="number">5</span>, <span class="number">2</span>) <span class="comment">// Result: 3</span></span><br></pre></td></tr></table></figure><h2 id="返回值是函数类型的函数"><a href="#返回值是函数类型的函数" class="headerlink" title="返回值是函数类型的函数"></a>返回值是函数类型的函数</h2><ul><li>返回值是函数类型的函数，叫做高阶函数(Higher-Order Function)</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">(<span class="number">_</span> input: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    input + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">previous</span><span class="params">(<span class="number">_</span> input: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    input - <span class="number">1</span> </span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">forward</span><span class="params">(<span class="number">_</span> forward: Bool)</span></span> -&gt; (<span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    forward ? next : previous</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line">forward(<span class="literal">true</span>)(<span class="number">3</span>) <span class="comment">//  4  相当于 调用 next(3)</span></span><br><span class="line">forward(<span class="literal">false</span>)(<span class="number">3</span>) <span class="comment">// 2 相当于 调用 previous(3)</span></span><br></pre></td></tr></table></figure><h2 id="typealias-别名"><a href="#typealias-别名" class="headerlink" title="typealias 别名"></a>typealias 别名</h2><ul><li>用来给类型起别名</li></ul><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> typealias Date = (year: Int, month: Int, day: Int)</span><br><span class="line">   func <span class="built_in">test</span>(_ <span class="built_in">date</span>: <span class="built_in">Date</span>) &#123;</span><br><span class="line">       <span class="keyword">print</span>(<span class="built_in">date</span><span class="number">.0</span>)</span><br><span class="line">       <span class="keyword">print</span>(<span class="built_in">date</span>.year)</span><br><span class="line">       </span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 调用</span></span><br><span class="line"><span class="comment">// test((2011, 9, 10))</span></span><br></pre></td></tr></table></figure><h2 id="嵌套函数"><a href="#嵌套函数" class="headerlink" title="嵌套函数"></a>嵌套函数</h2><ul><li>将函数定义在函数内部</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">forward</span><span class="params">(<span class="number">_</span> forward: Bool)</span></span> -&gt; (<span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123; <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">(<span class="number">_</span> input: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    input + <span class="number">1</span> &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">previous</span><span class="params">(<span class="number">_</span> input: Int)</span></span> -&gt; <span class="type">Int</span> &#123; input - <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> forward ? next : previous</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">forward(<span class="literal">true</span>)(<span class="number">3</span>) <span class="comment">// 4</span></span><br><span class="line">forward(<span class="literal">false</span>)(<span class="number">3</span>) <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><p>参考资料:</p><p><a href="https://github.com/apple/Swift" target="_blank" rel="noopener">Swift官方源码</a></p><p><a href="https://ke.qq.com/course/392094" target="_blank" rel="noopener">从入门到精通Swift编程</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/categories/Swift/&quot;&gt;我的个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;函数定义&quot;&gt;&lt;a href=&quot;#函数定义&quot; class=&quot;headerlink&quot; title=&quot;函数定义
      
    
    </summary>
    
    
      <category term="Swift" scheme="https://ityongzhen.github.io/categories/Swift/"/>
    
    
  </entry>
  
  <entry>
    <title>Swift之流程控制</title>
    <link href="https://ityongzhen.github.io/Swift%E4%B9%8B%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6.html/"/>
    <id>https://ityongzhen.github.io/Swift%E4%B9%8B%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6.html/</id>
    <published>2019-05-30T00:32:24.000Z</published>
    <updated>2019-12-12T06:17:02.042Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/categories/Swift/">我的个人博客</a></p><h2 id="if-else"><a href="#if-else" class="headerlink" title="if-else"></a>if-else</h2><ul><li>if后面的条件可以省略小括号</li><li>条件后面的大括号不可以省略</li></ul><p>下面的代码是可以的</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">let</span> <span class="variable">score</span> = <span class="number">70</span></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">score</span> &gt;= <span class="number">80</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">"优秀"</span>)</span></span><br><span class="line">&#125;<span class="variable"><span class="keyword">else</span></span> <span class="variable"><span class="keyword">if</span></span> <span class="variable">score</span> &gt;= <span class="number">60</span>&#123;</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">"及格"</span>)</span></span><br><span class="line">&#125;<span class="variable"><span class="keyword">else</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">"不及格"</span>)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>if后面的条件只能是bool类型</li></ul><p>例如下面是不可以的</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">score</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">"aa"</span>)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="while"><a href="#while" class="headerlink" title="while"></a>while</h2><p>先看如下代码</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">num</span> = <span class="number">5</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">num</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"num is \(num)"</span>)</span><br><span class="line">    <span class="built_in">num</span> -= <span class="number">1</span></span><br><span class="line">&#125;<span class="comment">// 会打印五次</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="built_in">num</span> = <span class="number">5</span></span><br><span class="line">repeat &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"num is \(num)"</span>)</span><br><span class="line">     <span class="built_in">num</span> -= <span class="number">1</span></span><br><span class="line">&#125;<span class="keyword">while</span> <span class="built_in">num</span> &gt; <span class="number">0</span><span class="comment">// 会打印五次</span></span><br></pre></td></tr></table></figure><ul><li>repeat-while 相当于C语言中的 do-while</li><li>上面代码中没有用num–，是因为从Swift3开始，去掉了自增(++)、自减(–)运算符</li></ul><h2 id="for"><a href="#for" class="headerlink" title="for"></a>for</h2><h3 id="闭区间运算符-a…b，代表着-a-lt-取值-lt-b"><a href="#闭区间运算符-a…b，代表着-a-lt-取值-lt-b" class="headerlink" title="闭区间运算符: a…b，代表着: a &lt;= 取值 &lt;= b"></a>闭区间运算符: a…b，代表着: a &lt;= 取值 &lt;= b</h3><p>例如</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let persons = [<span class="string">"zhangsan"</span>,<span class="string">"lisi"</span>,<span class="string">"wanger"</span>,<span class="string">"mazi"</span>]</span><br><span class="line"><span class="function"><span class="title">for</span></span> i in <span class="number">0.</span>.<span class="number">.3</span> &#123;</span><br><span class="line">    print(persons[i])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//结果为</span></span><br><span class="line"><span class="comment">//zhangsan</span></span><br><span class="line"><span class="comment">//lisi</span></span><br><span class="line"><span class="comment">//wanger</span></span><br><span class="line"><span class="comment">//mazi</span></span><br></pre></td></tr></table></figure><ul><li>我们也可以用range来表示区间，例如</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let persons = [<span class="string">"zhangsan"</span>,<span class="string">"lisi"</span>,<span class="string">"wanger"</span>,<span class="string">"mazi"</span>]</span><br><span class="line">let <span class="keyword">range</span> = <span class="number">0.</span>.<span class="number">.3</span></span><br><span class="line"><span class="keyword">for</span> i in <span class="keyword">range</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(persons[i])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//结果为</span></span><br><span class="line"><span class="comment">//zhangsan</span></span><br><span class="line"><span class="comment">//lisi</span></span><br><span class="line"><span class="comment">//wanger</span></span><br><span class="line"><span class="comment">//mazi</span></span><br></pre></td></tr></table></figure><ul><li>我们也可以用变量来表示区间，例如</li></ul><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> persons = [<span class="string">"zhangsan"</span>,<span class="string">"lisi"</span>,<span class="string">"wanger"</span>,<span class="string">"mazi"</span>]</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">before</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> <span class="keyword">end</span> = <span class="number">3</span></span><br><span class="line"><span class="keyword">for</span> i in <span class="keyword">before</span>..<span class="variable">.end</span> &#123;</span><br><span class="line">    print(persons[i])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//结果为</span></span><br><span class="line"><span class="comment">//zhangsan</span></span><br><span class="line"><span class="comment">//lisi</span></span><br><span class="line"><span class="comment">//wanger</span></span><br><span class="line"><span class="comment">//mazi</span></span><br></pre></td></tr></table></figure><ul><li>我们也可以用变量和数值共同使用来表示区间，例如</li></ul><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let persons = [<span class="string">"zhangsan"</span>,<span class="string">"lisi"</span>,<span class="string">"wanger"</span>,<span class="string">"mazi"</span>]</span><br><span class="line"><span class="function"><span class="title">for</span></span> i in before..<span class="number">.3</span> &#123;</span><br><span class="line">    print(persons[i])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//结果为</span></span><br><span class="line"><span class="comment">//zhangsan</span></span><br><span class="line"><span class="comment">//lisi</span></span><br><span class="line"><span class="comment">//wanger</span></span><br><span class="line"><span class="comment">//mazi</span></span><br></pre></td></tr></table></figure><h3 id="半开区间运算符：a-lt-b-表示-a-lt-取值-lt-b"><a href="#半开区间运算符：a-lt-b-表示-a-lt-取值-lt-b" class="headerlink" title="半开区间运算符：a..&lt;b 表示 a &lt;= 取值 &lt; b"></a>半开区间运算符：a..&lt;b 表示 a &lt;= 取值 &lt; b</h3><p>例如</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let persons = [<span class="string">"zhangsan"</span>,<span class="string">"lisi"</span>,<span class="string">"wanger"</span>,<span class="string">"mazi"</span>]</span><br><span class="line"><span class="function"><span class="title">for</span></span> i in <span class="number">1.</span>.&lt;<span class="number">3</span> &#123;</span><br><span class="line">    print(persons[i])</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//结果为</span></span><br><span class="line"><span class="comment">//lisi</span></span><br><span class="line"><span class="comment">//wanger</span></span><br></pre></td></tr></table></figure><ol start="3"><li>区间运算符用在数组上<br>例如</li></ol><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> nums[<span class="number">0.</span>.<span class="number">.3</span>] &#123;</span><br><span class="line">    print(num)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//结果为</span></span><br><span class="line"><span class="comment">//1</span></span><br><span class="line"><span class="comment">//2</span></span><br><span class="line"><span class="comment">//3</span></span><br><span class="line"><span class="comment">//4</span></span><br></pre></td></tr></table></figure><ul><li>单侧区间</li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> nums[<span class="number">0.</span>..] &#123;</span><br><span class="line">    print(num)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//结果为</span></span><br><span class="line"><span class="comment">//1</span></span><br><span class="line"><span class="comment">//2</span></span><br><span class="line"><span class="comment">//3</span></span><br><span class="line"><span class="comment">//4</span></span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> nums[..&lt;<span class="number">4</span>] &#123;</span><br><span class="line">    print(num)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//结果为</span></span><br><span class="line"><span class="comment">//1</span></span><br><span class="line"><span class="comment">//2</span></span><br><span class="line"><span class="comment">//3</span></span><br><span class="line"><span class="comment">//4</span></span><br></pre></td></tr></table></figure><h2 id="区间类型"><a href="#区间类型" class="headerlink" title="区间类型"></a>区间类型</h2><p>如下三种</p><ul><li>let range1: ClosedRange<Int> = 1…3</li><li>let range2: Range<Int> = 1..&lt;3</li><li>let range3: PartialRangeThrough<Int> = …5</li></ul><p>字符、字符串也可以使用区间运算符，但默认不能使用在for-in中<br>例如</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">这样写是可以的</span><br><span class="line"><span class="keyword">let</span> strRange = <span class="string">"a"</span>...<span class="string">"f"</span></span><br><span class="line">strRange.<span class="built_in">contains</span>(<span class="string">"d"</span>) <span class="comment">// true</span></span><br><span class="line">strRange.<span class="built_in">contains</span>(<span class="string">"l"</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">但是下面是会报错的</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> strRange &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>\0 到 “~” 包括了所有的要用到的ASCII字符<br>例如我们要判断一个字符是否是ASCII字符</li></ul><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> characterRange: ClosedRange&lt;Character&gt; = <span class="string">"\0"</span><span class="params">...</span><span class="string">"~"</span></span><br><span class="line"><span class="comment">//想判断s是否是ASCII字符可以</span></span><br><span class="line">characterRange.contains(<span class="string">"s"</span>) <span class="comment">//返回true</span></span><br></pre></td></tr></table></figure><h3 id="带间隔的区间值"><a href="#带间隔的区间值" class="headerlink" title="带间隔的区间值"></a>带间隔的区间值</h3><p>用到了 stride<br>看代码</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let all = <span class="number">100</span></span><br><span class="line">let <span class="built_in">int</span>erval = <span class="number">20</span></span><br><span class="line"><span class="comment">// res的取值为从 10 开始 每次间隔 20，直到100结束，</span></span><br><span class="line"><span class="keyword">for</span> res <span class="keyword">in</span> stride(<span class="keyword">from</span>: <span class="number">10</span>, to: all, by: <span class="built_in">int</span>erval) &#123;</span><br><span class="line">    print(res)</span><br><span class="line">&#125;<span class="comment">// 结果为</span></span><br><span class="line"><span class="comment">//10</span></span><br><span class="line"><span class="comment">//30</span></span><br><span class="line"><span class="comment">//50</span></span><br><span class="line"><span class="comment">//70</span></span><br><span class="line"><span class="comment">//90</span></span><br></pre></td></tr></table></figure><h2 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h2><ul><li>case、default 后面不能写大括号{}</li><li>默认可以不写break，并不会贯穿到后面的条件</li></ul><p>例如</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> res = <span class="number">1</span></span><br><span class="line"><span class="keyword">switch</span> res &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"res = 0"</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"res = 1"</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"res = 2"</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">"other res"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出为 res = 1</span></span><br></pre></td></tr></table></figure><p><strong>关键字 fallthrough</strong></p><p>如果我们想让其贯穿下去，就是用 fallthrough 这个关键字<br>例如</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> res = <span class="number">1</span></span><br><span class="line"><span class="keyword">switch</span> res &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"res = 0"</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"res = 1"</span>)</span><br><span class="line">    <span class="keyword">fallthrough</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"res = 2"</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">"other res"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出为</span></span><br><span class="line"><span class="comment">// res = 1</span></span><br><span class="line"><span class="comment">// res = 2</span></span><br></pre></td></tr></table></figure><h3 id="switch中支持-字符串，字符类型"><a href="#switch中支持-字符串，字符类型" class="headerlink" title="switch中支持 字符串，字符类型"></a>switch中支持 字符串，字符类型</h3><p>例如</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">字符串</span><br><span class="line">let <span class="keyword">string</span> = <span class="string">"aaa"</span></span><br><span class="line"><span class="keyword">switch</span> <span class="keyword">string</span> &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"aaa"</span>:</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">"string is aaa"</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="string">"bbb"</span>:</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">"string is bbb"</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">&#125; <span class="comment">// string is aaa</span></span><br><span class="line"></span><br><span class="line">字符类型</span><br><span class="line">let <span class="keyword">character</span>: Character = <span class="string">"a"</span></span><br><span class="line"><span class="keyword">switch</span> <span class="keyword">character</span> &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"a"</span>,<span class="string">"A"</span>:</span><br><span class="line">     <span class="keyword">print</span>(<span class="string">"string is a or A"</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">"string is not a or A"</span>)</span><br><span class="line">&#125; <span class="comment">//string is a or A</span></span><br></pre></td></tr></table></figure><h3 id="区间、元组匹配"><a href="#区间、元组匹配" class="headerlink" title="区间、元组匹配"></a>区间、元组匹配</h3><ul><li>可以用下划线_ 忽略某个值</li><li>可以对区间，和元组进行匹配</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="built_in">count</span> = <span class="number">8</span></span><br><span class="line"><span class="keyword">switch</span> <span class="built_in">count</span> &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"0"</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>..&lt;<span class="number">5</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"1到4"</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">5</span>..&lt;<span class="number">10</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"5到10"</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//5到10</span></span><br></pre></td></tr></table></figure><p>和</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">let <span class="built_in">point</span> = (<span class="number">1</span>,<span class="number">0</span>)</span><br><span class="line"><span class="keyword">switch</span> <span class="built_in">point</span> &#123;</span><br><span class="line"><span class="keyword">case</span> (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"原点"</span>)</span><br><span class="line"><span class="keyword">case</span> (_, <span class="number">0</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"x轴"</span>)</span><br><span class="line"><span class="keyword">case</span> (<span class="number">0</span>, _):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"y轴"</span>)</span><br><span class="line"><span class="keyword">case</span> (<span class="number">-2.</span>.<span class="number">.2</span>, <span class="number">-2.</span>.<span class="number">.2</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"区间"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">"other"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//x轴</span></span><br></pre></td></tr></table></figure><h3 id="值绑定"><a href="#值绑定" class="headerlink" title="值绑定"></a>值绑定</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> point2 = (<span class="number">1</span>,<span class="number">0</span>)</span><br><span class="line"><span class="keyword">switch</span> point2 &#123;</span><br><span class="line"><span class="keyword">case</span> (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"原点"</span>)</span><br><span class="line"><span class="keyword">case</span> (<span class="keyword">let</span> x, <span class="number">0</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"x轴 x是 \(x)"</span>)</span><br><span class="line"><span class="keyword">case</span> (<span class="number">0</span>, <span class="keyword">let</span> y):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"y轴 y是 \(y)"</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> (x, y):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"somewhere else at (\(x),\(y))"</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"other"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// x轴 x是 1</span></span><br></pre></td></tr></table></figure><h2 id="where"><a href="#where" class="headerlink" title="where"></a>where</h2><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> numbers = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,]</span><br><span class="line"><span class="built_in">var</span> <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">num</span> <span class="keyword">in</span> numbers where <span class="built_in">num</span> &gt; <span class="number">2</span> &#123;</span><br><span class="line">    <span class="built_in">sum</span> += <span class="built_in">num</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>) //<span class="number">12</span></span><br></pre></td></tr></table></figure><h2 id="标签语句"><a href="#标签语句" class="headerlink" title="标签语句"></a>标签语句</h2><p>标签语句用于执行的时候，跳转到标签的位置</p><p>例如</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">outer: <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1.</span>.<span class="number">.4</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="number">1.</span>.<span class="number">.4</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">2</span> &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">3</span> &#123;</span><br><span class="line">            <span class="keyword">break</span> outer</span><br><span class="line">        &#125;</span><br><span class="line">         print(<span class="string">"i == \(i), k == \(k)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">输出为 </span><br><span class="line">i == <span class="number">1</span>, k == <span class="number">1</span></span><br><span class="line">i == <span class="number">1</span>, k == <span class="number">3</span></span><br><span class="line">i == <span class="number">1</span>, k == <span class="number">4</span></span><br><span class="line">i == <span class="number">2</span>, k == <span class="number">1</span></span><br><span class="line">i == <span class="number">2</span>, k == <span class="number">3</span></span><br><span class="line">i == <span class="number">2</span>, k == <span class="number">4</span></span><br></pre></td></tr></table></figure><p>如果加了标签</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">outer: <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1.</span>.<span class="number">.4</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="number">1.</span>.<span class="number">.4</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">2</span> &#123;</span><br><span class="line">            <span class="keyword">continue</span> outer</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">3</span> &#123;</span><br><span class="line">            <span class="keyword">break</span> outer</span><br><span class="line">        &#125;</span><br><span class="line">         print(<span class="string">"i == \(i), k == \(k)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line">输出为 </span><br><span class="line">i == <span class="number">1</span>, k == <span class="number">1</span></span><br><span class="line">i == <span class="number">2</span>, k == <span class="number">1</span></span><br></pre></td></tr></table></figure><p>参考资料:</p><p><a href="https://ke.qq.com/course/392094" target="_blank" rel="noopener">从入门到精通Swift编程</a></p><p><a href="https://github.com/apple/Swift" target="_blank" rel="noopener">Swift官方源码</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/categories/Swift/&quot;&gt;我的个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;if-else&quot;&gt;&lt;a href=&quot;#if-else&quot; class=&quot;headerlink&quot; title
      
    
    </summary>
    
    
      <category term="Swift" scheme="https://ityongzhen.github.io/categories/Swift/"/>
    
    
  </entry>
  
  <entry>
    <title>Swift之基本运算、数据类型、元组</title>
    <link href="https://ityongzhen.github.io/Swift%E4%B9%8B%E5%9F%BA%E6%9C%AC%E8%BF%90%E7%AE%97%E3%80%81%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E3%80%81%E5%85%83%E7%BB%84.html/"/>
    <id>https://ityongzhen.github.io/Swift%E4%B9%8B%E5%9F%BA%E6%9C%AC%E8%BF%90%E7%AE%97%E3%80%81%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E3%80%81%E5%85%83%E7%BB%84.html/</id>
    <published>2019-05-15T00:32:24.000Z</published>
    <updated>2019-12-12T06:15:56.041Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/categories/Swift/">我的个人博客</a></p><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><blockquote><p>  Swift编程语言，支持多编程范式和编译式，用来撰写基于macOS/OS X、iOS、watchOS和tvOS的软件。 苹果公司于2014年在苹果开发者年会（WWDC）发布了Swift编程语言。从设计上苹果公司让Swift与Objective-C共存在苹果公司的操作系统上</p></blockquote><blockquote><p>苹果宣称Swift的特点是：快速、现代、安全、互动，而且明显优于Objective-C语言。Swift以LLVM编译，可以使用现有的Cocoa和Cocoa Touch框架。Xcode Playgrounds功能是Swift为苹果开发工具带来的最大创新，该功能提供强大的互动效果，能让Swift源代码在撰写过程中能即时显示出其运行结果</p></blockquote><blockquote><p>2015年6月8日，苹果于WWDC2015上宣布，Swift将开放源代码，包括编译器和标准库<br>2015年12月3日，苹果宣布<a href="https://github.com/apple/Swift" target="_blank" rel="noopener">开源Swift</a>，并支持Linux，苹果在新网站Swift.org和托管网站Github上开源了Swift，但苹果的app store并不支持开源的Swift，只支持苹果官方的Swift版本，官方版本会在新网站Swift.org上定期与开源版本同步</p></blockquote><p>之前由于每个版本都不兼容，所以对开发者不友好，每次新版本，就像学了一门新的语言。但是从Swift5开始，API终于稳定下来了。可以来总结，学习一下Swift了。</p><h2 id="一些基本操作"><a href="#一些基本操作" class="headerlink" title="一些基本操作"></a>一些基本操作</h2><ul><li>生成语法树: Swiftc -dump-ast main.Swift </li><li>生成最简洁的SIL代码:Swiftc -emit-sil main.Swift </li><li>生成LLVM IR代码: Swiftc -emit-ir main.Swift -o main.ll </li><li>生成汇编代码: Swiftc -emit-assembly main.Swift -o main.s</li></ul><h2 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h2><ul><li>不用编写main函数，Swift将全局范围内的首句可执行代码作为程序入口</li><li>一句代码尾部可以省略分号(;)</li><li>多句代码写到同一行时必须用分号(;)隔开 </li><li>用var定义变量，let定义常量，编译器能自动推断出变量\常量的类型</li><li>Playground可以快速预览代码效果，是学习语法的好帮手 <ul><li>Command + Shift + Enter: 运行整个Playground </li><li>Shift + Enter:运行截止到某一行代码</li></ul></li></ul><p>例如</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var <span class="attr">a</span> = <span class="number">10</span></span><br><span class="line"><span class="attr">a</span> = <span class="number">20</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span> = <span class="number">88</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">c</span> = <span class="number">12</span> ; <span class="keyword">let</span> <span class="attr">d</span> = <span class="number">40</span></span><br><span class="line">print(d)</span><br></pre></td></tr></table></figure><p>创建对象，例如view视图，控制器等也更简单</p><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>和OC一样，有单行注释，多行注释<br>例如</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单行注释</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 多行注释</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>但是，Swift中增加了，注释的嵌套，比如这样是可以的</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 多行注释</span></span><br><span class="line"><span class="comment"> <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="comment"> </span></span></span><br><span class="line"><span class="comment"><span class="comment"> // 单行注释</span></span></span><br><span class="line"><span class="comment"><span class="comment"> </span></span></span><br><span class="line"><span class="comment"><span class="comment"> 嵌套多行注释</span></span></span><br><span class="line"><span class="comment"><span class="comment"> */</span></span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p><strong><em>Playound的注释是支持markup(类似Markdown)语法的</em></strong></p><ul><li>开启markup:Editor-&gt;Show Rendered Markup</li><li>只能在Playground中使用</li></ul><h2 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h2><ul><li>只能赋值1次</li><li>常量的值不要求在编译的时候确定，只要在使用之前赋值一次就可以了<br>例如下面都是可以的</li></ul><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> <span class="built_in">num</span> = <span class="number">10</span></span><br><span class="line"><span class="built_in">num</span> += <span class="number">20</span></span><br><span class="line"><span class="built_in">num</span> += <span class="number">30</span></span><br><span class="line"><span class="built_in">let</span> age = <span class="built_in">num</span></span><br><span class="line"><span class="built_in">print</span>(age)</span><br><span class="line"></span><br><span class="line">func getAge() -&gt; Int &#123;</span><br><span class="line">    <span class="built_in">return</span> <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> age2 = getAge()</span><br><span class="line"><span class="built_in">print</span>(age2)</span><br></pre></td></tr></table></figure><p>但是下面这种是不可以的，因为在初始化之前，是不可以使用的</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let <span class="keyword">number</span>: <span class="built_in">Int</span></span><br><span class="line"><span class="built_in">print</span>(<span class="keyword">number</span>)</span><br></pre></td></tr></table></figure><p>当然了，这种也是不行的</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="built_in">number</span></span><br><span class="line"><span class="built_in">number</span> = <span class="number">25</span></span><br></pre></td></tr></table></figure><h2 id="标识符"><a href="#标识符" class="headerlink" title="标识符"></a>标识符</h2><p>比如常量名，变量名，函数名等标识符</p><ul><li>标识符不能数字开头，不能包含空白字符，制表符，箭头灯特殊字符。</li><li>除此之外，几乎可以使用任何字符。</li></ul><h2 id="常见数据类型"><a href="#常见数据类型" class="headerlink" title="常见数据类型"></a>常见数据类型</h2><ol><li>值类型(value type)<ul><li>枚举(enum): optional</li><li>结构体(struct): Float、 Double、Float、Int、Character、String、Array、Dictionary、Set</li></ul></li><li>引用类型(reference type)<ul><li>类(class)</li></ul></li></ol><h2 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h2><p>不同类型之间的转换，比如</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 整数转换</span></span><br><span class="line"><span class="keyword">let</span> a: UInt16 = <span class="number">2_000</span></span><br><span class="line"><span class="keyword">let</span> b: UInt8 = <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> c = a + <span class="constructor">UInt16(<span class="params">b</span>)</span></span><br><span class="line">print(c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//整数和浮点数转换</span></span><br><span class="line"><span class="keyword">let</span> intNumber = <span class="number">3</span></span><br><span class="line"><span class="keyword">let</span> doubleNumber = <span class="number">0.1415926</span></span><br><span class="line"><span class="keyword">let</span> pi = <span class="constructor">Double(<span class="params">intNumber</span>)</span> + doubleNumber</span><br><span class="line"><span class="keyword">let</span> intPi = <span class="constructor">Int(<span class="params">pi</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字面量可以直接相加，因为字面量没有明确的类型</span></span><br><span class="line"><span class="keyword">let</span> res = <span class="number">3</span> + <span class="number">2.565</span></span><br></pre></td></tr></table></figure><h2 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h2><p>元祖可以把多个值保存在一起</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">格式: (数值<span class="number">1</span>, 数值<span class="number">2</span>, 数值<span class="number">3</span>)</span><br><span class="line">let numbers = (<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>)</span><br><span class="line"><span class="comment">// 可以通过索引访问</span></span><br><span class="line">numbers<span class="number">.0</span></span><br><span class="line">numbers<span class="number">.1</span></span><br><span class="line">numbers<span class="number">.2</span></span><br></pre></td></tr></table></figure><p>元祖中还可以保存不同的数据类型的值</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let person = (<span class="built_in">name</span>: <span class="string">"lnj"</span>, age: <span class="number">30</span>, <span class="built_in">score</span>: <span class="number">100.0</span>)</span><br><span class="line"><span class="comment">// 可以通过名称访问</span></span><br><span class="line">person.<span class="built_in">name</span></span><br><span class="line">person.age</span><br><span class="line">person.<span class="built_in">score</span></span><br></pre></td></tr></table></figure><p>我们甚至可以这样子</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 相当于同时定义了三个变量</span></span><br><span class="line">let (<span class="built_in">name</span>, age, <span class="built_in">score</span>) = (<span class="string">"lnj"</span>, <span class="number">30</span>, <span class="number">80</span>)</span><br><span class="line"><span class="built_in">name</span></span><br><span class="line">age</span><br><span class="line"><span class="built_in">score</span></span><br></pre></td></tr></table></figure><p>参考资料:</p><p><a href="https://github.com/apple/Swift" target="_blank" rel="noopener">Swift官方源码</a></p><p><a href="https://ke.qq.com/course/392094" target="_blank" rel="noopener">从入门到精通Swift编程</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/categories/Swift/&quot;&gt;我的个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;引言&quot;&gt;&lt;a href=&quot;#引言&quot; class=&quot;headerlink&quot; title=&quot;引言&quot;&gt;&lt;/a&gt;
      
    
    </summary>
    
    
      <category term="Swift" scheme="https://ityongzhen.github.io/categories/Swift/"/>
    
    
  </entry>
  
  <entry>
    <title>iOS逆向流程</title>
    <link href="https://ityongzhen.github.io/iOS%E9%80%86%E5%90%91%E6%B5%81%E7%A8%8B.html/"/>
    <id>https://ityongzhen.github.io/iOS%E9%80%86%E5%90%91%E6%B5%81%E7%A8%8B.html/</id>
    <published>2019-04-28T00:32:24.000Z</published>
    <updated>2019-12-12T05:59:36.249Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于 <a href="https://ityongzhen.github.io/categories">个人博客</a></p><h3 id="iOS逆向"><a href="#iOS逆向" class="headerlink" title="iOS逆向"></a>iOS逆向</h3><h5 id="准备：完美越狱iPhone"><a href="#准备：完美越狱iPhone" class="headerlink" title="准备：完美越狱iPhone"></a>准备：完美越狱iPhone</h5><p>逆向APP思路：1，代码分析</p><p>2，对Mach-O文件的静态分析MachOView、class-dump、Hopper Disassembler、ida等</p><p>3，动态调试 对运行中的APP进行代码调试 p debugserver、LLDB</p><p>4，代码编写</p><p>5，注入代码到APP中</p><p>6，必要时还可能需要重新签名、打包ipa</p><h4 id="一、Mac远程登录iPhone"><a href="#一、Mac远程登录iPhone" class="headerlink" title="一、Mac远程登录iPhone"></a>一、Mac远程登录iPhone</h4><ul><li><p>SSH (Secure Shell) 是“安全外壳协议”</p><p>OpenSSH 是SSH协议的免费开源实现 (在iPhone上通过Cydia安装OpenSSH工具(软件源<a href="http://apt.saurik.com" target="_blank" rel="noopener">http://apt.saurik.com</a>))</p><p>可以通过OpenSSH的方式让Mac远程登录到iPhone</p></li><li><p>SSH是通过TCP协议通信，所以要确保Mac和iPhone在同一局域网下，比如连接着同一个WiFi下</p><p>在终端输入</p></li></ul><p>ssh 账户名@服务器主机地址</p><p>例如：</p><p>ssh <a href="mailto:root@192.168.8.157">root@192.168.8.157</a>  然后输入密码(默认是alpine ) </p><p>这种方式wifi登录，受到网速限制</p><ul><li>usb连接 （不需要网络，速度快，安全） 1.1 sh usb.sh （注： python2 usbmuxd-1.0.8/python-client/tcprelay.py -t 22:10010 8888:8888）</li></ul><p>1.2  sh login.sh (注：ssh -p 10010 root@localhost)</p><p>上面的命令生效是因为已经把 usb.sh 和 login.sh 两个文件做了端口映射并放到了根目录 (映射需要usbmuxd工具包)</p><p>另外： 1.echo $PATH 查看设置的根目录，如果自己想写脚本在其他地方都能执行，也可以放在PATH路径下</p><p>2.手机和电脑能连接是因为，手机的授权文件 /var/root/.ssh/authorized_keys 中 添加了电脑的公钥 ~/.ssh/id_rsa.pub</p><p>Mac上有个服务程序usbmuxd（它会开机自动启动），可以将Mac的数据通过USB传输到iPhone</p><p>/System/Library/PrivateFrameworks/MobileDevice.framework/Resources/usbmuxd</p><p>下载usbmuxd工具包（下载v1.0.8版本，主要用到里面的一个python脚本：<a href="http://tcprelay.py" target="_blank" rel="noopener">tcprelay.py</a>）</p><p><a href="https://cgit.sukimashita.com/usbmuxd.git/snapshot/usbmuxd-1.0.8.tar.gz" target="_blank" rel="noopener">https://cgit.sukimashita.com/usbmuxd.git/snapshot/usbmuxd-1.0.8.tar.gz</a></p><h4 id="二、获取手机上软件的ipa包"><a href="#二、获取手机上软件的ipa包" class="headerlink" title="二、获取手机上软件的ipa包"></a>二、获取手机上软件的ipa包</h4><ul><li><p>Cycript 安装到手机上</p><p>Cycript是Objective-C++、ES6（JavaScript）、Java等语法的混合物，可以用来探索、修改、调试正在运行的Mac\iOS APP</p><p>官网： <a href="http://www.cycript.org/" target="_blank" rel="noopener">http://www.cycript.org/</a></p><p>文档： <a href="http://www.cycript.org/manual/" target="_blank" rel="noopener">http://www.cycript.org/manual/</a></p><p>通过Cydia安装Cycript，即可在iPhone上调试运行中的APP</p><p>使用： cycript -p 进程ID 比如：cycript -p NewsBoard</p><p>cycript -p 进程名称</p><p>取消输入:Ctrl + C</p><p>退出:Ctrl + D</p><p>清屏:Command + R</p><p>Github 上有基于cycript封装了一些函数 参考</p><p><a href="https://github.com/CoderMJLee/mjcript" target="_blank" rel="noopener">https://github.com/CoderMJLee/mjcript</a></p><p>@import mjcript —&gt;MJAppId、MJFrontVC()、MJDocPath、MJAppPath 等</p></li><li><p>Clutch -i 获取加壳软件的appid</p></li><li><p>PS命令 （手机上安装adv-cmds）</p><p>ps –A 列出所有的进程</p></li></ul><p>ps命令是process status</p><p>可以过滤关键词，比如 : ps -A | grep WeChat</p><ul><li><p>也可以用github 上工具获取 <a href="https://github.com/CoderMJLee/MJAppTools" target="_blank" rel="noopener">https://github.com/CoderMJLee/MJAppTools</a></p><p>MJAppTools 可以获取到架构，名称，是否加壳，安装包路径，数据库路径等</p></li></ul><h4 id="三、脱壳"><a href="#三、脱壳" class="headerlink" title="三、脱壳"></a>三、脱壳</h4><ul><li>iOS中有很多好用的脱壳工具</li></ul><p>Clutch:<a href="https://github.com/KJCracks/Clutch" target="_blank" rel="noopener">https://github.com/KJCracks/Clutch</a></p><p>dumpdecrypted:<a href="https://github.com/stefanesser/dumpdecrypted/" target="_blank" rel="noopener">https://github.com/stefanesser/dumpdecrypted/</a></p><p>AppCrackr、Crackulous</p><ul><li><p>Clutch -i 获取到appid之后，Clutch -d (APP序号) 导出app包 eg: Clutch -d 1 会打印出脱壳路径</p></li><li><p>DYLD_INSERT_LIBRARIES 脱壳</p><p>例如：MJAppTools 获取 到 【网易新闻】 &lt;com.netease.news&gt;  /private/var/mobile/Containers/Bundle/Application/64F0B25C-062E-4A89-8834-3F534C24E70D/NewsBoard.app</p><p>执行：</p><blockquote><blockquote><p>DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib /private/var/mobile/Containers/Bundle/Application/64F0B25C-062E-4A89-8834-3F534C24E70D/NewsBoard.app/NewsBoard</p></blockquote></blockquote><p>获取到的脱壳文件再当前目录下 (Device/var/root)</p></li><li><p>查看是否脱壳</p><p>otool -l 名称 | grep crypt 例如： otool -l NewsBoard | grep crypt 查看网易新闻是否脱壳</p></li></ul><p>也可以用hopper看是否脱壳</p><p>cryptid 0 为脱壳 cryptid 1 是加壳</p><h4 id="四、反编译出头文件"><a href="#四、反编译出头文件" class="headerlink" title="四、反编译出头文件"></a>四、反编译出头文件</h4><ul><li><p>class-dump</p><p>顾名思义，它的作用就是把Mach-O文件的class信息给dump出来(把类信息给导出来)，生成对应的.h头文件</p></li></ul><p>官方地址:<a href="http://stevenygard.com/projects/class-dump/" target="_blank" rel="noopener">http://stevenygard.com/projects/class-dump/</a></p><p>下载完工具包后将class-dump文件复制到Mac的/usr/local/bin目录，这样在终端就能识别class-dump命令了</p><p>常用格式：</p><p>class-dump -H Mach-O文件路径 -o 头文件存放目录 -H表示要生成头文件 -o用于制定头文件的存放目录</p><p>例如：当前目录下 class-dump -H NewsBoard -o Header (新建一个Header的文件夹) 这时候可以用hopper 等分析代码了</p><h4 id="五、theos"><a href="#五、theos" class="headerlink" title="五、theos"></a>五、theos</h4><ul><li><p>􏰂􏰃􏰄安装签名工具ldid</p><p>1.先确保安装brew<br>$(curl -fsSL<br><a href="https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;" target="_blank" rel="noopener">https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</a></p></li></ul><p>2.利用brew安装ldid</p><p>$ brew install ldid</p><ul><li><p>修改环境变量</p><ol><li>编辑用户配置文件</li></ol><p>$ vim ~/.bash_profile</p><p>2.在􏰝..bash_profie􏰛 文件后面加入下面两行</p><blockquote><p>export THEOS=~/theos<br>export PATH=$THEOS/bin:$PATH</p></blockquote><p>3,让.bash_profie配置的环境变量立即生效(或者重新打开终端)</p><blockquote><p>$ source ~/.bash_profile</p></blockquote></li><li><p>􏰣􏰵下载theos</p><p>建议在$PATH 目录下载代码(就是刚才配置的)</p><blockquote><p>$ git clone –recursive <a href="https://github.com/theos/theos.git" target="_blank" rel="noopener">https://github.com/theos/theos.git</a> $THEOS</p></blockquote></li><li><p>新建tweak 项目</p><p>1，cd到放文件的目录下（比如桌面</p><blockquote><p>$ cd ~/Desktop<br>$ nic.pl</p></blockquote><p>2，选择􏱋􏱌[13.] iphone/tweak</p><p>3，填写项目信息</p><p>名称 项目ID随便写， MobileSubstrate Bundle filter 写应用的id 其他回车</p></li></ul><h4 id="六、编写代码"><a href="#六、编写代码" class="headerlink" title="六、编写代码"></a>六、编写代码</h4><p>具体情况具体分析</p><h4 id="七、打包编译安装"><a href="#七、打包编译安装" class="headerlink" title="七、打包编译安装"></a>七、打包编译安装</h4><p>当前tweak文件目录下make clean &amp;&amp; make &amp;&amp; make package &amp;&amp; make install （已经写好了文件，可以直接 sh ~/tweak.sh</p><p>自己做的插件在 Device/Library/MobileSubstrate/DynamicLibraries</p><h4 id="八、theos资料"><a href="#八、theos资料" class="headerlink" title="八、theos资料"></a>八、theos资料</h4><ul><li><p>目录结构： <a href="https://github.com/theos/theos/wiki/Structure" target="_blank" rel="noopener">https://github.com/theos/theos/wiki/Structure</a></p></li><li><p>环境变量：<a href="http://iphonedevwiki.net/index.php/Theos" target="_blank" rel="noopener">http://iphonedevwiki.net/index.php/Theos</a></p></li><li><p>Logoes语法: <a href="http://iphonedevwiki.net/index.php/Logos" target="_blank" rel="noopener">http://iphonedevwiki.net/index.php/Logos</a></p><ul><li><p>%hook %end : hook一个类的开始和结束</p></li><li><p>%log : 打印方法调用详情</p><p>可以 􏱧􏰢􏱨􏱩Xcode -&gt; Window -&gt; Devices and Simulators􏱪􏱫􏳕􏳖 中查看</p></li><li><p>HBDebugLog 类似NSLog</p></li><li><p>%new : 添加一个新的方法</p></li><li><p>%c(className)： 生成一个class对象，比如Class%c(NSObject) ，类似于NSStringFromClass()􏰁、objc_getClass()</p></li><li><p>%orig :  函数调用原来的逻辑</p></li><li><p>%ctor ： 在加载动态库时候调用</p></li><li><p>%dtor : 程序退出时调用</p></li><li><p>logify.pl： 可以将一个头文件快速转成已经包含打印信息的xm文件</p><blockquote><p>logify.pl xx.h &gt; xx.xm</pre></p></blockquote><pre><code>1，在 UserCenterViewController.h 目录下执行logify.pl UserCenterViewController.h &gt; UserCenterViewController.xm2， UserCenterViewController.xm 拷贝到Makefile(Tweak.xm) 所在目录3, 新建一个src目录，把.xm文件放进去，修改路径 YZRongxin_FILES = $(wildcard src/*.xm)4，不认识的类 替换为void 删除__weak 删除协议5, 不想太详细 %log 换成NSLog(@&quot;%@&quot;,NSStringFromSelector(_cmd));6，HBLogDebug(@&quot; = 0x%x&quot;, (unsigned int)r) 改为 HBLogDebug(@&quot; = 0x%@&quot;, r)</code></pre></li></ul></li></ul><h4 id="九、MAC、IPhone-软件破解"><a href="#九、MAC、IPhone-软件破解" class="headerlink" title="九、MAC、IPhone 软件破解"></a>九、MAC、IPhone 软件破解</h4><p>例：PC软件破解 ./YZCTest</p><p>例：网易新闻去广告 NTESNBNewsListController hasAd</p><p>例：优酷去掉90s开头广告 XAdEnginePreAdModule setupVideoAd  needAd</p><p>如果是未越狱的IPhone 则还需要打包签名等操作。</p><h4 id="十、动态调试"><a href="#十、动态调试" class="headerlink" title="十、动态调试"></a>十、动态调试</h4><h4 id="十一、签名打包"><a href="#十一、签名打包" class="headerlink" title="十一、签名打包"></a>十一、签名打包</h4><ul><li><h4 id="准备一个embedded-mobileprovision文件（必须是付费证书产生的，appid-device一定要匹配）并放入到-app包中。"><a href="#准备一个embedded-mobileprovision文件（必须是付费证书产生的，appid-device一定要匹配）并放入到-app包中。" class="headerlink" title="准备一个embedded.mobileprovision文件（必须是付费证书产生的，appid,device一定要匹配）并放入到.app包中。"></a>准备一个embedded.mobileprovision文件（必须是付费证书产生的，appid,device一定要匹配）并放入到.app包中。</h4><ul><li><p>可以通过Xcode自动生成，然后再编译后的APP包中找到</p></li><li><p>可以去开发者网站生成证书下载</p></li></ul></li><li><p>从embedded.mobileprovision文件中提取出entitlements.plist权限文件</p><ul><li><p>security  cms  -D -i embedded.mobileprovision &gt; temp.plist</p></li><li><p>/usr/libexec/PlistBuddy -x -c’Print :Entitlements’ temp.plist &gt; entilements.plist</p></li></ul></li><li><p>查看可用的证书</p><ul><li>security find-identity -v -p codesigning</li></ul></li><li><p>对.app内的动态库、AppExtension等进行签名</p><ul><li>codesign -f -s 证书ID XXX.dylib</li></ul></li><li><p>对.app包进行签名</p><ul><li>codesign -f -s 证书id –entitlements entitlements.plist xxx.app</li></ul></li><li><p>重签名工具</p><ul><li><p>iOS App Signer</p><p>“&gt;<a href="https://github.com/DanTheMan827/ios-app-signer" target="_blank" rel="noopener">https://github.com/DanTheMan827/ios-app-signer</a></p><ul><li><p>对.app重签名，打包成ipa</p></li><li><p>需要再.app包中提供对应的embedded.mobileprovision文件</p></li></ul></li><li><p>iReSign</p><ul><li><p><a href="https://github.com/maciekish/iReSign" target="_blank" rel="noopener">https://github.com/maciekish/iReSign</a></p></li><li><p>可以对ipa进行重签名，打包成ipa</p></li><li><p>需要提供embedded.mobileprovision、entitlements.plist文件的路径</p></li></ul></li></ul></li></ul><h4 id="十二、其他笔记："><a href="#十二、其他笔记：" class="headerlink" title="十二、其他笔记："></a>十二、其他笔记：</h4><p>Tweak 技巧</p><p>1，加载 图片资源 创建 layout 文件夹 相当于Device/Library</p><p>图片会放在 在Device/Library/PreferenceLoader/Preference</p><p>2，自己做的插件在 Device/Library/MobileSubstrate/DynamicLibraries</p><p>3，#define YZFile(path) @”/Library/PreferenceLoader/Preferences/yzxmly/“ #path</p><p>4，多个文件，多个目录，引用头文件要使用路径比如 @import “abc/def/person.h”</p><p>5，路径 全路径，或者 <em>代替 比如：src/test.xm src/</em>.m （中间一个空格）</p><p>6，如果自己增加类，方法属性等，要声明的话</p><p>eg:</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@interface</span> yzdefine</span><br><span class="line">​</span><br><span class="line">-(<span class="keyword">void</span>)vipReOpenPlayer;</span><br><span class="line">​</span><br><span class="line"><span class="meta">@end</span>&lt;/pre&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于 &lt;a href=&quot;https://ityongzhen.github.io/categories&quot;&gt;个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;iOS逆向&quot;&gt;&lt;a href=&quot;#iOS逆向&quot; class=&quot;headerlink&quot; title=&quot;iOS逆向&quot;&gt;&lt;/a
      
    
    </summary>
    
    
      <category term="逆向" scheme="https://ityongzhen.github.io/categories/%E9%80%86%E5%90%91/"/>
    
    
  </entry>
  
  <entry>
    <title>设计模式之(九)观察者模式</title>
    <link href="https://ityongzhen.github.io/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B(%E4%B9%9D)%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F.html/"/>
    <id>https://ityongzhen.github.io/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B(%E4%B9%9D)%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F.html/</id>
    <published>2019-04-16T00:32:24.000Z</published>
    <updated>2019-12-12T05:42:29.850Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于<a href="https://ityongzhen.github.io/设计模式之(九)观察者模式.html">个人博客</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="什么是观察者模式"><a href="#什么是观察者模式" class="headerlink" title="什么是观察者模式"></a>什么是观察者模式</h3><p><a href="https://baike.baidu.com/item/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/5881786?fr=aladdin" target="_blank" rel="noopener">观察者模式</a>  属于行为型模式。</p><blockquote><p>观察者模式（有时又被称为模型（Model）-视图（View）模式、源-收听者(Listener)模式或从属者模式）是软件设计模式的一种。在此种模式中，一个目标物件管理所有相依于它的观察者物件，并且在它本身的状态改变时主动发出通知。这通常透过呼叫各观察者所提供的方法来实现。此种模式通常被用来实现事件处理系统。</p></blockquote><h2 id="模式结构"><a href="#模式结构" class="headerlink" title="模式结构"></a>模式结构</h2><h3 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h3><ul><li>抽象主题（Subject）：<br>它把所有观察者对象的引用保存到一个聚集里，每个主题都可以有任何数量的观察者。抽象主题提供一个接口，可以增加和删除观察者对象。</li><li>具体主题（Concrete Subject）：<br>将有关状态存入具体观察者对象；在具体主题内部状态改变时，给所有登记过的观察者发出通知。</li><li>抽象观察者（Observer）：<br>为所有的具体观察者定义一个接口，在得到主题通知时更新自己。</li><li>具体观察者（Concrete Observer）：<br>实现抽象观察者角色所要求的更新接口，以便使本身的状态与主题状态协调</li></ul><h3 id="使用场景："><a href="#使用场景：" class="headerlink" title="使用场景："></a>使用场景：</h3><ul><li>当一个抽象模型有两个方面，其中一个方面依赖于另一方面。将这二者封装在独立的对象中以使它们可以各自独立地改变和复用。</li><li>当对一个对象的改变需要同时改变其他对象，而不知道具体有多少对象需要被改变。</li><li>当一个对象必须通知其他对象，而它又不能假定其他对象是谁。换言之，不希望这些对象是紧密耦合的</li></ul><h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><ul><li>观察者模式的主要的作用就是对对象解耦，将观察者和被观察者完全隔离。</li></ul><h4 id="观察者模式的优点"><a href="#观察者模式的优点" class="headerlink" title="观察者模式的优点"></a>观察者模式的优点</h4><ul><li>观察者模式解除了主题和具体观察者的耦合，让耦合的双方都依赖于抽象，而不是依赖具体。</li></ul><h4 id="观察者模式的缺点"><a href="#观察者模式的缺点" class="headerlink" title="观察者模式的缺点"></a>观察者模式的缺点</h4><ul><li>在应用观察者模式时需要考虑一下开发小路问题，程序中包括一个被观察者和多个被观察者，开发和调试比较复杂，而且Java中的消息的通知默认是顺序执行的，一个观察者的卡顿会影响整体的执行效率。在这种情况下，一般考虑采用异步的方式。</li></ul><h2 id="iOS中的观察者模式"><a href="#iOS中的观察者模式" class="headerlink" title="iOS中的观察者模式"></a>iOS中的观察者模式</h2><p>一般两种：KVO和通知。通知比较简单，这里只说一下KVO</p><ul><li>KVO全称KeyValueObserving，俗称<strong>键值监听</strong>，是苹果提供的一套事件通知机制。允许对象监听另一个对象特定属性的改变，并在改变时接收到事件。由于KVO的实现机制，所以对属性才会发生作用，一般继承自NSObject的对象都默认支持KVO。</li><li>KVC和KVO都属于键值编程而且底层实现机制都是<strong>isa-swizzing</strong>。</li><li>KVO和NSNotificationCenter都是iOS中<strong>观察者模式</strong>的一种实现。KVO对被监听对象无侵入性，不需要修改其内部代码即可实现监听。</li><li>KVO可以监听单个属性的变化，也可以监听集合对象的变化。通过KVC的mutableArrayValueForKey:等方法获得代理对象，当代理对象的内部对象发生改变时，会回调KVO监听的方法。集合对象包含NSArray和NSSet。</li></ul><h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><ul><li>KVO是通过isa-swizzling技术实现的(这句话是整个KVO实现的重点)。</li><li>在运行时根据原类创建一个中间类，这个中间类是原类的子类，并动态修改当前对象的isa指向中间类。当修改 instance 对象的属性时，会调用 Foundation框架的 _NSSetXXXValueAndNotify 函数 ,该函数里面会先调用 willChangeValueForKey: 然后调用父类原来的 setter 方法修改值，最后是 didChangeValueForKey:。didChangeValueForKey 内部会触发监听器（Oberser）的监听方法observeValueForKeyPath:ofObject:change:context:</li><li>并且将class方法重写，返回原类的Class。</li></ul><h2 id="KVO的使用"><a href="#KVO的使用" class="headerlink" title="KVO的使用"></a>KVO的使用</h2><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><ol><li>通过addObserver:forKeyPath:options:context:方法注册观察者，观察者可以接收keyPath属性的变化事件。</li><li>在观察者中实现observeValueForKeyPath:ofObject:change:context:方法，当keyPath属性发生改变后，KVO会回调这个方法来通知观察者。</li><li>当观察者不需要监听时，可以调用removeObserver:forKeyPath:方法将KVO移除。需要注意的是，调用removeObserver需要在观察者消失之前，否则会导致Crash。</li></ol><p>例如，我们定义一个 YZPerson 类 继承自 NSObject ，里面有name 和 age 两个属性</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@interface</span> <span class="attribute">YZPerson </span>: NSObject</span><br><span class="line"><span class="variable">@property</span> (nonatomic ,assign) int age;</span><br><span class="line"><span class="variable">@property</span> (nonatomic,strong) NSString  *name;</span><br><span class="line"><span class="variable">@end</span></span><br></pre></td></tr></table></figure><p>然后在ViewController中，写如下代码</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">   <span class="comment">//调用方法</span></span><br><span class="line">    [<span class="keyword">self</span> setNameKVO];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)setNameKVO&#123;</span><br><span class="line">    <span class="keyword">self</span>.person = [[YZPerson alloc] init];</span><br><span class="line">    <span class="comment">// 注册观察者</span></span><br><span class="line">    <span class="built_in">NSKeyValueObservingOptions</span> options = <span class="built_in">NSKeyValueObservingOptionNew</span> | <span class="built_in">NSKeyValueObservingOptionOld</span>;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.person addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"name"</span> options:options context:<span class="string">@"1111"</span>];</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当监听对象的属性值发生改变时，就会调用</span></span><br><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span> *)change context:(<span class="keyword">void</span> *)context</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"监听到%@的%@属性值改变了 - %@ - %@"</span>, object, keyPath, change, context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event&#123;</span><br><span class="line">  <span class="keyword">self</span>.person.name = <span class="string">@"ccc"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)dealloc</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 移除监听</span></span><br><span class="line">    [<span class="keyword">self</span>.person removeObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"name"</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行之后结果为</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">KVOdemo[<span class="number">11482</span>:<span class="number">141804</span>] 监听到&lt;YZPerson: <span class="number">0x6000004e8400</span>&gt;的name属性值改变了 - &#123;</span><br><span class="line">    kind = <span class="number">1</span>;</span><br><span class="line">    new = ccc;</span><br><span class="line">    old = <span class="string">"&lt;null&gt;"</span>;</span><br><span class="line">&#125; - <span class="number">1111</span>- <span class="number">1111</span></span><br></pre></td></tr></table></figure><h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h3><p><strong>需要注意的是，上面代码中我们已经移除了监听，如果再次移除的话，就会crash</strong></p><p>例如</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">   <span class="comment">//调用方法</span></span><br><span class="line">    [<span class="keyword">self</span> setNameKVO];</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)setNameKVO&#123;</span><br><span class="line">   <span class="keyword">self</span>.person = [[YZPerson alloc] init];</span><br><span class="line">    <span class="comment">// 注册观察者</span></span><br><span class="line">    <span class="built_in">NSKeyValueObservingOptions</span> options = <span class="built_in">NSKeyValueObservingOptionNew</span> | <span class="built_in">NSKeyValueObservingOptionOld</span>;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.person addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"name"</span> options:options context:<span class="string">@"1111"</span>];</span><br><span class="line">       <span class="comment">// 移除监听</span></span><br><span class="line">    [person removeObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"name"</span>];</span><br><span class="line">    <span class="comment">// 再次移除</span></span><br><span class="line">     [person removeObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"name"</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>移除多次会报错 </p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">KVOdemo[<span class="number">9261</span>:<span class="number">2171323</span>] *** Terminating app due <span class="keyword">to</span> uncaught exception <span class="comment">'NSRangeException', </span></span><br><span class="line">reason: <span class="comment">'Cannot remove an observer <span class="doctag">&lt;ViewController 0x139e07220&gt;</span> for the key path "name" </span></span><br><span class="line"><span class="keyword">from</span> &lt;YZPerson <span class="number">0x281322f20</span>&gt; because it <span class="keyword">is</span> <span class="keyword">not</span> registered <span class="keyword">as</span> an observer.<span class="comment">'</span></span><br></pre></td></tr></table></figure><p><strong>如果忘记移除的话，有可能下次收到这个属性的变化的时候，会carsh</strong></p><p>所以，我们要保证add和remove是成对出现的</p><h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><p>更多关于KVO的内容，包括KVO的本质，KVO内部的流程，手动调用KVO等，可以参考之前的一篇文章<a href="https://ityongzhen.github.io/%E5%85%B3%E4%BA%8EKVO%E7%9C%8B%E8%BF%99%E7%AF%87%E5%B0%B1%E5%A4%9F%E4%BA%86.html">关于KVO看这篇就够了</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文首发于&lt;a href=&quot;https://ityongzhen.github.io/设计模式之(九)观察者模式.html&quot;&gt;个人博客&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前
      
    
    </summary>
    
    
      <category term="设计模式" scheme="https://ityongzhen.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
  </entry>
  
</feed>
